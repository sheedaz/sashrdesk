const _COMMON_CSS: &[u8; 7686] = b"html {\nvar(accent): #0071ff;\nvar(button): #2C8CFF;\nvar(gray-bg): #eee;\nvar(bg): white;\nvar(border): #ccc;\nvar(hover-border): #999;\nvar(text): #222;\nvar(placeholder): #aaa;\nvar(lighter-text): #888;\nvar(light-text): #666;\nvar(menu-hover): #D7E4F2;\nvar(dark-red): #A72145;\nvar(dark-yellow): #FBC732;\nvar(dark-blue): #2E2459;\nvar(green-blue): #197260;\nvar(gray-blue): #2B3439;\nvar(blue-green): #4299bf;\nvar(light-green): #D4EAB7;\nvar(dark-green): #5CB85C;\nvar(blood-red): #F82600;\nvar(gray-bg-osx): rgba(238, 238, 238, 0.75);\n}\nhtml.darktheme {\nvar(bg): #252525;\nvar(gray-bg): #141414;\nvar(menu-hover): #2D3033;\nvar(border): #555;\nvar(text): white;\nvar(light-text): #999;\nvar(lighter-text): #777;\nvar(placeholder): #555;\nvar(gray-bg-osx): rgba(37, 37, 37, 0.75);\n}\nbody {\nmargin: 0;\ncolor: color(text);\n}\nbutton.button {\nheight: 2em;\nborder-radius: 0.5em;\nbackground: color(button);\ncolor: color(bg);\nborder-color: color(button);\nmin-width: 40px;\n}\nbutton[type=checkbox], button[type=checkbox]:active {\nbackground: none;\nborder: none;\ncolor: unset;\nheight: 1.4em;\n}\nbutton.outline {\nborder: color(border) solid 1px;\nbackground: transparent;\ncolor: color(text);\n}\nbutton.button:active, button.active {\nbackground: color(accent);\ncolor: color(bg);\nborder-color: color(accent);\n}\nbutton.button:hover, button.outline:hover {\nborder-color: color(hover-border);\n}\nbutton.link {\nbackground: none !important;\nborder: none;\npadding: 0 !important;\ncolor: color(button);\ntext-decoration: underline;\ncursor: pointer;\n}\ninput[type=text], input[type=password], input[type=number] {\nwidth: *;\nfont-size: 1.5em;\nborder-color: color(border);\nborder-radius: 0;\ncolor: color(text);\npadding-left: 0.5em;\nbackground: color(bg);\n}\ninput:empty {\ncolor: color(placeholder);\n}\ninput.outline-focus:focus {\noutline: color(button) solid 3px;\n}\ntextarea {\nbackground: color(bg);\ncolor: color(text);\n}\ntextarea:empty {\ncolor: color(placeholder);\n}\n@set my-scrollbar\n{\n.prev { display:none; }\n.next { display:none; }\n.base, .next-page, .prev-page { background: white;}\n.slider { background: #bbb; border: white solid 4px; }\n.base:disabled { background: transparent; }\n.slider:hover  { background: grey; }\n.slider:active { background: grey; }\n.base { size: 16px; }\n.corner { background: white; }\n}\n@mixin ELLIPSIS {\ntext-overflow: ellipsis;\nwhite-space: nowrap;\noverflow-x: hidden;\n}\n.ellipsis {\n@ELLIPSIS;\n}\ndiv.password svg:not(.checkmark) {\npadding-left: 1em;\nsize: 16px;\ncolor: #ddd;\nbackground: none;\npadding-top: 4px!important;\n}\ndiv.password input {\nfont-family: Consolas, Menlo, Monaco, 'Courier New';\nfont-size: 1.2em;\n}\ndiv.username input {\nfont-size: 1.2em;\n}\nsvg {\nbackground: none;\n}\nheader {\nborder-bottom: color(border) solid 1px;\nheight: 22px;\nflow: horizontal;\noverflow-x: hidden;\nposition: relative;\n}\n@media platform == \"OSX\" {\nheader {\nbackground: linear-gradient(top,#E4E4E4,#D1D1D1);\n}\n}\nheader div.window-icon {\nsize: 22px;\n}\n@media platform != \"OSX\" {\nheader {\nbackground: white;\nheight: 30px;\n}\nheader div.window-icon {\nsize: 30px;\n}\n}\nheader div.window-icon icon {\ndisplay: block;\nmargin: *;\nsize: 16px;\nbackground-size: cover;\nbackground-repeat: no-repeat;\n}\nheader caption {\nsize: *;\n}\n@media platform != \"OSX\" {\nbutton.window {\ntop: 0;\npadding: 0 10px;\nwidth: 22px;\nposition: absolute;\ncolor: black;\nborder: none;\nbackground: none;\nborder-radius: 0;\n}\nbutton.window div {\nsize: 10px;\nmargin: *;\nbackground-size: cover;\nbackground-repeat: no-repeat;\n}\nbutton.window:hover {\nbackground: color(gray-bg);\n}\nbutton.window#minimize {\nright: 84px;\n}\nbutton.window#maximize {\nright: 42px;\n}\nbutton.window#close {\nright: 0px;\n}\nbutton.window#minimize div {\nheight: 3px;\nborder-bottom: black solid 1px;\nwidth: 12px;\n}\nbutton.window#maximize div {\nborder: black solid 1px;\n}\nbutton.window#close:hover {\nbackground: #F82600;\n}\nbutton.window#close:hover div {\nbackground-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMBAMAAACkW0HUAAAAD1BMVEUAAAD///////////////+PQt5oAAAABXRSTlMAO+hBqp3RzLsAAAAuSURBVAjXY3BkAAIRBiEDBgZGZRACMkEYxAJyQRwgV5EBSsEEoUqgGqDaoYYBALKmBEEnAGy8AAAAAElFTkSuQmCC');\n}\nbutton.window#close div {\nbackground-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMBAMAAACkW0HUAAAAD1BMVEUAAAAAAAAAAAAAAAAAAABPDueNAAAABXRSTlMAO+hBqp3RzLsAAAAuSURBVAjXY3BkAAIRBiEDBgZGZRACMkEYxAJyQRwgV5EBSsEEoUqgGqDaoYYBALKmBEEnAGy8AAAAAElFTkSuQmCC');\nsize: 12px;\n}\nbutton.window#maximize.restore div {\nborder: none;\nsize: 12px;\nbackground-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMAQMAAABsu86kAAAABlBMVEUAAAAAAAClZ7nPAAAAAXRSTlMAQObYZgAAAB1JREFUCNdjsP/AoCDA8P8CQ0MABipgaHBg+H8AAMfSC36WAZteAAAAAElFTkSuQmCC');\n}\n}\ndiv.chatbox {\nsize: *;\n}\ndiv.chatbox div.send svg {\nsize: 16px;\n}\ndiv.chatbox div.send span:active {\nopacity: 0.5;\n}\ndiv.chatbox div.send span {\ndisplay: inline-block;\npadding: 6px;\n}\ndiv.chatbox .msgs {\nborder: none;\nsize: *;\nborder-bottom: color(border) 1px solid;\noverflow-x: hidden;\noverflow-y: scroll-indicator;\nborder-spacing: 1em;\npadding: 1em;\n}\ndiv.chatbox div.send {\nflow: horizontal;\nheight: 30px;\npadding: 5px;\n}\ndiv.chatbox div.send input {\nheight: 20px !important;\n}\ndiv.chatbox div.name {\ncolor: color(dark-green);\n}\ndiv.chatbox div.right-side div {\ntext-align: right;\n}\ndiv.chatbox div.text {\nmargin-top: 0.5em;\n}\n@media platform != \"OSX\" {\nheader .window-toolbar {\nwidth: max-content;\nbackground: transparent;\nposition: absolute;\nbottom: 4px;\nheight: 24px;\n}\n}\nheader svg, menu svg {\nsize: 14px;\n}\nheader span, menu span {\npadding: 4px 8px;\nmargin: * 0.5em;\ncolor: color(light-text);\n}\nprogress {\ndisplay: inline-block;\naspect: Progress;\nborder: none;\nmargin-right: 1em;\nheight: 0.25em;\nbackground: transparent;\n}\nmenu {\nbackground: color(bg);\n}\nmenu div.separator {\nheight: 1px;\nwidth: *;\nmargin: 5px 0;\nbackground: color(gray-bg);\nborder: none;\n}\nmenu li {\ncolor: color(text);\nposition: relative;\n}\nmenu li span {\ndisplay: none;\n}\nmenu li.selected span:nth-child(1) {\ndisplay: inline-block;\nposition: absolute;\nleft: -10px;\ntop: 2px;\n}\n.link {\ncursor: pointer;\ntext-decoration: underline;\n}\n.link:active {\nopacity: 0.5;\n}\nmenu li:hover {\nbackground: color(menu-hover);\ncolor: color(text);\n}\nmenu li.line-through, menu li.line-through :hover {\ntext-decoration-line: line-through;\ncolor: red;\n}\n#tags {\nsize: *;\npadding: 0.5em;\noverflow-y: scroll-indicator;\nborder-spacing: 0.5em;\nflow: horizontal-flow;\n}\n#tags span {\nbackground: color(gray-bg);\ndisplay: inline-block;\nborder-radius: 6px;\npadding: 3px 0.5em;\nword-wrap: normal;\n}\n#tags span.active {\nbackground: color(button);\nborder-color: color(button);\ncolor: white;\n}\n#tags span:hover {\nborder-color: color(hover-border);\n}\ndiv#msgbox .msgbox-icon svg {\nsize: 80px;\nbackground: white;\n}\ndiv#msgbox .form {\nborder-spacing: 0.5em;\n}\ndiv#msgbox .caption {\n@ELLIPSIS;\nheight: 2em;\nline-height: 2em;\ntext-align: center;\ncolor: color(bg);\nfont-weight: bold;\n}\ndiv#msgbox .form .text {\n@ELLIPSIS;\n}\ndiv#msgbox button.button {\nmargin-left: 1.6em;\n}\ndiv#msgbox div.password {\nposition: relative;\n}\ndiv#msgbox div.password svg {\nposition: absolute;\nright: 0.25em;\ntop: 0.25em;\npadding: 0.5em;\ncolor: color(text);\n}\ndiv#msgbox div.set-password > div {\nflow: horizontal;\n}\ndiv#msgbox div.set-password > div > span {\nwidth: 30%;\nline-height: 2em;\n}\ndiv#msgbox div.set-password div.password {\nwidth: *;\n}\ndiv#msgbox div.set-password div > input {\nwidth: *;\n}\ndiv#msgbox div.set-password input {\nfont-size: 1em;\n}\ndiv#msgbox #error {\ncolor: red;\n}\ndiv.user-session .title {\nfont-size: 1.2em;\nmargin-bottom: 2em;\n}\ndiv.user-session select {\nwidth: 98%;\nheight: 2em;\nborder-radius: 0.5em;\nborder: color(border) solid 1px;\nbackground: color(bg);\ncolor: color(text);\npadding-left: 0.5em;\n}";
const _COMMON_TIS: &[u8; 18683] = b"include \"sciter:reactor.tis\";\nvar handler = $(#handler) || view;\ntry { view.windowIcon = self.url(handler.get_icon()); } catch(e) {}\nvar OS = view.mediaVar(\"platform\");\nvar is_osx = OS == \"OSX\";\nvar is_win = OS == \"Windows\";\nvar is_linux = OS == \"Linux\";\nvar is_file_transfer;\nvar is_xfce = false;\ntry { is_xfce = handler.is_xfce(); } catch(e) {}\nfunction isEnterKey(evt) {\nreturn (evt.keyCode == Event.VK_ENTER ||\n(is_osx && evt.keyCode == 0x4C) ||\n(is_linux && evt.keyCode == 65421));\n}\nfunction getScaleFactor() {\nif (!is_win) return 1;\nreturn self.toPixels(10000dip) / 10000.;\n}\nvar scaleFactor = getScaleFactor();\nview << event resolutionchange {\nscaleFactor = getScaleFactor();\n}\nfunction scaleIt(x) {\nreturn (x * scaleFactor).toInteger();\n}\nstdout.println(\"scaleFactor\", scaleFactor);\nfunction translate(name) {\ntry {\nreturn handler.t(name);\n} catch(_) {\nreturn name;\n}\n}\nfunction hashCode(str) {\nvar hash = 160 << 16 + 114 << 8 + 91;\nfor (var i = 0; i < str.length; i += 1) {\nhash = str.charCodeAt(i) + ((hash << 5) - hash);\n}\nreturn hash % 16777216;\n}\nfunction intToRGB(i, a = 1) {\nreturn 'rgba(' + ((i >> 16) & 0xFF) + ', ' + ((i >> 8) & 0x7F)\n+ ',' + (i & 0xFF) + ',' + a + ')';\n}\nfunction string2RGB(s, a = 1) {\nreturn intToRGB(hashCode(s), a);\n}\nfunction getTime() {\nvar now = new Date();\nreturn now.valueOf();\n}\nfunction platformSvg(platform, color) {\nplatform = (platform || \"\").toLowerCase();\nif (platform == \"linux\") {\nreturn <svg viewBox=\"0 0 256 256\">\n<g transform=\"translate(0 256) scale(.1 -.1)\" fill={color}>\n<path d=\"m1215 2537c-140-37-242-135-286-278-23-75-23-131 1-383l18-200-54-60c-203-224-383-615-384-831v-51l-66-43c-113-75-194-199-194-300 0-110 99-234 244-305 103-50 185-69 296-69 100 0 156 14 211 54 26 18 35 19 78 10 86-18 233-24 335-12 85 10 222 38 269 56 9 4 19-7 29-35 20-50 52-64 136-57 98 8 180 52 282 156 124 125 180 244 180 380 0 80-28 142-79 179l-36 26 4 119c5 175-22 292-105 460-74 149-142 246-286 409-43 49-78 92-78 97 0 4-7 52-15 107-8 54-19 140-24 189-13 121-41 192-103 260-95 104-248 154-373 122zm172-112c62-19 134-80 163-140 15-31 28-92 41-193 27-214 38-276 57-304 9-14 59-74 111-134 92-106 191-246 236-334 69-137 115-339 101-451l-7-55-71 10c-100 13-234-5-265-36-54-55-85-207-82-412l1-141-51-17c-104-34-245-51-380-45-69 3-142 10-162 16-32 10-37 17-53 68-23 72-87 201-136 273-80 117-158 188-237 215-37 13-37 13-34 61 13 211 182 555 373 759 57 62 58 63 58 121 0 33-9 149-19 259-21 224-18 266 26 347 67 122 193 174 330 133zm687-1720c32-9 71-25 87-36 60-42 59-151-4-274-59-119-221-250-317-257-34-3-35-2-48 47-18 65-20 329-3 413 16 83 29 110 55 115 51 10 177 6 230-8zm-1418-80c79-46 187-195 247-340 41-99 43-121 12-141-39-25-148-30-238-10-142 32-264 112-307 202-20 41-21 50-10 87 24 83 102 166 192 207 54 25 53 25 104-5z\"/>\n<path d=\"m1395 1945c-92-16-220-52-256-70-28-15-29-18-29-89 0-247 165-397 345-312 60 28 77 46 106 111 54 123 0 378-80 374-9 0-47-7-86-14zm74-156c15-69 14-112-5-159s-55-70-111-70c-48 0-78 20-102 68-15 29-41 131-41 159 0 9 230 63 242 57 3-2 11-27 17-55z\"/>\n</g>\n</svg>;\n}\nif (platform == \"mac os\") {\nreturn <svg viewBox=\"0 0 384 512\">\n<path d=\"M318.7 268.7c-.2-36.7 16.4-64.4 50-84.8-18.8-26.9-47.2-41.7-84.7-44.6-35.5-2.8-74.3 20.7-88.5 20.7-15 0-49.4-19.7-76.4-19.7C63.3 141.2 4 184.8 4 273.5q0 39.3 14.4 81.2c12.8 36.7 59 126.7 107.2 125.2 25.2-.6 43-17.9 75.8-17.9 31.8 0 48.3 17.9 76.4 17.9 48.6-.7 90.4-82.5 102.6-119.3-65.2-30.7-61.7-90-61.7-91.9zm-56.6-164.2c27.3-32.4 24.8-61.9 24-72.5-24.1 1.4-52 16.4-67.9 34.9-17.5 19.8-27.8 44.3-25.6 71.9 26.1 2 49.9-11.4 69.5-34.3z\" fill={color}/>\n</svg>;\n}\nif (platform == \"android\") {\nreturn <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"553\" height=\"553\"><path fill=\"white\" d=\"M77 179a33 33 0 0 0-25 10 33 33 0 0 0-9 24v143a33 33 0 0 0 10 24 33 33 0 0 0 24 10c9 0 17-3 24-10a33 33 0 0 0 10-24V213c0-9-4-17-10-24a33 33 0 0 0-24-10zM352 51l24-44c1-3 1-5-2-6-3-2-5-1-7 2l-24 43a163 163 0 0 0-133 0L186 3c-2-3-4-4-7-2-2 1-3 3-1 6l23 44c-24 12-43 29-57 51a129 129 0 0 0-21 72h307c0-26-7-50-21-72a146 146 0 0 0-57-51zm-136 63a13 13 0 0 1-10 4 13 13 0 0 1-12-13c0-4 1-7 3-9 3-3 6-4 9-4s7 1 10 4c2 2 3 5 3 9s-1 7-3 9zm140 0a12 12 0 0 1-9 4c-4 0-7-1-9-4a12 12 0 0 1-4-9c0-4 1-7 4-9 2-3 5-4 9-4a12 12 0 0 1 9 4c2 2 3 5 3 9s-1 7-3 9zM124 407c0 10 4 19 11 26s15 10 26 10h24v76c0 9 4 17 10 24s15 10 24 10c10 0 18-3 25-10s10-15 10-24v-76h45v76c0 9 4 17 10 24s15 10 25 10c9 0 17-3 24-10s10-15 10-24v-76h25a35 35 0 0 0 25-10c7-7 11-16 11-26V185H124v222zm352-228a33 33 0 0 0-24 10 33 33 0 0 0-10 24v143a34 34 0 0 0 34 34c10 0 18-3 25-10s10-15 10-24V213c0-9-4-17-10-24a33 33 0 0 0-25-10z\"/></svg>;\n}\nreturn <svg viewBox=\"0 0 448 512\">\n<path d=\"M0 93.7l183.6-25.3v177.4H0V93.7zm0 324.6l183.6 25.3V268.4H0v149.9zm203.8 28L448 480V268.4H203.8v177.9zm0-380.6v180.1H448V32L203.8 65.7z\" fill={color}/>\n</svg>;\n}\nfunction centerize(w, h) {\nvar (sx, sy, sw, sh) = view.screenBox(#workarea, #rectw);\nif (w > sw) w = sw;\nif (h > sh) h = sh;\nvar x = (sx + sw - w) / 2;\nvar y = (sy + sh - h) / 2;\nview.move(x, y, w, h);\n}\nfunction setWindowButontsAndIcon(only_min=false) {\nif (only_min) {\n$(div.window-buttons).content(<div>\n<button.window tabindex=\"-1\" role=\"window-minimize\" #minimize><div /></button>\n</div>);\n} else {\n$(div.window-buttons).content(<div>\n<button.window tabindex=\"-1\" role=\"window-minimize\" #minimize><div /></button>\n<button.window tabindex=\"-1\" role=\"window-maximize\" #maximize><div /></button>\n<button.window tabindex=\"-1\" role=\"window-close\" #close><div /></button>\n</div>);\n}\n$(div.window-icon>icon).style.set {\n\"background-image\": \"url('\" + handler.get_icon() + \"')\",\n};\n}\nfunction adjustBorder() {\nif (is_osx) {\nif (view.windowState == View.WINDOW_FULL_SCREEN) {\n$(header).style.set {\ndisplay: \"none\",\n};\n} else {\n$(header).style.set {\ndisplay: \"block\",\npadding: \"0\",\n};\n}\nreturn;\n}\nif (view.windowState == view.WINDOW_MAXIMIZED) {\nself.style.set {\nborder: \"window-frame-width solid transparent\",\n};\n} else if (view.windowState == view.WINDOW_FULL_SCREEN) {\nself.style.set {\nborder: \"none\",\n};\n} else {\nself.style.set {\nborder: \"black solid 1px\",\n};\n}\nvar el = $(button#maximize);\nif (el) el.attributes.toggleClass(\"restore\", view.windowState == View.WINDOW_MAXIMIZED);\nel = $(span#fullscreen);\nif (el) el.attributes.toggleClass(\"active\", view.windowState == View.WINDOW_FULL_SCREEN);\n}\nvar svg_checkmark = <svg class=\"checkmark\" viewBox=\"0 0 492 492\"><path d=\"M484 105l-16-17a27 27 0 00-38 0L204 315 62 173c-5-5-12-7-19-7s-14 2-19 7L8 189a27 27 0 000 38l160 160v1l16 16c5 5 12 8 19 8 8 0 14-3 20-8l16-16v-1l245-244a27 27 0 000-38z\"/></svg>;\nvar svg_edit = <svg #edit viewBox=\"0 0 384 384\">\n<path d=\"M0 304v80h80l236-236-80-80zM378 56L328 6c-8-8-22-8-30 0l-39 39 80 80 39-39c8-8 8-22 0-30z\"/>\n</svg>;\nvar svg_eye = <svg viewBox=\"0 0 469.33 469.33\">\n<path d=\"m234.67 170.67c-35.307 0-64 28.693-64 64s28.693 64 64 64 64-28.693 64-64-28.694-64-64-64z\"/>\n<path d=\"m234.67 74.667c-106.67 0-197.76 66.346-234.67 160 36.907 93.653 128 160 234.67 160 106.77 0 197.76-66.347 234.67-160-36.907-93.654-127.89-160-234.67-160zm0 266.67c-58.88 0-106.67-47.787-106.67-106.67s47.787-106.67 106.67-106.67 106.67 47.787 106.67 106.67-47.787 106.67-106.67 106.67z\"/>\n</svg>;\nvar svg_send = <svg viewBox=\"0 0 448 448\">\n<polygon points=\"0.213 32 0 181.33 320 224 0 266.67 0.213 416 448 224\"/>\n</svg>;\nvar svg_chat = <svg viewBox=\"0 0 511.07 511.07\">\n<path d=\"m74.39 480.54h-36.213l25.607-25.607c13.807-13.807 22.429-31.765 24.747-51.246-36.029-23.644-62.375-54.751-76.478-90.425-14.093-35.647-15.864-74.888-5.121-113.48 12.89-46.309 43.123-88.518 85.128-118.85 45.646-32.963 102.47-50.387 164.33-50.387 77.927 0 143.61 22.389 189.95 64.745 41.744 38.159 64.734 89.63 64.734 144.93 0 26.868-5.471 53.011-16.26 77.703-11.165 25.551-27.514 48.302-48.593 67.619-46.399 42.523-112.04 65-189.83 65-28.877 0-59.01-3.855-85.913-10.929-25.465 26.123-59.972 40.929-96.086 40.929zm182-420c-124.04 0-200.15 73.973-220.56 147.28-19.284 69.28 9.143 134.74 76.043 175.12l7.475 4.511-0.23 8.727c-0.456 17.274-4.574 33.912-11.945 48.952 17.949-6.073 34.236-17.083 46.99-32.151l6.342-7.493 9.405 2.813c26.393 7.894 57.104 12.241 86.477 12.241 154.37 0 224.68-93.473 224.68-180.32 0-46.776-19.524-90.384-54.976-122.79-40.713-37.216-99.397-56.888-169.71-56.888z\"/>\n</svg>;\nvar svg_keyboard = <svg viewBox=\"0 0 511.07 511.07\"><path d=\"M491.979 217.631H110.205a48.41 48.41 0 0 1 .637-4.061c4.408-21.755 23.676-38.152 46.71-38.152h149.314c39.306 0 71.282-32.246 71.282-71.552 0-11.28-9.145-20.56-20.426-20.56s-20.426 9.077-20.426 20.359c0 3.419-.575 6.941-1.619 10.01-4.082 11.998-15.451 20.893-28.812 20.893H157.553c-46.995 0-85.535 36.766-88.331 83.064H20.021C8.739 217.631 0 226.296 0 237.578v170.345c0 11.28 8.739 20.773 20.021 20.773H491.98c11.28 0 20.021-9.492 20.021-20.773V237.578c-.001-11.282-8.74-19.947-20.022-19.947zm-20.83 170.213H40.851V258.482h430.298v129.362z\"/><path d=\"M113.021 273.461H89.872c-11.28 0-20.426 9.145-20.426 20.426s9.145 20.426 20.426 20.426h23.149c11.28 0 20.426-9.145 20.426-20.426s-9.145-20.426-20.426-20.426zM190.638 273.461h-23.149c-11.28 0-20.426 9.145-20.426 20.426s9.145 20.426 20.426 20.426h23.149c11.28 0 20.426-9.145 20.426-20.426s-9.145-20.426-20.426-20.426zM268.255 273.461h-23.149c-11.28 0-20.426 9.145-20.426 20.426s9.145 20.426 20.426 20.426h23.149c11.28 0 20.426-9.145 20.426-20.426s-9.145-20.426-20.426-20.426zM345.872 273.461h-23.149c-11.28 0-20.426 9.145-20.426 20.426s9.145 20.426 20.426 20.426h23.149c11.28 0 20.426-9.145 20.426-20.426s-9.145-20.426-20.426-20.426zM423.489 273.461H400.34c-11.28 0-20.426 9.145-20.426 20.426s9.145 20.426 20.426 20.426h23.149c11.28 0 20.426-9.145 20.426-20.426s-9.145-20.426-20.426-20.426zM113.021 325.206H89.872c-11.28 0-20.426 9.145-20.426 20.426s9.145 20.425 20.426 20.425h23.149c11.28 0 20.426-9.145 20.426-20.425s-9.145-20.426-20.426-20.426zM423.489 325.206H400.34c-11.28 0-20.426 9.145-20.426 20.426s9.145 20.425 20.426 20.425h23.149c11.28 0 20.426-9.145 20.426-20.425s-9.145-20.426-20.426-20.426zM345.872 329.291H167.489c-11.28 0-20.426 9.145-20.426 20.426s9.145 20.426 20.426 20.426h178.383c11.28 0 20.426-9.145 20.426-20.426s-9.145-20.426-20.426-20.426z\"/></svg>;\nfunction scrollToBottom(el) {\nvar y = el.box(#height, #content) - el.box(#height, #client);\nel.scrollTo(0, y);\n}\nfunction getNowStr() {\nvar now = new Date();\nreturn String.printf(\"%02d:%02d:%02d\", now.hour, now.minute, now.second);\n}\n/******************** start of chatbox ****************************************/\nclass ChatBox: Reactor.Component {\nthis var msgs = [];\nthis var callback;\nfunction this(params) {\nif (params) {\nthis.msgs = params.msgs || [];\nthis.callback = params.callback;\n}\n}\nfunction renderMsg(msg) {\nvar cls = msg.name == \"me\" ? \"right-side msg\" : \"left-side msg\";\nreturn <div class={cls}>\n{msg.name == \"me\" ?\n<div .name>{msg.time + \"  \"} me</div> :\n<div .name>{msg.name} {\"  \" + msg.time}</div>\n}\n<div .text>{msg.text}</div>\n</div>;\n}\nfunction render() {\nvar me = this;\nvar msgs = this.msgs.map(function(msg) { return me.renderMsg(msg); });\nself.timer(1ms, function() {\nscrollToBottom(me.msgs);\n});\nreturn <div .chatbox>\n<htmlarea spellcheck=\"false\" readonly .msgs @{this.msgs} >\n{msgs}\n</htmlarea>\n<div .send>\n<input|text .outline-focus />\n<span>{svg_send}</span>\n</div>\n</div>;\n}\nfunction send() {\nvar el = this.$(input);\nvar value = (el.value || \"\").trim();\nel.value = \"\";\nif (!value) return;\nif (this.callback) this.callback(value);\n}\nevent keydown $(input) (evt) {\nif (!evt.shortcutKey) {\nif (isEnterKey(evt)) {\nthis.send();\n}\n}\n}\nevent click $(div.send span) {\nthis.send();\nview.focus = $(input);\n}\n}\n/******************** end of chatbox ****************************************/\n/******************** start of msgbox ****************************************/\nvar remember_password = false;\nvar last_msgbox_tag = \"\";\nfunction msgbox(type, title, content, link=\"\", callback=null, height=180, width=500, hasRetry=false, contentStyle=\"\") {\n$(body).scrollTo(0, 0);\nif (!type) {\ncloseMsgbox();\nreturn;\n}\nvar remember = false;\ntry { remember = handler.get_remember(); } catch(e) {}\nvar autoLogin = false;\ntry { autoLogin = handler.get_option(\"auto-login\") != ''; } catch(e) {}\nwidth += is_xfce ? 50 : 0;\nheight += is_xfce ? 50 : 0;\nif (type.indexOf(\"input-password\") >= 0) {\ncallback = function (res) {\nif (!res) {\nview.close();\nreturn;\n}\nhandler.login(\"\", \"\", res.password, res.remember);\nif (!is_port_forward) {\n// Specially handling file transfer for no permission hanging issue (including 60ms\n// timer in setPermission.\n// For wrong password input hanging issue, we can not use handler.msgbox.\n// But how about wrong password for file transfer?\nif (is_file_transfer) handler.msgbox(\"connecting\", \"Connecting...\", \"Logging in...\");\nelse msgbox(\"connecting\", \"Connecting...\", \"Logging in...\");\n}\n};\n} else if (type.indexOf(\"input-2fa\") >= 0) {\ncallback = function (res) {\nif (!res) {\nview.close();\nreturn;\n}\nhandler.send2fa(res.code);\nmsgbox(\"connecting\", \"Connecting...\", \"Logging in...\");\n};\n} else if (type == \"session-login\" || type == \"session-re-login\") {\ncallback = function (res) {\nif (!res) {\nview.close();\nreturn;\n}\nhandler.login(res.osusername, res.ospassword, \"\", false);\nif (!is_port_forward) {\nif (is_file_transfer) handler.msgbox(\"connecting\", \"Connecting...\", \"Logging in...\");\nelse msgbox(\"connecting\", \"Connecting...\", \"Logging in...\");\n}\n};\n} else if (type.indexOf(\"session-login\") >= 0) {\ncallback = function (res) {\nif (!res) {\nview.close();\nreturn;\n}\nhandler.login(res.osusername, res.ospassword, res.password, res.remember);\nif (!is_port_forward) {\nif (is_file_transfer) handler.msgbox(\"connecting\", \"Connecting...\", \"Logging in...\");\nelse msgbox(\"connecting\", \"Connecting...\", \"Logging in...\");\n}\n};\n} else if (type.indexOf(\"custom\") < 0 && !is_port_forward && !callback) {\ncallback = function() { view.close(); }\n} else if (type == 'wait-remote-accept-nook') {\ncallback = function (res) {\nif (!res) {\nview.close();\nreturn;\n}\n};\n}\nlast_msgbox_tag = type + \"-\" + title + \"-\" + content + \"-\" + link;\n$(#msgbox).content(<MsgboxComponent width={width} height={height} autoLogin={autoLogin} type={type} title={title} content={content} link={link} remember={remember} callback={callback} contentStyle={contentStyle} hasRetry={hasRetry} />);\n}\nfunction connecting() {\nhandler.msgbox(\"connecting\", \"Connecting...\", \"Connection in progress. Please wait.\");\n}\nhandler.msgbox = function(type, title, text, link = \"\", hasRetry=false) {\n// crash somehow (when input wrong password), even with small time, for example, 1ms\nself.timer(60ms, function() { msgbox(type, title, text, link, null, 180, 500, hasRetry); });\n}\nhandler.cancel_msgbox = function(tag) {\nif (last_msgbox_tag == tag) {\ncloseMsgbox();\n}\n}\nvar reconnectTimeout = 1000;\nhandler.msgbox_retry = function(type, title, text, link, hasRetry) {\nhandler.msgbox(type, title, text, link, hasRetry);\nif (hasRetry) {\nself.timer(0, retryConnect);\nself.timer(reconnectTimeout, retryConnect);\nreconnectTimeout *= 2;\n} else {\nreconnectTimeout = 1000;\n}\n}\nfunction retryConnect(cancelTimer=false) {\nif (cancelTimer) self.timer(0, retryConnect);\nif (!is_port_forward) connecting();\nhandler.reconnect(false);\n}\n/******************** end of msgbox ****************************************/\nfunction Progress()\n{\nvar _val;\nvar pos = -0.25;\nfunction step() {\nif( _val !== undefined ) { this.refresh(); return false; }\npos += 0.02;\nif( pos > 1.25)\npos = -0.25;\nthis.refresh();\nreturn true;\n}\nfunction paintNoValue(gfx)\n{\nvar (w,h) = this.box(#dimension,#inner);\nvar x = pos * w;\nw = w * 0.25;\ngfx.fillColor( this.style#color )\n.pushLayer(#inner-box)\n.rectangle(x,0,w,h)\n.popLayer();\nreturn true;\n}\nthis[#value] = property(v) {\nget return _val;\nset {\n_val = undefined;\npos = -0.25;\nthis.paintContent = paintNoValue;\nthis.animate(step);\nthis.refresh();\n}\n}\nthis.value = \"\";\n}\nvar svg_eye_cross = <svg viewBox=\"0 -21 511.96 511\">\n<path d=\"m506.68 261.88c7.043-16.984 7.043-36.461 0-53.461-41.621-100.4-140.03-165.27-250.71-165.27-46.484 0-90.797 11.453-129.64 32.191l-68.605-68.609c-8.3438-8.3398-21.824-8.3398-30.168 0-8.3398 8.3398-8.3398 21.824 0 30.164l271.49 271.49 86.484 86.488 68.676 68.672c4.1797 4.1797 9.6406 6.2695 15.102 6.2695 5.4609 0 10.922-2.0898 15.082-6.25 8.3438-8.3398 8.3438-21.824 0-30.164l-62.145-62.145c36.633-27.883 66.094-65.109 84.438-109.38zm-293.91-100.1c12.648-7.5742 27.391-11.969 43.199-11.969 47.062 0 85.332 38.273 85.332 85.336 0 15.805-4.3945 30.547-11.969 43.199z\"/>\n<path d=\"m255.97 320.48c-47.062 0-85.336-38.273-85.336-85.332 0-3.0938 0.59766-6.0195 0.91797-9.0039l-106.15-106.16c-25.344 24.707-46.059 54.465-60.117 88.43-7.043 16.98-7.043 36.457 0 53.461 41.598 100.39 140.01 165.27 250.69 165.27 34.496 0 67.797-6.3164 98.559-18.027l-89.559-89.559c-2.9844 0.32031-5.9062 0.91797-9 0.91797z\"/>\n</svg>;\nclass PasswordComponent: Reactor.Component {\nthis var visible = false;\nthis var value = '';\nthis var name = 'password';\nfunction this(params) {\nif (params && params.value) {\nthis.value = params.value;\n}\nif (params && params.name) {\nthis.name = params.name;\n}\n}\nfunction render() {\nreturn <div .password>\n<input name={this.name} value={this.value} type={this.visible ? \"text\" : \"password\"} .outline-focus />\n{this.visible ? svg_eye_cross : svg_eye}\n</div>;\n}\nevent click $(svg) {\nvar el = this.$(input);\nvar value = el.value;\nvar start = el.xcall(#selectionStart) || 0;\nvar end = el.xcall(#selectionEnd);\nthis.update({ visible: !this.visible });\nvar me = this;\nself.timer(30ms, function() {\nvar el = me.$(input);\nview.focus = el;\nel.value = value;\nel.xcall(#setSelection, start, end);\n});\n}\n}\n// type: #post, #get, #delete, #put\nfunction httpRequest(url, type, params, _onSuccess, _onError, headers=\"\") {\nif (type != #post) {\nstderr.println(\"only post ok\");\n}\nhandler.post_request(url, JSON.stringify(params), headers);\nfunction check_status() {\nvar status = handler.get_async_job_status();\nif (status == \" \") self.timer(0.1s, check_status);\nelse {\ntry {\nvar data = JSON.parse(status || \"{}\");\n_onSuccess(data);\n} catch (e) {\n_onError(status, 0);\n}\n}\n}\ncheck_status();\n}\nfunction isReasonableSize(r) {\nvar x = r[0];\nvar y = r[1];\nvar n = scaleIt(3200);\nreturn !(x < -n || x > n || y < -n || y > n);\n}\nfunction awake() {\nview.windowState = View.WINDOW_SHOWN;\nview.focus = self;\n}\nclass MultipleSessionComponent extends Reactor.Component {\nthis var sessions = [];\nthis var messageText = translate(\"Please select the session you want to connect to\");\nfunction this(params) {\nif (params && params.sessions) {\nthis.sessions = params.sessions;\n}\n}\nfunction render() {\nreturn <div .user-session>\n<div .title>{this.messageText}</div>\n<select>\n{this.sessions.map(session =>\n<option value={session.sid}>{session.name}</option>\n)}\n</select>\n</div>;\n}\n}";
const _INDEX: &[u8; 82133] = b"<html>\n<head>\n<style>\n@import url(common.css);\nhtml {\nbackground-color: transparent;\n}\nbody {\noverflow: hidden;\n}\n@media platform != \"OSX\" {\nbody {\nborder-top: color(border) solid 1px;\n}\n}\n.title {\nfont-size: 1.4em;\n}\n.app {\nflow: horizontal;\nsize: *;\n}\n.lighter-text {\ncolor: color(lighter-text);\nfont-size: 0.9em;\n}\n.left-pane {\nwidth: 200px;\nheight: *;\nbackground: color(bg);\nborder-right: color(border) 1px solid;\n}\n#ab .left-pane {\nborder-radius: 1em;\npadding: 1em;\n}\n#ab .right-pane {\nbackground: none;\n}\n#ab .right-content {\noverflow: unset;\n}\n.left-pane > div:nth-child(1) {\nborder-spacing: 1em;\npadding: 20px;\n}\n.left-pane div {\nword-wrap: break-word;\n}\ndiv.sessions-bar {\ncolor: color(light-text);\npadding-top: 0.5em;\nborder-top: color(border) solid 1px;\nmargin-bottom: 1em;\nposition: relative;\nflow: horizontal;\n}\ndiv.sessions-tab span {\ndisplay: inline-block;\npadding: 6px 8px;\ncursor: pointer;\n@ELLIPSIS;\n}\ndiv.sessions-tab svg {\nsize: 14px;\n}\ndiv.sessions-tab span.active {\ncursor: default;\nborder-radius: 3px;\nbackground: color(bg);\ncolor: color(text);\n}\ndiv.search-id {\nwidth: 120px;\npadding: 0;\nposition: relative;\ndisplay: inline-block;\n}\ndiv.search-id input {\nfont-size: 1em;\nheight: 20px;\nborder: none;\npadding-left: 26px;\n}\ndiv.search-id span {\nposition: absolute;\ntop: 0px;\npadding: 6px;\ncolor: color(border);\n}\ndiv.search-id svg {\nsize: 14px;\n}\nspan.search-icon {\nleft: 0px;\n}\nspan.clear-input {\ndisplay: none;\nright: 0px;\n}\ndiv.search-id:hover span.clear-input {\ndisplay: inline-block;\n}\nspan.clear-input:hover {\ncolor: black;\n}\n.your-desktop {\nborder-spacing: 0.5em;\nborder-left: color(accent) solid 2px;\npadding-left: 0.5em;\n}\n.your-desktop input[type=text] {\npadding: 0;\nborder: none;\nheight: 1.5em;\n}\n.your-desktop > div {\ncolor: color(light-text);\n}\n.right-pane {\nsize: *;\nbackground: color(gray-bg);\n}\n.right-content {\noverflow: scroll-indicator;\npadding: 1.6em;\nborder-spacing: 1.6em;\nsize: *;\nflow: vertical;\n}\n@media platform == \"OSX\" {\n.right-pane {\nbackground: color(gray-bg-osx);\n}\n}\n@mixin CARD {\npadding: 1.6em;\nborder-spacing: 1em;\nbackground: color(bg);\nborder-radius: 1em;\n}\n.card-connect {\n@CARD;\nwidth: 320px;\n}\n.right-buttons {\ntext-align: right;\n}\n.right-buttons>button {\nmargin-left: 1.6em;\n}\ndiv.connect-status {\nleft: 240px;\nborder-top: color(border) solid 1px;\nwidth: 100%;\npadding: 1em;\n}\ndiv.connect-status > span.connect-status-icon {\nborder-radius: 4px;\nwidth: 8px;\nheight: 8px;\ndisplay: inline-block;\nmargin-right: 1em;\n}\ndiv.connect-status > span.link {\nmargin-left: 1em;\ndisplay: inline-block;\n}\nspan.connect-status-1 {\nbackground: #e04f5f;\n}\nspan.connect-status1 {\nbackground: #32bea6;\n}\nspan.connect-status0 {\nbackground: #F5853B;\n}\ndiv.recent-sessions-content {\nborder-spacing: 1em;\nflow: horizontal-flow;\n}\ndiv.remote-session {\nborder-radius: 1em;\nheight: 140px;\nwidth: 220px;\npadding: 0;\nposition: relative;\nborder: none;\n}\ndiv.remote-session:hover, div.remote-session-list:hover {\noutline: color(button) solid 2px -2px;\n}\ndiv.remote-session .platform {\nwidth: *;\nheight: 120px;\npadding: *;\nposition: relative;\n}\ndiv.remote-session .platform .username{\nleft: 0;\ncolor: #eee;\nposition: absolute;\nbottom: 38px;\nfont-size: 0.8em;\nwidth: 220px;\ntext-align: center;\n}\ndiv.remote-session .platform svg {\nwidth: 60px;\nheight: 60px;\nbackground: none;\n}\ndiv.remote-session-list {\nbackground: color(bg);\nwidth: 220px;\nflow: horizontal;\n}\ndiv.remote-session-list .platform {\nsize: 42px;\n}\ndiv.remote-session-list .platform svg {\nwidth: 30px;\nheight: 30px;\nbackground: none;\npadding: 6px;\n}\ndiv.remote-session-list .name {\nsize: *;\npadding-left: 1em;\n}\ndiv.remote-session-list .name >div {\nmargin-top: *;\nmargin-bottom: *;\nwidth: *;\n}\ndiv.remote-session-list .name .username {\nmargin-top: 3px;\nfont-size: 0.8em;\ncolor: color(lighter-text);\n}\ndiv.remote-session .text {\nbackground: color(bg);\nposition: absolute;\nheight: 3em;\nwidth: 100%;\nborder-radius: 0 0 1em 1em;\nbottom: 0;\nflow: horizontal;\n}\ndiv.remote-session .text > div {\npadding-top: 1em;\npadding-left: 1em;\nwidth: *;\n}\nsvg#menu {\nsize: 1em;\nbackground: none;\npadding: 0.5em;\nmargin: 0.5em;\ncolor: color(light-text);\n}\n.remote-session-list svg#menu {\nmargin-right: 0;\n}\nsvg#menu:hover {\ncolor: color(text);\nborder-radius: 1em;\nbackground: color(gray-bg);\n}\nsvg#edit:hover {\ncolor: color(text);\n}\nsvg#edit {\ndisplay: inline-block;\n}\ndiv.install-me, div.trust-me {\nmargin-top: 0.5em;\npadding: 20px;\ncolor: white;\nbackground: linear-gradient(left,#e242bc,#f4727c);\n}\ndiv.trust-me > div:nth-child(1),\ndiv.install-me > div:nth-child(1) {\nfont-size: 1.2em;\nfont-weight: bold;\ntext-align: center;\nmargin-bottom: 0.5em;\n}\ndiv.install-me > div:nth-child(2) {\nline-height: 1.4em;\n}\n#install-me.link {\nmargin-top: 0.5em;\n}\ndiv.trust-me > div:nth-child(2) {\nfont-size: 0.9em;\nmargin-bottom: 1em;\n}\ndiv.install-me > div:nth-child(3),\ndiv.trust-me > div:nth-child(3) {\ntext-align: center;\nfont-size: 1.5em;\nfont-weight: bold;\n}\ndiv.trust-me > div:nth-child(4),\ndiv.trust-me > div:nth-child(5) {\nmargin-top: 0.5em;\ntext-align: center;\n}\ndiv#myid, div#tags-label {\nposition: relative;\n}\ndiv#myid svg#menu, div#tags-label svg#menu {\nposition: absolute;\nright: -1em;\n}\ndiv#tags-label svg#menu:hover {\nbackground-color: #ddd;\n}\ndiv.remote-session svg#menu {\nposition: absolute;\nright: 0;\ntop: 0;\n}\n.install-me .button {\nheight: 2em;\nline-height: 2em;\ntext-align: center;\nfont-weight: bold;\nfont-size: 1em;\nmargin-top: 1em;\nborder-color: white;\nborder: 1px;\nbackground: none;\ncolor: white;\n}\nsvg#refresh-password {\ndisplay: inline-block;\nstroke:#ddd;\n}\nsvg#refresh-password:hover {\nstroke:color(text);\n}\nli:disabled, li:disabled:hover {\ncolor: color(lighter-text);\nbackground: color(menu);\n}\n@media platform == \"OSX\" {\ndiv.eye-area > input {\nfont-size: 1em;\n}\n}\n</style>\n<script type=\"text/tiscript\">\ninclude \"common.tis\";\nfunction translate_text(text) {\nif (text.indexOf('Failed') == 0 && text.indexOf(': ') > 0) {\nvar fds = text.split(': ');\nfor (var i = 0; i < fds.length; ++i) {\nfds[i] = translate(fds[i]);\n}\ntext = fds.join(': ');\n} else {\nvar fds = text.split(' ');\nif (fds.length > 1 && fds[0].slice(-4) === '_tip') {\nfds[0] = translate(fds[0]);\nvar rest = text.substring(fds[0].length + 1);\ntext = fds[0] + ' ' + translate(rest);\n} else {\ntext = translate(text);\n}\n}\nreturn text;\n}\nvar msgboxTimerFunc = function() {}\nfunction closeMsgbox() {\nself.timer(0, msgboxTimerFunc);\n$(#msgbox).content(<span />);\n}\nclass MsgboxComponent: Reactor.Component {\nfunction this(params) {\nthis.width = params.width;\nthis.height = params.height;\nthis.type = params.type;\nthis.title = params.title;\nthis.content = params.content;\nthis.link = params.link;\nthis.remember = params.remember;\nthis.callback = params.callback;\nthis.hasRetry = params.hasRetry;\nthis.autoLogin = params.autoLogin;\nthis.contentStyle = params.contentStyle;\ntry { this.content = translate_text(this.content); } catch (e) {}\n}\nfunction getIcon(color) {\nif (this.type == \"input-password\" || this.type == \"session-login\" || this.type == \"session-login-password\" || this.type == \"input-2fa\") {\nreturn <svg viewBox=\"0 0 505 505\"><circle cx=\"252.5\" cy=\"252.5\" r=\"252.5\" fill={color}/><path d=\"M271.9 246.1c29.2 17.5 67.6 13.6 92.7-11.5 29.7-29.7 29.7-77.8 0-107.4s-77.8-29.7-107.4 0c-25.1 25.1-29 63.5-11.5 92.7L118.1 347.4l26.2 26.2 26.4 26.4 10.6-10.6-10.1-10.1 9.7-9.7 10.1 10.1 10.6-10.6-10.1-10 9.7-9.7 10.1 10.1 10.6-10.6-26.4-26.3 76.4-76.5z\" fill=\"#fff\"/><circle cx=\"337.4\" cy=\"154.4\" r=\"17.7\" fill={color}/></svg>;\n}\nif (this.type == \"connecting\") {\nreturn <svg viewBox=\"0 0 300 300\"><g fill={color}><path d=\"m221.76 89.414h-143.51c-1.432 0-2.594 1.162-2.594 2.594v95.963c0 1.432 1.162 2.594 2.594 2.594h143.51c1.432 0 2.594-1.162 2.594-2.594v-95.964c0-1.431-1.162-2.593-2.594-2.593z\"/><path d=\"m150 0c-82.839 0-150 67.161-150 150s67.156 150 150 150 150-67.163 150-150-67.164-150-150-150zm92.508 187.97c0 11.458-9.29 20.749-20.749 20.749h-47.144v11.588h23.801c4.298 0 7.781 3.483 7.781 7.781s-3.483 7.781-7.781 7.781h-96.826c-4.298 0-7.781-3.483-7.781-7.781s3.483-7.781 7.781-7.781h23.801v-11.588h-47.145c-11.458 0-20.749-9.29-20.749-20.749v-95.963c0-11.458 9.29-20.749 20.749-20.749h143.51c11.458 0 20.749 9.29 20.749 20.749v95.963z\"/></g><path d=\"m169.62 154.35c-5.0276-5.0336-11.97-8.1508-19.624-8.1508-7.6551 0-14.597 3.1172-19.624 8.1508l-11.077-11.091c7.8656-7.8752 18.725-12.754 30.701-12.754s22.835 4.8788 30.701 12.754l-11.077 11.091zm-32.184 7.0728 12.56 12.576 12.56-12.576c-3.2147-3.2172-7.6555-5.208-12.56-5.208-4.9054 0-9.3457 1.9908-12.56 5.208zm12.56-39.731c14.403 0 27.464 5.8656 36.923 15.338l11.078-11.091c-12.298-12.314-29.276-19.94-48-19.94-18.724 0-35.703 7.626-48 19.94l11.077 11.091c9.4592-9.4728 22.52-15.338 36.923-15.338z\" fill=\"#fff\"/></svg>;\n}\nif (this.type == \"success\") {\nreturn <svg viewBox=\"0 0 512 512\"><circle cx=\"256\" cy=\"256\" r=\"256\" fill={color} /><path fill=\"#fff\" d=\"M235.472 392.08l-121.04-94.296 34.416-44.168 74.328 57.904 122.672-177.016 46.032 31.888z\"/></svg>;\n}\nif (this.type.indexOf(\"error\") >= 0 || this.type == \"re-input-password\" || this.type == \"input-2fa\" || this.type == \"session-re-login\" || this.type == \"session-login-re-password\") {\nreturn <svg viewBox=\"0 0 512 512\"><ellipse cx=\"256\" cy=\"256\" rx=\"256\" ry=\"255.832\" fill={color}/><g fill=\"#fff\"><path d=\"M376.812 337.18l-39.592 39.593-201.998-201.999 39.592-39.592z\"/><path d=\"M376.818 174.825L174.819 376.824l-39.592-39.592 201.999-201.999z\"/></g></svg>;\n}\nreturn null;\n}\nfunction getInputPasswordContent() {\nvar ts = this.remember ? { checked: true } : {};\nreturn <div .form>\n<div>{translate('Please enter your password')}</div>\n<PasswordComponent />\n<div><button|checkbox(remember) {ts}>{translate('Remember password')}</button></div>\n</div>;\n}\nfunction get2faContent() {\nreturn <div .form>\n<div>{translate('enter-2fa-title')}</div>\n<div .code><input name='code' type='text' .outline-focus /></div>\n</div>;\n}\nfunction getInputUserPasswordContent() {\nreturn <div .form>\n<div>{translate(\"OS Username\")}</div>\n<div .username><input name='osusername' type='text' .outline-focus /></div>\n<div>{translate(\"OS Password\")}</div>\n<PasswordComponent name='ospassword' />\n<div></div>\n</div>;\n}\nfunction getXsessionPasswordContent() {\nreturn <div .form>\n<div>{translate(\"OS Username\")}</div>\n<div .username><input name='osusername' type='text' .outline-focus /></div>\n<div>{translate(\"OS Password\")}</div>\n<PasswordComponent name='ospassword' />\n<div>{translate('Please enter your password')}</div>\n<PasswordComponent />\n<div><button|checkbox(remember) {ts}>{translate('Remember password')}</button></div>\n</div>;\n}\nfunction getContent() {\nif (this.type == \"input-password\") {\nreturn this.getInputPasswordContent();\n} else if (this.type == \"input-2fa\") {\nreturn this.get2faContent();\n} else if (this.type == \"session-login\") {\nreturn this.getInputUserPasswordContent();\n} else if (this.type == \"session-login-password\") {\nreturn this.getXsessionPasswordContent();\n} else if (this.type == \"custom-os-password\") {\nvar ts = this.autoLogin ? { checked: true } : {};\nreturn <div .form>\n<PasswordComponent value={this.content} />\n<div><button|checkbox(autoLogin) {ts} style=\"width: *; word-wrap: break-word; overflow-wrap: break-word; white-space: normal; height: auto; overflow: hidden;\">{translate('Auto Login')}</button></div>\n</div>;\n}\nreturn this.content;\n}\nfunction getColor() {\nif (this.type == \"input-password\" || this.type == \"input-2fa\" || this.type == \"custom-os-password\" || this.type == \"session-login\" || this.type == \"session-login-password\") {\nreturn \"#AD448E\";\n}\nif (this.type == \"success\") {\nreturn \"#32bea6\";\n}\nif (this.type.indexOf(\"error\") >= 0 || this.type == \"re-input-password\" || this.type == \"session-re-login\" || this.type == \"session-login-re-password\") {\nreturn \"#e04f5f\";\n}\nreturn \"#2C8CFF\";\n}\nfunction hasSkip() {\nreturn this.type.indexOf(\"skip\") >= 0;\n}\nfunction render() {\nthis.set_outline_focus();\nvar color = this.getColor();\nvar icon = this.getIcon(color);\nvar content = this.getContent();\nvar hasCancel = this.type.indexOf(\"error\") < 0 && this.type.indexOf(\"nocancel\") < 0 && this.type != \"restarting\";\nvar hasOk = this.type != \"connecting\" && this.type != \"success\" && this.type.indexOf(\"nook\") < 0;\nvar hasLink = this.link != \"\";\nvar hasClose = this.type.indexOf(\"hasclose\") >= 0;\nvar show_progress = this.type == \"connecting\";\nvar me = this;\nself.timer(0, msgboxTimerFunc);\nmsgboxTimerFunc = function() {\nif (typeof content == \"string\")\nme.$(#content).html = translate(content);\nelse\nme.$(#content).content(content);\n};\nself.timer(3ms, msgboxTimerFunc);\nreturn (<div><div style=\"position: absolute; size:*; background:black; opacity:0.5;\" />\n<div style=\"size: *; position: absolute;\">\n<div style={\"border: \" + color + \" solid 1px; background: color(bg); margin: *; width:\" + (this.width) + \"px; min-height:\" + (this.height) + \"px\"}>\n<div .caption style={\"background: \" + color}>\n{translate(this.title)}\n</div>\n<div style=\"padding: 1em 2em; size: *;\">\n<div style=\"height: *; flow: horizontal\">\n{icon && <div style=\"height: *; margin: * 0; padding-right: 2em;\" .msgbox-icon>{icon}</div>}\n<div style={this.contentStyle || \"size: *; margin: * 0;\"} #content />\n</div>\n<div style=\"text-align: right;\">\n<span style=\"display:inline-block; max-width: 250px; font-size:12px;\" #error />\n<progress #progress style={\"color:\" + color + \"; display: \" + (show_progress ? \"inline-block\" : \"none\")} />\n{hasCancel || this.hasRetry ? <button .button #cancel .outline>{translate(this.hasRetry ? \"OK\" : \"Cancel\")}</button> : \"\"}\n{this.hasSkip() ? <button .button #skip .outline>{translate('Skip')}</button> : \"\"}\n{hasOk || this.hasRetry ? <button .button #submit>{translate(this.hasRetry ? \"Retry\" : \"OK\")}</button> : \"\"}\n{hasLink ? <button .button #jumplink .outline>{translate('JumpLink')}</button> : \"\"}\n{hasClose ? <button .button #cancel .outline>{translate('Close')}</button> : \"\"}\n</div>\n</div>\n</div>\n</div></div>);\n}\nevent click $(.custom-event) (_, me) {\nif (this.callback) this.callback(me);\n}\nfunction submit() {\nif (this.$(button#submit)) {\nthis.$(button#submit).sendEvent(\"click\");\n}\n}\nfunction cancel() {\nif (this.$(button#cancel)) {\nthis.$(button#cancel).sendEvent(\"click\");\n}\n}\nevent click $(button#cancel) {\nthis.close();\nif (this.callback) this.callback(null);\n}\nevent click $(button#skip) {\nvar values = this.getValues();\nvalues.skip = true;\nif (this.callback) this.callback(values);\nif (this.close) this.close();\n}\nevent click $(button#jumplink) {\nif (this.link.indexOf(\"http\") == 0) {\nSciter.launch(this.link);\n}\n}\nevent click $(button#submit) {\nif (this.type == \"error\") {\nif (this.hasRetry) {\nretryConnect(true);\nreturn;\n}\n}\nif (this.type == \"re-input-password\") {\nthis.type = \"input-password\";\nthis.update();\nreturn;\n}\nif (this.type == \"session-re-login\") {\nthis.type = \"session-login\";\nthis.update();\nreturn;\n}\nif (this.type == \"session-login-re-password\") {\nthis.type = \"session-login-password\";\nthis.update();\nreturn;\n}\nvar values = this.getValues();\nif (this.callback) {\nvar self = this;\nvar err = this.callback(values, function(a=1, b='') { self.show_progress(a, b); });\nif (!err) {\nif (this.close) this.close();\nreturn;\n}\nif (err && err.trim()) this.show_progress(false, err);\n} else {\nthis.close();\n}\n}\nevent keydown (evt) {\nif (!evt.shortcutKey) {\nif (isEnterKey(evt)) {\nthis.submit();\n}\nif (evt.keyCode == Event.VK_ESCAPE) {\nthis.cancel();\n}\n}\n}\nevent click $(button#select_directory) {\nvar folder = view.selectFolder(translate(\"Change\"), $(#folderPath).text);\nif (folder) {\nif (folder.indexOf(\"file://\") == 0) folder = folder.substring(7);\n$(#folderPath).text = folder;\n}\n}\nfunction show_progress(show=1, err=\"\") {\nif (show == -1) {\nthis.close()\nreturn;\n}\nthis.$(#progress).style.set {\ndisplay: show ? \"inline-block\" : \"none\"\n};\nthis.$(#error).text = err;\n}\nfunction getValues() {\nvar values = { type: this.type };\nfor (var el in this.$$(.form input)) {\nvalues[el.attributes[\"name\"]] = el.value;\n}\nfor (var el in this.$$(.form textarea)) {\nvalues[el.attributes[\"name\"]] = el.value;\n}\nfor (var el in this.$$(.form button)) {\nvalues[el.attributes[\"name\"]] = el.value;\n}\nif (this.type == \"input-password\") {\nvalues.password = (values.password || \"\").trim();\nif (!values.password) {\nreturn;\n}\n}\nif (this.type == \"input-2fa\") {\nvalues.code = (values.code || \"\").trim();\nif (!values.code) {\nreturn;\n}\n}\nif (this.type == \"session-login\") {\nvalues.osusername = (values.osusername || \"\").trim();\nvalues.ospassword = (values.ospassword || \"\").trim();\nif (!values.osusername || !values.ospassword) {\nreturn;\n}\n}\nif (this.type == \"session-login-password\") {\nvalues.password = (values.password || \"\").trim();\nvalues.osusername = (values.osusername || \"\").trim();\nvalues.ospassword = (values.ospassword || \"\").trim();\nif (!values.osusername || !values.ospassword || !values.password) {\nreturn;\n}\n}\nif (this.type == \"multiple-sessions-nocancel\") {\nvalues.sid = (this.$$(select))[0].value;\n}\nreturn values;\n}\nfunction set_outline_focus() {\nvar me = this;\nself.timer(30ms, function() {\nvar el = me.$(.outline-focus);\nif (el) view.focus = el;\nelse {\nel = me.$(#submit);\nif (el) {\nview.focus = el;\n}\n}\n});\n}\nfunction close() {\ncloseMsgbox();\n}\n}\nvar selectTags = [];\nvar ab = { tags: [], peers: [] };\nvar abLoading;\nvar abError;\nvar current_menu_peer_id = '';\nvar current_menu_tag = '';\nclass AddressBook: Reactor.Component\n{\nthis var style;\nthis var selectedTags = function() {\nvar tags = handler.get_local_option(\"selected-tags\");\nif (tags) return tags.split(\",\");\nreturn [];\n}();\nfunction render() {\nif (!handler.get_local_option(\"access_token\")) {\nreturn <div style=\"margin: *\"><div #login-link .link style=\"margin: *; width: 100px; text-align: center; font-size: 1.2em;\">{translate(\"Login\")}</div></div>;\n}\nif (abLoading) {\nreturn <div style=\"margin: *\"><progress style=\"color: #0071ff\" /></div>;\n} else if (abError) {\nreturn <div style=\"margin: *; text-align: center;\">{abError}\n<div #retry .link style=\"margin-left: 1em;\">{translate(\"Retry\")}</div>\n</div>;\n}\nvar peers = this.getPeers();\nvar me = this;\nreturn <div .app #ab style=\"size:*\">\n<popup>\n<menu.context #ab-context>\n<li #add-id>{translate('Add ID')}</li>\n<li #add-tag>{translate('Add Tag')}</li>\n<li #unselect-tags>{translate('Unselect all tags')}</li>\n</menu>\n<menu.context #tag-context>\n<li #remove-tag>{translate('Remove')}</li>\n</menu>\n</popup>\n<div .left-pane>\n<div style=\"padding: 0; padding-bottom: 1em\" #tags-label>{translate('Tags')}{svg_menu}</div>\n<div #tags>\n{ab.tags.map(function(t) {\nreturn <span class={me.selectedTags.indexOf(t) >= 0 ? \"active\" : \"inactive\"}>{t}</span>;\n})}\n</div>\n</div>\n<div .right-pane>\n<div .right-content style=\"padding-top:0; padding-right: 0;\">\n<SessionList sessions={peers} type=\"ab\" />\n</div>\n</div>\n</div>;\n}\nevent mouseup $(#tags span) (evt, me) {\nif(evt.propButton) {\ncurrent_menu_tag = me.text;\nme.popup($(#tag-context));\nreturn true;\n}\n}\nevent click $(#retry) (_, __) {\nrefreshCurrentUser();\n}\nevent click $(#login-link) (_, __) {\nlogin();\n}\nevent click $(#tags-label svg#menu) (_, me) {\nme.popup($(#ab-context));\n}\nevent click $(#add-id) (_, __) {\nvar me = this;\nmsgbox(\n\"custom-add-id\",\ntranslate(\"Add ID\"),\n<div .form>\n<div>{translate(\"whitelist_sep\")}</div>\n<textarea .outline-focus spellcheck=\"false\" name=\"text\" style=\"overflow: scroll-indicator; width:*; height: 160px; font-size: 1.2em; padding: 0.5em;\"></textarea>\n</div>,\n\"\",\nfunction(res=null) {\nif (!res) return;\nvar value = (res.text || \"\").trim();\nvar values = value.split(/[\\s,;\\n]+/g);\nif (values.length == 0) return;\nfor (var v in values) {\nvar found;\nfor (var i = 0; i < ab.peers.length; ++i) {\nif (ab.peers[i].id == v) {\nfound = true;\nbreak;\n}\n}\nif (found) continue;\nab.peers.push({ id: v });\n}\nupdateAb();\nme.update();\n},\n300);\n}\nevent click $(#add-tag) (_, __) {\nvar me = this;\nmsgbox(\"custom-add-tag\", translate(\"Add Tag\"), <div .form>\n<div>{translate(\"whitelist_sep\")}</div>\n<textarea .outline-focus spellcheck=\"false\" name=\"text\" style=\"overflow: scroll-indicator; width:*; height: 160px; font-size: 1.2em; padding: 0.5em;\"></textarea>\n</div>, \"\", function(res=null) {\nif (!res) return;\nvar value = (res.text || \"\").trim();\nvar values = value.split(/[\\s,;\\n]+/g);\nif (values.length == 0) return;\nfor (var v in values) {\nif (ab.tags.indexOf(v) < 0) {\nab.tags.push(v);\n}\n}\nupdateAb();\nme.update();\n}, 300);\n}\nevent click $(#remove-tag) (_, me) {\nvar tag = current_menu_tag;\nvar i = ab.tags.indexOf(tag);\nab.tags.splice(i, 1);\nfor (var p in ab.peers) {\nif (p.tags) {\ni = p.tags.indexOf(tag);\nif (i >= 0) p.tags.splice(i, 1);\n}\n}\nupdateAb();\nthis.update();\n}\nevent click $(#unselect-tags) (_, me) {\nthis.selectedTags = [];\nhandler.set_local_option(\"selected-tags\", \"\");\nthis.update();\n}\nevent click $(#tags span) (_, me) {\nme.attributes.toggleClass('active');\nif (me.attributes.hasClass('active')) {\nthis.selectedTags.push(me.text);\n} else {\nthis.selectedTags.splice(this.selectedTags.indexOf(me.text), 1);\n}\nhandler.set_local_option(\"selected-tags\", this.selectedTags.join(','));\nthis.update();\n}\nfunction getPeers() {\nvar tags = [];\nfor (var t in this.selectedTags) {\nif (ab.tags.indexOf(t) >= 0) tags.push(t);\n}\nif (tags.length != this.selectedTags.length) {\nthis.selectedTags = tags;\nhandler.set_local_option(\"selected-tags\", tags.join(\",\"));\nstdout.println(\"updated selected tags\");\n}\nif (tags.length == 0) return ab.peers;\nvar peers = [];\nif (tags.length > 0) {\nfor (var p in ab.peers) {\nfor (var t in (p.tags || [])) {\nif (tags.indexOf(t) >= 0) {\npeers.push(p);\nbreak;\n}\n}\n}\n} else {\npeers = ab.peers;\n}\nreturn peers;\n}\n}\nclass SelectTags: Reactor.Component {\nfunction this(params) {\nselectTags = this;\nthis.tags = params.tags;\n}\nfunction render() {\nvar me = this;\nreturn <div #tags>\n{ab.tags.map(function(t) {\nreturn <span class={me.tags.indexOf(t) >= 0 ? \"active\" : \"inactive\"}>{t}</span>;\n})}\n</div>;\n}\nevent click $(#tags span) (_, me) {\nme.attributes.toggleClass('active');\nvar i = this.tags.indexOf(me.text);\nif (i < 0) {\nthis.tags.push(me.text);\n} else {\nthis.tags.splice(i, 1);\n}\n}\n}\nvar svg_tile = <svg #session-tile viewBox=\"0 0 158.6 158.6\"><path style=\"stroke-width:.309756\" d=\"M5.4 157.7c-1-.3-2-1-3.2-2.1-2.8-2.8-2.6-1-2.5-32 0-26.7 0-27 .7-28.3a9.3 9.3 0 0 1 4-4.2c1.2-.6 2.3-.6 29-.7 27.5 0 27.6 0 29.1.6.8.4 2 1.2 2.7 2 2.4 2.5 2.3.7 2.2 31.6-.1 26.5-.1 27.6-.7 28.8a9.3 9.3 0 0 1-4.2 4c-1.4.6-1.6.6-28.5.7a235 235 0 0 1-28.6-.4zm91 0a8.5 8.5 0 0 1-5.7-5.4c-.2-.7-.3-8.3-.3-28.3V96.7l.7-1.6a8.9 8.9 0 0 1 4.6-4.3c1.2-.4 3.8-.5 28.9-.4 26.6.1 27.6.1 28.8.7 1.6.8 3.2 2.5 4 4.2.7 1.4.7 1.6.7 28.3.1 31 .3 29.2-2.5 32-2.8 2.7-1 2.6-31.4 2.6-21.4 0-26.8-.1-27.9-.5zM5.3 67a8.7 8.7 0 0 1-4-3C-.5 61.6-.5 62.3-.5 33.6-.4 3.2-.5 5 2.2 2.2 5-.6 3.2-.4 34.2-.3c26.7 0 27 0 28.3.7 1.7.8 3.4 2.4 4.2 4 .6 1.2.6 2.2.7 28.8 0 25.1 0 27.7-.4 29a9 9 0 0 1-4.3 4.5l-1.6.7H33.7c-20.2 0-27.7-.1-28.4-.4Zm89.8-.3a9 9 0 0 1-4.3-4.6c-.5-1.2-.5-3.8-.5-28.9.1-26.6.2-27.6.7-28.8a9.3 9.3 0 0 1 4.2-4c1.4-.7 1.6-.7 28.3-.7 31-.1 29.2-.3 32 2.5 2.8 2.8 2.6 1 2.5 32 0 26.7 0 26.9-.7 28.3a9.3 9.3 0 0 1-4 4.2c-1.2.5-2.2.6-29 .6l-27.7.1z\" transform=\"translate(.4 .4)\"/></svg>;\nvar svg_list = <svg #session-list viewBox=\"0 0 246.8 185.8\"><path style=\"stroke-width:.482473\" d=\"M-69.2 102.7A16.5 16.5 0 0 1-67 70.4c7.3-1 15 4 17.3 11 1 3 1 8 0 10.8a16.7 16.7 0 0 1-19.5 10.5zm53-3.4a12.3 12.3 0 0 1-7-16.8c1.3-3 3.1-4.7 6-6 2.2-1 2.8-1 87.2-1 92.4 0 87-.2 90.6 2.6.9.7 2.2 2.4 3 3.7 1.2 2.2 1.4 3.1 1.4 6 0 4.8-2.3 8.6-6.8 11l-1.9 1-85.2.1c-71.9 0-85.5 0-87.3-.6zm-53.5-73c-4.7-1.5-8.6-5-10.6-9.1-1.8-4-1.8-9.8 0-13.7 1.6-3.3 4.4-6.2 7.8-8 2.2-1.2 3-1.3 7.1-1.3 4 0 5 .1 7.3 1.3a16.6 16.6 0 0 1 0 29.6c-2 1-3.4 1.4-6.5 1.5-2.2 0-4.5 0-5.1-.3zm52.3-4.8c-2.4-1.1-5.3-4-6.2-6.5-1-2.4-1-7.3.1-9.7.5-1.1 1.8-2.8 2.8-3.8 3.7-3.5-4-3.2 91-3.2h85.5l2.5 1.1a12 12 0 0 1 0 21.8l-2.5 1.2H70.2c-82.5 0-85.7 0-87.6-1zm-52.1-71.6a18 18 0 0 1-10-7.7 17 17 0 0 1-.7-15c2.3-5 5.8-7.9 11.4-9.3 9-2.3 18.3 4 19.8 13.4a16.4 16.4 0 0 1-15.2 19c-2.1.1-4.1 0-5.3-.4zm52.1-5.9c-1.3-.6-3-1.7-3.7-2.5-4.7-5-4.2-13.7 1-18 3.7-3.1-1.8-3 91.5-2.8l84.9.1 2 1a12 12 0 0 1 6.7 11c0 3-.2 3.9-1.4 6-.8 1.4-2.1 3-3 3.8-3.7 2.7 1.8 2.6-90.6 2.6h-85l-2.4-1.2z\" transform=\"translate(81.7 82.6)\"/></svg>;\nvar search_icon = <svg viewBox=\"0 0 655.278 655.024\"><g transform=\"translate(-24.497 -195.01)\"><path d=\"m649.96 847.92c-2.9592-1.3629-27.183-24.243-63.36-59.846-32.213-31.702-70.814-69.663-85.78-84.357l-27.21-26.717-4.7897 3.5287c-66.337 48.872-145.32 66.878-224.31 51.138-72.966-14.539-136.58-58.184-178.47-122.44-15.945-24.462-30.723-61.471-36.413-91.191-8.9404-46.696-6.2422-90.39 8.3388-135.04 13.39-41.003 34.756-75.42 66.479-107.09 74.506-74.377 183.71-99.89 284.22-66.397 62.352 20.777 117.67 65.579 150.79 122.12 38.716 66.101 46.59 147.55 21.43 221.66-9.9038 29.171-29.788 63.725-49.916 86.743l-7.0583 8.0717 3.0992 2.919c1.7046 1.6054 40.675 39.928 86.602 85.161 89.007 87.664 87.558 86.034 85.619 96.293-1.2888 6.8209-5.2313 12.041-11.321 14.989-6.7901 3.287-11.55 3.4093-17.952 0.46117zm-316.64-154.63c32.373-5.0481 61.075-15.115 86.553-30.358 47.942-28.683 83.505-72.09 100.89-123.14 35.043-102.91-6.4362-214.07-100.89-270.37-52.514-31.302-117.76-40.564-178.06-25.277-81.183 20.579-145.19 82.918-166.86 162.52-5.5757 20.478-7.445 35.423-7.445 59.52s1.8693 39.042 7.445 59.52c21.409 78.63 85.366 141.52 164.81 162.05 29.22 7.5511 66.493 9.756 93.564 5.5347z\" stroke-width=\"1.28\"/></g></svg>;\nvar clear_icon = <svg viewBox=\"0 0 478.94 479.03\"><path d=\"M217.488 478.45c-30.264-3.146-55.348-10.265-82.714-23.477C62.54 420.1 14.214 353.763 1.824 272.463c-2.412-15.82-2.434-50.027-.043-66.058 16.004-107.32 97.008-188.28 204.71-204.6 14.33-2.172 49.054-2.447 63-.498C323.95 8.915 371.3 32.2 409.03 69.927c37.697 37.698 61.125 85.349 68.605 139.54 1.943 14.08 1.68 48.804-.478 63-6.616 43.533-24.01 83.859-50.468 117-37.556 47.046-92.812 78.608-153.26 87.54-12.553 1.855-44.144 2.671-55.936 1.445zm42.144-32.045c15.649-1.602 29.895-4.63 44.856-9.531 78.146-25.604 133.49-94.718 141.94-177.26 6.245-60.993-16.1-123.3-59.94-167.14-55.797-55.797-139.4-75.365-213.52-49.98-77.69 26.609-131.51 94.14-140.42 176.19-4.761 43.843 6.392 91.899 30.274 130.44 41.468 66.926 119.01 105.26 196.82 97.29zm-138.69-80.346c-4.096-1.784-8.225-6.874-9.022-11.123-1.676-8.935-3.495-6.761 52.877-63.221l52.17-52.25-52.17-52.25c-56.544-56.632-54.56-54.249-52.834-63.451.924-4.923 6.905-10.904 11.828-11.828 9.201-1.726 6.819-3.71 63.451 52.834l52.25 52.169 52.25-52.169c56.632-56.544 54.25-54.56 63.451-52.834 4.923.923 10.904 6.905 11.828 11.828 1.726 9.201 3.71 6.818-52.834 63.451l-52.169 52.25 52.17 52.25c56.543 56.632 54.56 54.249 52.833 63.451-.923 4.923-6.905 10.904-11.828 11.828-9.201 1.726-6.818 3.71-63.455-52.838l-52.255-52.173-51.745 51.696c-28.496 28.469-53.01 52.166-54.56 52.742-3.766 1.4-8.515 1.26-12.234-.36z\"/></svg>;\nfunction getSessionsStyleOption(type) {\nreturn (type || \"recent\") + \"-sessions-style\";\n}\nfunction getSessionsStyle(type) {\nvar v = handler.get_local_option(getSessionsStyleOption(type));\nif (!v) v = type == \"ab\" ? \"list\" : \"tile\";\nreturn v;\n}\nvar searchPatterns = {};\nclass SearchBar: Reactor.Component {\nthis var type = \"\";\nfunction this(params) {\nthis.type = (params || {}).type || \"\";\n}\nfunction render() {\nvar value = searchPatterns[this.type] || \"\";\nvar me = this;\nself.timer(1ms, function() { (me.search_id || {}).value = value; });\nreturn <div .search-id style=\"margin-left: 12px\">\n<span .search-icon>{search_icon}</span>\n<input|text @{this.search_id} novalue={translate(\"Search ID\")} />\n{value && <span .clear-input>{clear_icon}</span>}\n</div>;\n}\nevent click $(span.clear-input) {\nthis.onChange('');\n}\nevent change $(input) (_, el) {\nthis.onChange(el.value.trim().toLowerCase());\n}\nfunction onChange(v) {\nsearchPatterns[this.type] = v;\napp.multipleSessions.update();\n}\n}\nclass SessionStyle: Reactor.Component {\nthis var type = \"\";\nfunction this(params) {\nthis.type = (params || {}).type || \"\";\n}\nfunction render() {\nvar sessionsStyle = getSessionsStyle(this.type);\nreturn <div .sessions-tab style=\"margin-left: 0.5em;\">\n<span class={sessionsStyle == \"tile\" ? \"active\" : \"inactive\"}>{svg_tile}</span>\n<span class={sessionsStyle != \"tile\" ? \"active\" : \"inactive\"}>{svg_list}</span>\n</div>;\n}\nevent click $(span.inactive) {\nvar option = getSessionsStyleOption(this.type);\nvar sessionsStyle = getSessionsStyle(this.type);\nhandler.set_local_option(option, sessionsStyle == \"tile\" ? \"list\" : \"tile\");\nif (is_linux) {\napp.multipleSessions.stupidUpdate();\n} else {\napp.multipleSessions.update();\n}\n}\n}\nclass SessionList: Reactor.Component {\nthis var sessions = [];\nthis var type = \"\";\nthis var style;\nfunction this(params) {\nthis.sessions = params.sessions;\nthis.type = params.type || \"\";\nthis.style = getSessionsStyle(this.type);\n}\nfunction getSessions() {\nvar p = searchPatterns[this.type];\nif (!p) return this.sessions;\nvar tmp = [];\nthis.sessions.map(function(s) {\nvar name = (s[4] || s.alias || \"\").toLowerCase();\nvar id = (s[0] || s.id || \"\").toLowerCase();\nvar user = (s[1] || \"\").toLowerCase();\nvar hostname = (s[2] || \"\").toLowerCase();\nif (name.indexOf(p) >= 0 || id.indexOf(p) >= 0 || user.indexOf(p) >= 0 || hostname.indexOf(p) >= 0) {\ntmp.push(s);\n}\n});\nreturn tmp;\n}\nfunction render() {\nvar sessions = this.getSessions();\nif (sessions.length == 0) {\nreturn <div style=\"margin: *; font-size: 1.6em; width: 100px; text-align: center;\">{translate(\"Empty\")}</div>;\n}\nvar me = this;\nsessions = sessions.map(function(x) { return me.getSession(x); });\nreturn <div .recent-sessions-content key={sessions.length}>\n<popup>\n<menu.context #remote-context>\n<li #connect>{translate('Connect')}</li>\n<li #transfer>{translate('Transfer file')}</li>\n<li #tunnel>{translate('TCP tunneling')}</li>\n<li #force-always-relay><span>{svg_checkmark}</span>{translate('Always connect via relay')}</li>\n<li #rdp>RDP<EditRdpPort /></li>\n<li #wol>{translate('WOL')}</li>\n<div .separator />\n{this.type != \"lan\" && <li #rename>{translate('Rename')}</li>}\n{this.type != \"fav\" && <li #remove>{translate('Remove')}</li>}\n{is_win && <li #shortcut>{translate('Create desktop shortcut')}</li>}\n<li #forget-password>{translate('Forget Password')}</li>\n{(!this.type || this.type == \"fav\") && <li #add-fav>{translate('Add to Favorites')}</li>}\n{(!this.type || this.type == \"fav\") && <li #remove-fav>{translate('Remove from Favorites')}</li>}\n{this.type == \"ab\" && <li #edit-tag>{translate('Edit Tag')}</li>}\n</menu>\n</popup>\n{sessions}\n</div>;\n}\nfunction getSession(s) {\nvar id = s[0] || s.id || \"\";\nvar username = s[1] || s.username || \"\";\nvar hostname = s[2] || s.hostname || \"\";\nvar platform = s[3] || s.platform || \"\";\nvar alias = s[4] || s.alias || \"\";\nif (this.style == \"list\") {\nreturn <div .remote-session-link .remote-session-list id={id} platform={platform} title={alias ? \"ID: \" + id : \"\"}>\n<div .platform style={\"background:\"+string2RGB(id+platform, 0.5)}>\n{platform && platformSvg(platform, \"white\")}\n</div>\n<div .name>\n<div>\n<div #alias .ellipsis>{alias ? alias : formatId(id)}</div>\n<div .username .ellipsis>{username}@{hostname}</div>\n</div>\n</div>\n<div>\n{svg_menu}\n</div>\n</div>;\n}\nreturn <div .remote-session-link .remote-session id={id} platform={platform} title={alias ? \"ID: \" + id : \"\"} style={\"background:\"+string2RGB(id+platform, 0.5)}>\n<div .platform>\n{platform && platformSvg(platform, \"white\")}\n<div .username .ellipsis>{username}@{hostname}</div>\n</div>\n<div .text>\n<div #alias .ellipsis>{alias ? alias : formatId(id)}</div>\n{svg_menu}\n</div>\n</div>;\n}\nevent dblclick $(div.remote-session-link) (evt, me) {\ncreateNewConnect(me.id, \"connect\");\n}\nevent click $(#menu) (_, me) {\nvar id = me.parent.parent.id;\nvar platform = me.parent.parent.attributes[\"platform\"];\nthis.$(#rdp).style.set{\ndisplay: (platform == \"Windows\" && is_win) ? \"block\" : \"none\",\n};\nthis.$(#forget-password).style.set{\ndisplay: handler.peer_has_password(id) ? \"block\" : \"none\",\n};\nif (!this.type || this.type == \"fav\") {\nvar in_fav = handler.get_fav().indexOf(id) >= 0;\nthis.$(#add-fav).style.set{\ndisplay: in_fav ? \"none\" : \"block\",\n};\nthis.$(#remove-fav).style.set{\ndisplay: in_fav ? \"block\" : \"none\",\n};\n}\n// https://sciter.com/forums/topic/replacecustomize-context-menu/\nvar menu = this.$(menu#remote-context);\ncurrent_menu_peer_id = id;\nvar el = this.$(li#force-always-relay);\nif (el) {\nvar force = handler.get_peer_option(id, \"force-always-relay\");\nel.attributes.toggleClass(\"selected\", force == \"Y\");\n}\nvar conn = this.$(menu #connect);\nif (conn) {\nvar alias = me.parent.parent.$(#alias);\nif (alias) {\nalias = alias.text.replace(' ', '');\nif (alias != id) {\nconn.text = translate('Connect') + ' ' + id;\n} else {\nconn.text = translate('Connect');\n}\n}\n}\nme.popup(menu);\n}\nevent click $(menu#remote-context li) (evt, me) {\nvar action = me.id;\nvar id = current_menu_peer_id;\nif (action == \"connect\") {\ncreateNewConnect(id, \"connect\");\n} else if (action == \"transfer\") {\ncreateNewConnect(id, \"file-transfer\");\n} else if (action == \"wol\") {\nhandler.send_wol(id);\n} else if (action == \"remove\") {\nif (this.type == \"ab\") {\nfor (var i = 0; i < ab.peers.length; ++i) {\nif (ab.peers[i].id == id) {\nab.peers.splice(i, 1);\napp.update();\nupdateAb();\nbreak;\n}\n}\n} else if (this.type == \"lan\") {\nhandler.remove_discovered(id);\napp.update();\n} else {\nhandler.remove_peer(id);\napp.update();\n}\n} else if (action == \"forget-password\") {\nhandler.forget_password(id);\n} else if (action == \"shortcut\") {\nhandler.create_shortcut(id);\n} else if (action == \"rdp\") {\nif (is_edit_rdp_port) {\nis_edit_rdp_port = false;\nreturn;\n}\ncreateNewConnect(id, \"rdp\");\n} else if (action == \"add-fav\") {\nvar favs = handler.get_fav();\nif (favs.indexOf(id) < 0) {\nfavs = [id].concat(favs);\nhandler.store_fav(favs);\n}\napp.multipleSessions.update();\napp.update();\n} else if (action == \"remove-fav\") {\nvar favs = handler.get_fav();\nvar i = favs.indexOf(id);\nfavs.splice(i, 1);\nhandler.store_fav(favs);\napp.multipleSessions.update();\n} else if (action == \"tunnel\") {\ncreateNewConnect(id, \"port-forward\");\n} else if (action == \"rename\") {\nvar old_name = handler.get_peer_option(id, \"alias\");\nvar abPeer;\nif (this.type == \"ab\") {\nfor (var v in ab.peers) {\nif (v.id == id) {\nabPeer = v;\nold_name = v.alias || \"\";\n}\n}\n}\nmsgbox(\"custom-rename\", \"Rename\", \"<div .form> \\\n<div><input|text name='name' .outline-focus style='width: *; height: 23px', value='\" + old_name + \"' /></div> \\\n</div> \\\n\", \"\", function(res=null) {\nif (!res) return;\nvar name = (res.name || \"\").trim();\nif (name != old_name) {\nif (abPeer) {\nabPeer.alias = name;\nupdateAb();\n}\nhandler.set_peer_option(id, \"alias\", name);\n}\napp.update();\n});\n} else if (action == \"force-always-relay\") {\nvar force = handler.get_peer_option(id, \"force-always-relay\");\nhandler.set_peer_option(id, \"force-always-relay\", force == \"Y\" ? \"\" : \"Y\");\n} else if (action == \"edit-tag\") {\nvar peer;\nfor (var v in ab.peers) {\nif (v.id == id) {\npeer = v;\n}\n}\nif (!peer) return;\nmsgbox(\"custom-edit-tag\", \"Edit Tag\", <SelectTags tags={peer.tags || []} />, \"\", function(res=null) {\nif (!res) return;\npeer.tags = selectTags.tags;\nupdateAb();\n}, 260, 500, 0, \"size: *; margin: 2em 0;\");\n}\n}\n}\nfunction getSessionsType() {\nreturn handler.get_local_option(\"show-sessions-type\");\n}\nclass Favorites: Reactor.Component {\nfunction render() {\nvar sessions = handler.get_fav().map(function(f) {\nreturn handler.get_peer(f);\n});\nreturn <SessionList sessions={sessions} type=\"fav\" />;\n}\n}\nclass MultipleSessions: Reactor.Component {\nfunction render() {\nvar type = getSessionsType();\nreturn  <div style=\"size: *\">\n<div .sessions-bar>\n<div style=\"width:*\" .sessions-tab #sessions-type>\n<span class={!type ? 'active' : 'inactive'}>{translate('Recent sessions')}</span>\n<span #fav class={type == \"fav\" ? 'active' : 'inactive'}>{translate('Favorites')}</span>\n{handler.is_installed() && <span #lan class={type == \"lan\" ? 'active' : 'inactive'}>{translate('Discovered')}</span>}\n<span #ab class={type == \"ab\" ? 'active' : 'inactive'}>{translate('Address book')}</span>\n</div>\n{!this.hidden && <SearchBar type={type} />}\n{!this.hidden && <SessionStyle type={type} />}\n</div>\n{!this.hidden &&\n((type == \"fav\" && <Favorites />) ||\n(type == \"lan\" && handler.is_installed() && <LanPeers />) ||\n(type == \"ab\" && <AddressBook />) ||\n<SessionList sessions={handler.get_recent_sessions()} />)}\n</div>;\n}\nfunction stupidUpdate() {\n/* hidden is workaround of stupid sciter bug */\nthis.hidden = true;\nthis.update();\nvar me = this;\nself.timer(60ms, function() {\nme.hidden = false;\nme.update();\nself.timer(30ms, function() { me.onSize(); });\n});\n}\nevent click $(div#sessions-type span.inactive) (_, el) {\nif (el.id == \"lan\") {\ndiscover();\n}\nhandler.set_local_option('show-sessions-type', el.id || \"\");\nthis.stupidUpdate();\n}\nfunction onSize() {\nvar w = this.$(.sessions-bar .sessions-tab).box(#width);\nvar len = translate('Recent sessions').length;\nvar totalChars = 0;\nvar nEle = 0;\nfor (var el in this.$$(#sessions-type span)) {\nnEle += 1;\ntotalChars += el.text.length;\n}\nfor (var el in this.$$(#sessions-type span)) {\nvar maxWidth = (w - nEle * 2 * 8) * el.text.length / totalChars;\nif (maxWidth < 0) maxWidth = 36;\nel.style.set{\n\"max-width\": maxWidth + \"px\",\n};\n}\n}\n}\nfunction discover() {\nhandler.discover();\nvar tries = 15;\nfunction update() {\nself.timer(300ms, function() {\ntries -= 1;\nif (tries == 0) return;\nupdate();\nvar p = (app || {}).multipleSessions;\nif (p) {\np.update();\n}\n});\n}\nupdate();\n}\nif (getSessionsType() == \"lan\" && handler.is_installed()) {\ndiscover();\n}\nclass LanPeers: Reactor.Component {\nfunction render() {\nvar sessions = [];\ntry {\nsessions = JSON.parse(handler.get_lan_peers());\n} catch (_) {}\nreturn <SessionList sessions={sessions} type=\"lan\" />;\n}\n}\nview.on(\"size\", function() { if (app && app.multipleSessions) app.multipleSessions.onSize(); });\n/*\n{\npeers: [{id: \"abcd\", username: \"\", hostname: \"\", platform: \"\", alias: \"\", tags: [\"\", \"\", ...]}, ...],\ntags: [],\n}\n*/\nfunction handleAbError(err) {\nabLoading = false;\nerr = translate(err);\nstderr.println(err);\nabError = err;\napp.update();\n}\nfunction getAb() {\nabLoading = true;\nabError = \"\";\napp.update();\nhttpRequest(handler.get_api_server() + \"/api/ab/get\", #post, {}, function(data) {\nif (data) {\nif (data.error) {\nhandleAbError(data.error);\nreturn;\n}\nvar tm = data.updated_at;\nab = JSON.parse(data.data);\nif (!ab.tags) ab.tags = [];\nif (!ab.peers) ab.peers = [];\n}\nabLoading = false;\napp.update();\n}, function(err, status) {\nhandleAbError(err);\n}, getHttpHeaders());\n}\nfunction updateAb() {\nhttpRequest(handler.get_api_server() + \"/api/ab\", #post, { data: JSON.stringify(ab) }, function(data) {\n}, function(err, status) {\n}, getHttpHeaders());\n}\nfunction resetAb() {\nab = { tags: [], peers: [] };\napp.update();\n}\nfunction updateAbPeer() {\nif (ab.peers.length == 0) return;\n// to-do: inefficient\nvar sessions = handler.get_recent_sessions();\nif (sessions.length == 0) return;\nvar s = sessions[0];\nvar id = s[0] || \"\";\nvar p;\nfor (var tmp in ab.peers) {\nif (tmp.id == id) p = tmp;\n}\nif (!p) return;\nvar username = s[1] || \"\";\nvar hostname = s[2] || \"\";\nvar platform = s[3] || \"\";\nvar alias = s[4] || \"\";\nvar updated;\nif (username != (p.username || \"\")) {\np.username = username;\nupdated = true;\n}\nif (hostname != (p.hostname || \"\")) {\np.hostname = hostname;\nupdated = true;\n}\nif (platform != (p.platform || \"\")) {\np.platform = platform;\nupdated = true;\n}\nif (alias != (p.alias || \"\")) {\nif (alias) {\np.alias = alias;\n} else if (p.alias) {\nhandler.set_peer_option(id, \"alias\", p.alias);\n}\nupdated = true;\n}\nif (updated) {\nupdateAb();\nstdout.println(\"Ab peer updated\");\n}\n}\nvar is_edit_rdp_port;\nclass EditRdpPort: Reactor.Component {\nfunction render() {\nreturn <span style=\"margin-left: 12px; padding: 0 6px; display: inline-block;\" .link>{svg_edit}</span>;\n}\nfunction onMouse(evt) {\nif (evt.type == Event.MOUSE_DOWN) {\nis_edit_rdp_port = true;\neditRdpPort();\n}\n}\n}\nfunction editRdpPort() {\nvar id = current_menu_peer_id;\nvar p0 = handler.get_peer_option(id, \"rdp_port\");\nvar port = p0 ? <input|text name='port' value={p0} /> :\n<input|text name='port' novalue={3389} />;\nvar name0 = handler.get_peer_option(id, \"rdp_username\");\nvar pass0 = handler.get_peer_option(id, \"rdp_password\");\nmsgbox(\"custom-rdp-port\", 'RDP ' + translate('Settings'), <div .form .set-password>\n<div><span>{translate('Port')}:</span>{port}</div>\n<div><span>{translate('Username')}:</span><input|text name=\"username\" value={name0} /></div>\n<div><span>{translate('Password')}:</span><PasswordComponent value={pass0} /></div>\n</div>, \"\", function(res=null) {\nif (!res) return;\nvar p = (res.port || '').trim();\nif (p != p0) {\nif (!p) p = '0';\np = p.toNumber();\nif (p < 0 || p != p.toInteger()) {\nreturn translate(\"Invalid port\");\n}\nif (p == 0) p = \"\";\nelse p = p.toInteger() + '';\nhandler.set_peer_option(id, \"rdp_port\", p);\n}\nvar name = (res.username || '').trim();\nif (name != name0) {\nhandler.set_peer_option(id, \"rdp_username\", name);\n}\nvar pass = (res.password || '').trim();\nif (pass != pass0) {\nhandler.set_peer_option(id, \"rdp_password\", pass);\n}\n}, 240);\n}\nif (is_osx) view.windowBlurbehind = #light;\nstdout.println(\"current platform:\", OS);\nstdout.println(\"is_xfce: \", is_xfce);\n// html min-width, min-height not working on mac, below works for all\nview.windowMinSize = (scaleIt(560), scaleIt(300));\nvar app;\nvar tmp = handler.get_connect_status();\nvar connect_status = tmp[0];\nvar service_stopped = handler.get_option(\"stop-service\") == \"Y\";\nvar using_public_server = handler.using_public_server();\nvar software_update_url = \"\";\nvar key_confirmed = tmp[1];\nvar system_error = \"\";\nvar svg_menu = <svg #menu viewBox=\"0 0 512 512\">\n<circle cx=\"256\" cy=\"256\" r=\"64\"/>\n<circle cx=\"256\" cy=\"448\" r=\"64\"/>\n<circle cx=\"256\" cy=\"64\" r=\"64\"/>\n</svg>;\nvar svg_refresh_password = <svg #refresh-password xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke-width=\"3\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M2.5 2v6h6M2.66 15.57a10 10 0 1 0 .57-8.38\"/></svg>;\nvar my_id = handler.get_id();\nfunction get_id() {\nmy_id = handler.get_id();\nreturn my_id;\n}\nclass ConnectStatus: Reactor.Component {\nfunction render() {\nreturn\n<div .connect-status>\n<span class={\"connect-status-icon connect-status\" + (service_stopped ? 0 : connect_status)} />\n{this.getConnectStatusStr()}\n{service_stopped ? <span .link #start-service>{translate('Start service')}</span> : \"\"}\n</div>;\n}\nfunction getConnectStatusStr() {\nif (service_stopped) {\nreturn translate(\"Service is not running\");\n} else if (connect_status == -1) {\nreturn translate('not_ready_status');\n} else if (connect_status == 0) {\nreturn translate('connecting_status');\n}\nif (!handler.using_public_server()) return translate('Ready');\nreturn <span>{translate(\"Ready\")}, <span .link #setup-server>{translate(\"setup_server_tip\")}</span></span>;\n}\nevent click $(#start-service) () {\nhandler.set_option(\"stop-service\", \"\");\n}\nevent click $(#setup-server) () {\nhandler.open_url(\"https://sash.com.my/blog/id-relay-set/\");\n}\n}\nfunction createNewConnect(id, type) {\nid = id.replace(/\\s/g, \"\");\napp.remote_id.value = formatId(id);\nif (!id) return;\nvar old_id = id;\nid = handler.handle_relay_id(id);\nvar force_relay = old_id != id;\nif (id == my_id) {\nmsgbox(\"custom-error\", \"Error\", \"You cannot connect to your own computer\");\nreturn;\n}\nhandler.set_remote_id(id);\nhandler.new_remote(id, type, force_relay);\n}\nclass ShareRdp: Reactor.Component {\nfunction render() {\nvar rdp_shared_string = translate(\"Enable RDP session sharing\");\nvar cls = handler.is_share_rdp()  ? \"selected\" : \"line-through\";\nreturn <li class={cls}><span>{svg_checkmark}</span>{rdp_shared_string}</li>;\n}\nfunction onClick() {\nhandler.set_share_rdp(!handler.is_share_rdp());\nthis.update();\n}\n}\nvar direct_server;\nclass DirectServer: Reactor.Component {\nfunction this() {\ndirect_server = this;\n}\nfunction render() {\nvar text = translate(\"Enable direct IP access\");\nvar enabled = handler.get_option(\"direct-server\") == \"Y\";\nvar cls = enabled ? \"selected\" : \"line-through\";\nreturn <li class={cls}><span>{svg_checkmark}</span>{text}{enabled && <EditDirectAccessPort />}</li>;\n}\nfunction onClick() {\nif (is_edit_rdp_port) {\nis_edit_rdp_port = false;\nreturn;\n}\nhandler.set_option(\"direct-server\", handler.get_option(\"direct-server\") == \"Y\" ? \"\" : \"Y\");\nthis.update();\n}\n}\nvar myIdMenu;\nvar audioInputMenu;\nclass AudioInputs: Reactor.Component {\nfunction this() {\naudioInputMenu = this;\n}\nfunction render() {\nif (!this.show) return <li />;\nvar inputs = handler.get_sound_inputs();\nif (is_win) inputs = [\"System Sound\"].concat(inputs);\nif (!inputs.length) return <li style=\"display:hidden\" />;\nvar me = this;\nself.timer(1ms, function() { me.toggleMenuState() });\nreturn <li>{translate('Audio Input')}\n<menu #audio-input key={inputs.length}>\n<li #enable-audio><span>{svg_checkmark}</span>{translate(\"Mute\")}</li>\n<div .separator />\n{inputs.map(function(name) {\nreturn <li id={name}><span>{svg_checkmark}</span>{translate(name)}</li>;\n})}\n</menu>\n</li>;\n}\nfunction get_default() {\nif (is_win) return \"System Sound\";\nreturn \"\";\n}\nfunction get_value() {\nreturn handler.get_option(\"audio-input\") || this.get_default();\n}\nfunction toggleMenuState() {\nvar el = this.$(li#enable-audio);\nvar enabled = handler.get_option(el.id) != \"N\";\nel.attributes.toggleClass(\"selected\", !enabled);\nvar v = this.get_value();\nfor (var el in this.$$(menu#audio-input>li)) {\nif (el.id == 'enable-audio') continue;\nvar selected = el.id == v;\nel.attributes.toggleClass(\"selected\", selected);\n}\n}\nevent click $(menu#audio-input>li) (_, me) {\nvar v = me.id;\nif (v == 'enable-audio') {\nhandler.set_option(v, handler.get_option(v) != 'N' ? 'N' : '');\n} else {\nif (v == this.get_value()) return;\nif (v == this.get_default()) v = \"\";\nhandler.set_option(\"audio-input\", v);\n}\nthis.toggleMenuState();\n}\n};\nclass Languages: Reactor.Component {\nfunction render() {\nvar langs = JSON.parse(handler.get_langs());\nvar me = this;\nself.timer(1ms, function() { me.toggleMenuState() });\nreturn <li>{translate('Language')}\n<menu #languages key={langs.length}>\n<li id=\"default\"><span>{svg_checkmark}</span>Default</li>\n<div .separator />\n{langs.map(function(lang) {\nreturn <li id={lang[0]}><span>{svg_checkmark}</span>{lang[1]}</li>;\n})}\n</menu>\n</li>;\n}\nfunction toggleMenuState() {\nvar cur = handler.get_local_option(\"lang\") || \"default\";\nfor (var el in this.$$(menu#languages>li)) {\nvar selected = cur == el.id;\nel.attributes.toggleClass(\"selected\", selected);\n}\n}\nevent click $(menu#languages>li) (_, me) {\nvar v = me.id;\nif (v == \"default\") v = \"\";\nhandler.set_local_option(\"lang\", v);\napp.update();\nthis.toggleMenuState();\n}\n}\nvar enhancementsMenu;\nclass Enhancements: Reactor.Component {\nfunction this() {\nenhancementsMenu = this;\n}\nfunction render() {\nvar has_hwcodec = handler.has_hwcodec();\nvar has_vram = handler.has_vram();\nvar support_remove_wallpaper = handler.support_remove_wallpaper();\nvar me = this;\nself.timer(1ms, function() { me.toggleMenuState() });\nreturn <li>{translate('Enhancements')}\n<menu #enhancements-menu>\n{(has_hwcodec || has_vram) ? <li #enable-hwcodec><span>{svg_checkmark}</span>{translate(\"Enable hardware codec\")}</li> : \"\"}\n<li #enable-abr><span>{svg_checkmark}</span>{translate(\"Adaptive bitrate\")} (beta)</li>\n<li #screen-recording>{translate(\"Recording\")}</li>\n{support_remove_wallpaper ? <li #allow-remove-wallpaper><span>{svg_checkmark}</span>{translate(\"Remove wallpaper during incoming sessions\")}</li> : \"\"}\n</menu>\n</li>;\n}\nfunction toggleMenuState() {\nfor (var el in $$(menu#enhancements-menu>li)) {\nif (el.id && el.id.indexOf(\"enable-\") == 0) {\nvar enabled = handler.get_option(el.id) != \"N\";\nel.attributes.toggleClass(\"selected\", enabled);\n} else if (el.id && el.id.indexOf(\"allow-\") == 0) {\nvar enabled = handler.get_option(el.id) == \"Y\";\nel.attributes.toggleClass(\"selected\", enabled);\n}\n}\n}\nevent click $(menu#enhancements-menu>li) (_, me) {\nvar v = me.id;\nif (v.indexOf(\"enable-\") == 0) {\nvar set_value = handler.get_option(v) != 'N' ? 'N' : '';\nhandler.set_option(v, set_value);\nif (v == \"enable-hwcodec\" && set_value == '') {\nhandler.check_hwcodec();\n}\n} else if (v.indexOf(\"allow-\") == 0) {\nhandler.set_option(v, handler.get_option(v) == 'Y' ? '' : 'Y');\n} else if (v == 'screen-recording') {\nvar show_root_dir = is_win && handler.is_installed();\nvar user_dir = handler.video_save_directory(false);\nvar root_dir = show_root_dir ? handler.video_save_directory(true) : \"\";\nvar ts0 = handler.get_option(\"enable-record-session\") == '' ? { checked: true } : {};\nvar ts1 = handler.get_option(\"allow-auto-record-incoming\") == 'Y' ? { checked: true } : {};\nmsgbox(\"custom-recording\", translate('Recording'),\n<div .form>\n<div><button|checkbox(enable_record_session) {ts0}>{translate('Enable recording session')}</button></div>\n<div><button|checkbox(auto_record_incoming) {ts1}>{translate('Automatically record incoming sessions')}</button></div>\n<div>\n{show_root_dir ? <div style=\"word-wrap:break-word\"><span>{translate(\"Incoming\")}:&nbsp;&nbsp;</span><span>{root_dir}</span></div> : \"\"}\n<div style=\"word-wrap:break-word\"><span>{translate(show_root_dir ? \"Outgoing\" : \"Directory\")}:&nbsp;&nbsp;</span><span #folderPath>{user_dir}</span></div>\n<div> <button #select_directory .link>{translate('Change')}</button> </div>\n</div>\n</div>\n, \"\", function(res=null) {\nif (!res) return;\nhandler.set_option(\"enable-record-session\", res.enable_record_session ? '' : 'N');\nhandler.set_option(\"allow-auto-record-incoming\", res.auto_record_incoming ? 'Y' : '');\nhandler.set_option(\"video-save-directory\", $(#folderPath).text);\n});\n}\nthis.toggleMenuState();\n}\n}\nfunction getUserName() {\ntry {\nreturn JSON.parse(handler.get_local_option(\"user_info\")).name;\n} catch(e) {}\nreturn '';\n}\nfunction updateTheme() {\nvar root_element = self;\nif (handler.get_option(\"allow-darktheme\") == \"Y\") {\n// enable dark theme\nroot_element.attributes.toggleClass(\"darktheme\", true);\n} else {\n// disable dark theme\nroot_element.attributes.toggleClass(\"darktheme\", false);\n}\n}\nclass MyIdMenu: Reactor.Component {\nfunction this() {\nmyIdMenu = this;\n}\nfunction render() {\nreturn <div #myid>\n{this.renderPop()}\nID{svg_menu}\n</div>;\n}\nfunction renderPop() {\nvar username = handler.get_local_option(\"access_token\") ? getUserName() : '';\nreturn <popup>\n<menu.context #config-options>\n<li #enable-keyboard><span>{svg_checkmark}</span>{translate('Enable keyboard/mouse')}</li>\n<li #enable-clipboard><span>{svg_checkmark}</span>{translate('Enable clipboard')}</li>\n<li #enable-file-transfer><span>{svg_checkmark}</span>{translate('Enable file transfer')}</li>\n<li #enable-remote-restart><span>{svg_checkmark}</span>{translate('Enable remote restart')}</li>\n<li #enable-tunnel><span>{svg_checkmark}</span>{translate('Enable TCP tunneling')}</li>\n{is_win ? <li #enable-block-input><span>{svg_checkmark}</span>{translate('Enable blocking user input')}</li> : \"\"}\n<li #enable-lan-discovery><span>{svg_checkmark}</span>{translate('Enable LAN discovery')}</li>\n<AudioInputs />\n<Enhancements />\n<li #allow-remote-config-modification><span>{svg_checkmark}</span>{translate('Enable remote configuration modification')}</li>\n<div .separator />\n<li #custom-server>{translate('ID/Relay Server')}</li>\n<li #whitelist title={translate('whitelist_tip')}>{translate('IP Whitelisting')}</li>\n<li #socks5-server>{translate('Socks5 Proxy')}</li>\n<div .separator />\n<li #stop-service class={service_stopped ? \"line-through\" : \"selected\"}><span>{svg_checkmark}</span>{translate(\"Enable service\")}</li>\n{is_win && handler.is_installed() ? <ShareRdp /> : \"\"}\n<DirectServer />\n{false && handler.using_public_server() && <li #allow-always-relay><span>{svg_checkmark}</span>{translate('Always connect via relay')}</li>}\n{handler.is_ok_change_id() ? <div .separator /> : \"\"}\n{username ?\n<li #logout>{translate('Logout')} ({username})</li> :\n<li #login>{translate('Login')}</li>}\n{handler.is_ok_change_id() && key_confirmed && connect_status > 0 ? <li #change-id>{translate('Change ID')}</li> : \"\"}\n<div .separator />\n<li #allow-darktheme><span>{svg_checkmark}</span>{translate('Dark Theme')}</li>\n<Languages />\n<li #about>{translate('About')} {\" \"}{handler.get_app_name()}</li>\n</menu>\n</popup>;\n}\nevent click $(svg#menu) (_, me) {\nthis.showSettingMenu();\n}\nfunction showSettingMenu() {\naudioInputMenu.update({ show: true });\nthis.toggleMenuState();\nif (direct_server) direct_server.update();\nvar menu = this.$(menu#config-options);\nthis.$(svg#menu).popup(menu);\n}\nevent click $(li#login) () {\nlogin();\n}\nevent click $(li#logout) () {\nlogout();\n}\nfunction toggleMenuState() {\nfor (var el in $$(menu#config-options>li)) {\nif (el.id && el.id.indexOf(\"enable-\") == 0) {\nvar enabled = handler.get_option(el.id) != \"N\";\nel.attributes.toggleClass(\"selected\", enabled);\nel.attributes.toggleClass(\"line-through\", !enabled);\n}\nif (el.id && el.id.indexOf(\"allow-\") == 0) {\nvar enabled = handler.get_option(el.id) == \"Y\";\nel.attributes.toggleClass(\"selected\", enabled);\nel.attributes.toggleClass(\"line-through\", !enabled);\n}\n}\n}\nfunction showAbout() {\nvar name = handler.get_app_name();\nmsgbox(\"custom-nocancel-nook-hasclose\", translate(\"About\") + \" \" + name, \"<div style='line-height: 2em'> \\\n<div>Version: \" + handler.get_version() + \" \\\n<div>Fingerprint: \" + handler.get_fingerprint() + \" \\\n<div .link .custom-event url='https://sash.com.my/privacy.html'>\" + translate(\"Privacy Statement\") + \"</div> \\\n<div .link .custom-event url='https://sash.com.my'>\" + translate(\"Website\") + \"</div> \\\n<div style='background: #2c8cff; color: white; padding: 1em; margin-top: 1em;'>Copyright &copy; 2024 Purslane Ltd.\\\n<br />\" + handler.get_license() + \" \\\n<p style='font-weight: bold'>\" + translate(\"Slogan_tip\") + \"</p>\\\n</div>\\\n</div>\", \"\", function(el) {\nif (el && el.attributes) {\nhandler.open_url(el.attributes['url']);\n};\n}, 400);\n}\nevent click $(menu#config-options>li) (_, me) {\nif (me.id && me.id.indexOf(\"enable-\") == 0) {\nhandler.set_option(me.id, handler.get_option(me.id) == \"N\" ? \"\" : \"N\");\n}\nif (me.id && me.id.indexOf(\"allow-\") == 0) {\nhandler.set_option(me.id, handler.get_option(me.id) == \"Y\" ? \"\" : \"Y\");\n}\nif (me.id == \"whitelist\") {\nvar old_value = handler.get_option(\"whitelist\").split(\",\").join(\"\\n\");\nmsgbox(\"custom-whitelist\", translate(\"IP Whitelisting\"), \"<div .form> \\\n<div>\" + translate(\"whitelist_sep\") + \"</div> \\\n<textarea .outline-focus spellcheck=\\\"false\\\" name=\\\"text\\\" novalue=\\\"0.0.0.0\\\" style=\\\"overflow: scroll-indicator; width:*; height: 140px; font-size: 1.2em; padding: 0.5em;\\\">\" + old_value + \"</textarea>\\\n</div> \\\n\", \"\", function(res=null) {\nif (!res) return;\nvar value = (res.text || \"\").trim();\nif (value) {\nvar values = value.split(/[\\s,;\\n]+/g);\nfor (var ip in values) {\nif (!ip.match(/^(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]?|0)\\.(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]?|0)\\.(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]?|0)\\.(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]?|0)(\\/([1-9]|[1-2][0-9]|3[0-2])){0,1}$/)\n&& !ip.match(/^(((?:[0-9A-Fa-f]{1,4}))*((?::[0-9A-Fa-f]{1,4}))*::((?:[0-9A-Fa-f]{1,4}))*((?::[0-9A-Fa-f]{1,4}))*|((?:[0-9A-Fa-f]{1,4}))((?::[0-9A-Fa-f]{1,4})){7})(\\/([1-9]|[1-9][0-9]|1[0-1][0-9]|12[0-8])){0,1}$/)) {\nreturn translate(\"Invalid IP\") + \": \" + ip;\n}\n}\nvalue = values.join(\"\\n\");\n}\nif (value == old_value) return;\nstdout.println(\"whitelist updated\");\nhandler.set_option(\"whitelist\", value.replace(\"\\n\", \",\"));\n}, 300);\n} else if (me.id == \"custom-server\") {\nvar configOptions = handler.get_options();\nvar old_relay = configOptions[\"relay-server\"] || \"\";\nvar old_api = configOptions[\"api-server\"] || \"\";\nvar old_id = configOptions[\"custom-rendezvous-server\"] || \"\";\nvar old_key = configOptions[\"key\"] || \"\";\nmsgbox(\"custom-server\", \"ID/Relay Server\", \"<div .form .set-password> \\\n<div><span>\" + translate(\"ID Server\") + \": </span><input|text .outline-focus name='id' value='\" + old_id + \"' /></div> \\\n<div><span>\" + translate(\"Relay Server\") + \": </span><input|text name='relay' value='\" + old_relay + \"' /></div> \\\n<div><span>\" + translate(\"API Server\") + \": </span><input|text name='api' value='\" + old_api + \"' /></div> \\\n<div><span>\" + translate(\"Key\") + \": </span><input|text name='key' value='\" + old_key + \"' /></div> \\\n</div> \\\n\", \"\", function(res=null) {\nif (!res) return;\nvar id = (res.id || \"\").trim();\nvar relay = (res.relay || \"\").trim();\nvar api = (res.api || \"\").trim().toLowerCase();\nvar key = (res.key || \"\").trim();\nif (id == old_id && relay == old_relay && key == old_key && api == old_api) return;\nif (id) {\nvar err = handler.test_if_valid_server(id, true);\nif (err) return translate(\"ID Server\") + \": \" + err;\n}\nif (relay) {\nvar err = handler.test_if_valid_server(relay, true);\nif (err) return translate(\"Relay Server\") + \": \" + err;\n}\nif (api) {\nif (0 != api.indexOf(\"https://\") && 0 != api.indexOf(\"http://\")) {\nreturn  translate(\"API Server\") + \": \" + translate(\"invalid_http\");\n}\n}\nconfigOptions[\"custom-rendezvous-server\"] = id;\nconfigOptions[\"relay-server\"] = relay;\nconfigOptions[\"api-server\"] = api;\nconfigOptions[\"key\"] = key;\nhandler.set_options(configOptions);\n}, 260);\n} else if (me.id == \"socks5-server\") {\nvar socks5 = handler.get_socks() || {};\nvar old_proxy = socks5[0] || \"\";\nvar old_username = socks5[1] || \"\";\nvar old_password = socks5[2] || \"\";\nmsgbox(\"custom-server\", \"Socks5 Proxy\", <div .form .set-password>\n<div><span>{translate(\"Server\")}:</span><input|text .outline-focus name='proxy' value={old_proxy} /></div>\n<div><span>{translate(\"Username\")}:</span><input|text name='username' value={old_username} /></div>\n<div><span>{translate(\"Password\")}:</span><PasswordComponent value={old_password} /></div>\n</div>\n, \"\", function(res=null) {\nif (!res) return;\nvar proxy = (res.proxy || \"\").trim();\nvar username = (res.username || \"\").trim();\nvar password = (res.password || \"\").trim();\nif (proxy == old_proxy && username == old_username && password == old_password) return;\nif (proxy) {\nvar err = handler.test_if_valid_server(proxy, false);\nif (err) return translate(\"Server\") + \": \" + err;\n}\nhandler.set_socks(proxy, username, password);\n}, 240);\n} else if (me.id == \"stop-service\") {\nhandler.set_option(\"stop-service\", service_stopped ? \"\" : \"Y\");\n} else if (me.id == \"change-id\") {\nmsgbox(\"custom-id\", translate(\"Change ID\"), \"<div .form .set-password> \\\n<div>\" + translate('id_change_tip') + \" </div> \\\n<div><span style='width: 100px; display:inline-block'>ID: </span><input|text .outline-focus style='width: 250px' name='id' /></div> \\\n</div> \\\n\", \"\", function(res=null, show_progress) {\nif (!res) return;\nshow_progress();\nvar id = (res.id || \"\").trim();\nif (!id) return;\nif (id == my_id) return;\nhandler.change_id(id);\nfunction check_status() {\nvar status = handler.get_async_job_status();\nif (status == \" \") self.timer(0.1s, check_status);\nelse {\nif (status) show_progress(false, translate(status));\nelse show_progress(-1);\n}\n}\ncheck_status();\nreturn \" \";\n});\n} else if (me.id == \"allow-darktheme\") {\nupdateTheme();\n} else if (me.id == \"about\") {\nthis.showAbout()\n}\n}\n}\nvar is_edit_direct_access_port;\nclass EditDirectAccessPort: Reactor.Component {\nfunction render() {\nreturn <span style=\"margin-left: 12px; padding: 0 6px; display: inline-block;\" .link>{svg_edit}</span>;\n}\nfunction onMouse(evt) {\nif (evt.type == Event.MOUSE_DOWN) {\nis_edit_direct_access_port = true;\neditDirectAccessPort();\n}\n}\n}\nfunction editDirectAccessPort() {\nvar p0 = handler.get_option('direct-access-port');\nvar port = p0 ? <input|text name='port' value={p0} /> :\n<input|text name='port' novalue={21118} />;\nmsgbox(\"custom-direct-access-port\", translate('Direct IP Access Settings'), <div .form .set-password>\n<div><span style=\"width: 60px;\">{translate('Port')}:</span>{port}</div>\n</div>, \"\", function(res=null) {\nif (!res) return;\nvar p = (res.port || '').trim();\nif (p) {\np = p.toInteger();\nif (!(p > 0)) {\nreturn translate(\"Invalid port\");\n}\np = p + '';\n}\nif (p != p0) handler.set_option('direct-access-port', p);\n});\n}\nclass App: Reactor.Component\n{\nfunction this() {\napp = this;\n}\nfunction render() {\nvar is_can_screen_recording = handler.is_can_screen_recording(false);\nreturn\n<div .app>\n<div .left-pane>\n<div>\n<div .title>{translate('Your Desktop')}</div>\n<div .lighter-text>{translate('desk_tip')}</div>\n<div .your-desktop>\n<MyIdMenu />\n{key_confirmed ? <input type=\"text\" readonly value={formatId(get_id())}/> : translate(\"Generating ...\")}\n</div>\n<PasswordArea />\n</div>\n{!is_win || handler.is_installed() ? \"\": <InstallMe />}\n{software_update_url ? <UpdateMe /> : \"\"}\n{is_win && handler.is_installed() && !software_update_url && handler.is_installed_lower_version() ? <UpgradeMe /> : \"\"}\n{is_can_screen_recording ? \"\": <CanScreenRecording />}\n{is_can_screen_recording && !handler.is_process_trusted(false) ? <TrustMe /> : \"\"}\n{!service_stopped && is_can_screen_recording && handler.is_process_trusted(false) && handler.is_installed() && !handler.is_installed_daemon(false) ? <InstallDaemon /> : \"\"}\n{system_error ? <SystemError /> : \"\"}\n{!system_error && handler.is_login_wayland() && !handler.current_is_wayland() ? <FixWayland /> : \"\"}\n{!system_error && handler.current_is_wayland() ? <ModifyDefaultLogin /> : \"\"}\n</div>\n<div .right-pane>\n<div .right-content>\n<div .card-connect>\n<div .title>{translate('Control Remote Desktop')}</div>\n<ID @{this.remote_id} />\n<div .right-buttons>\n<button .button .outline #file-transfer>{translate('Transfer file')}</button>\n<button .button #connect>{translate('Connect')}</button>\n</div>\n</div>\n<MultipleSessions @{this.multipleSessions} />\n</div>\n<ConnectStatus @{this.connect_status} />\n</div>\n<div #overlay style=\"position: absolute;size:*;background:black;opacity:0.5;display:none\" />\n</div>;\n}\nevent click $(button#connect) {\nthis.newRemote(\"connect\");\n}\nevent click $(button#file-transfer) {\nthis.newRemote(\"file-transfer\");\n}\nfunction newRemote(type) {\ncreateNewConnect(this.remote_id.value, type);\n}\n}\nclass InstallMe: Reactor.Component {\nfunction render() {\nreturn <div .install-me>\n<span />\n<div>{translate('install_tip')}</div>\n<div><button #install-me .button>{translate('Install')}</button></div>\n</div>;\n}\nevent click $(#install-me) {\nhandler.goto_install();\n}\n}\nfunction download(from, to, args..) {\nvar rqp = { type:#get, url: from, toFile: to };\nvar fn = 0;\nvar on = 0;\nfor( var p in args ) {\nif( p instanceof Function ) {\nswitch(++fn) {\ncase 1: rqp.success = p; break;\ncase 2: rqp.error = p; break;\ncase 3: rqp.progress = p; break;\n}\n} else if( p instanceof Object ) {\nswitch(++on) {\ncase 1: rqp.params = p; break;\ncase 2: rqp.headers = p; break;\n}\n}\n}\nview.request(rqp);\n}\n// current running version is higher than installed\nclass UpgradeMe: Reactor.Component {\nfunction render() {\nvar update_or_download = is_osx ? \"download\" : \"update\";\nreturn <div .install-me>\n<div>{translate('Status')}</div>\n<div>{translate('Your installation is lower version.')}</div>\n<div #install-me.link>{translate('Click to upgrade')}</div>\n</div>;\n}\nevent click $(#install-me) {\nhandler.update_me(\"\");\n}\n}\nclass UpdateMe: Reactor.Component {\nfunction render() {\nvar update_or_download = \"download\"; // !is_win ? \"download\" : \"update\";\nreturn <div .install-me>\n<div>{translate('Status')}</div>\n<div>There is a newer version of {handler.get_app_name()} ({handler.get_new_version()}) available.</div>\n<div #install-me.link>{translate('Click to ' + update_or_download)}</div>\n<div #download-percent style=\"display:hidden; padding-top: 1em;\" />\n</div>;\n}\nevent click $(#install-me) {\nhandler.open_url(\"https://sash.com.my/download\");\nreturn;\nif (!is_win) {\nhandler.open_url(\"https://sash.com.my\");\nreturn;\n}\nvar url = software_update_url + '.' + handler.get_software_ext();\nvar path = handler.get_software_store_path();\nvar onsuccess = function(md5) {\n$(#download-percent).content(translate(\"Installing ...\"));\nhandler.update_me(path);\n};\nvar onerror = function(err) {\nmsgbox(\"custom-error\", \"Download Error\", \"Failed to download\");\n};\nvar onprogress = function(loaded, total) {\nif (!total) total = 5 * 1024 * 1024;\nvar el = $(#download-percent);\nel.style.set{display: \"block\"};\nel.content(\"Downloading %\" + (loaded * 100 / total));\n};\nstdout.println(\"Downloading \" + url + \" to \" + path);\ndownload(\nurl,\nself.url(path),\nonsuccess, onerror, onprogress);\n}\n}\nclass SystemError: Reactor.Component {\nfunction render() {\nreturn <div .install-me>\n<div>{system_error}</div>\n</div>;\n}\n}\nclass TrustMe: Reactor.Component {\nfunction render() {\nreturn <div .trust-me #trust-me-box>\n<div>{translate('Permissions')}</div>\n<div>{translate('config_acc')}</div>\n<div #trust-me .link>{translate('Configure')}</div>\n<div #help-me .link>{translate('Help')}</div>\n</div>;\n}\nevent click $(#trust-me) {\nhandler.is_process_trusted(true);\nwatch_trust();\n}\nevent click $(#help-me) {\nhandler.open_url(translate(\"doc_mac_permission\"));\n}\n}\nclass CanScreenRecording: Reactor.Component {\nfunction render() {\nreturn <div .trust-me #screen-recording-box>\n<div>{translate('Permissions')}</div>\n<div>{translate('config_screen')}</div>\n<div #screen-recording .link>{translate('Configure')}</div>\n<div #help-me .link>{translate('Help')}</div>\n</div>;\n}\nevent click $(#screen-recording) {\nhandler.is_can_screen_recording(true);\nwatch_screen_recording();\n}\nevent click $(#help-me) {\nhandler.open_url(translate(\"doc_mac_permission\"));\n}\n}\nclass InstallDaemon: Reactor.Component {\nfunction render() {\nreturn <div .install-me>\n<span />\n<div>{translate('install_daemon_tip')}</div>\n<div #install-me.link>{translate('Install')}</div>\n</div>;\n}\nevent click $(#install-me) {\nhandler.is_installed_daemon(true);\n}\n}\nclass FixWayland: Reactor.Component {\nfunction render() {\nreturn <div .trust-me>\n<div>{translate('Warning')}</div>\n<div>{translate('Login screen using Wayland is not supported')}</div>\n<div #help-me .link>{translate('Help')}</div>\n</div>;\n}\nevent click $(#help-me) {\nhandler.open_url(translate(\"doc_fix_wayland\"));\n}\n}\nclass ModifyDefaultLogin: Reactor.Component {\nfunction render() {\nreturn <div .trust-me>\n<div>{translate('Warning')}</div>\n<div>{translate('wayland_experiment_tip')}</div>\n<div #help-me .link>{translate('Help')}</div>\n</div>;\n}\nevent click $(#help-me) {\nhandler.open_url(translate(\"doc_fix_wayland\"));\n}\n}\nfunction watch_trust() {\n// not use TrustMe::update, because it is buggy\nvar trusted = handler.is_process_trusted(false);\nvar el = $(div#trust-me-box);\nif (el) {\nel.style.set {\ndisplay: trusted ? \"none\" : \"block\",\n};\n}\nif (trusted) {\napp.update();\nreturn;\n}\nself.timer(1s, watch_trust);\n}\nfunction watch_screen_recording() {\nvar trusted = handler.is_can_screen_recording(false);\nvar el = $(div#screen-recording-box);\nif (el) {\nel.style.set {\ndisplay: trusted ? \"none\" : \"block\",\n};\n}\nif (trusted) {\napp.update();\nreturn;\n}\nself.timer(1s, watch_screen_recording);\n}\nclass PasswordEyeArea : Reactor.Component {\nrender() {\nvar method = handler.get_option('verification-method');\nvar mode= handler.get_option('approve-mode');\nvar value = mode == 'click' ||  method == 'use-permanent-password' ? \"-\" : password_cache[0];\nreturn\n<div .eye-area style=\"width: *\">\n<input|text @{this.input} readonly value={value} />\n{svg_refresh_password}\n</div>;\n}\nevent click $(svg#refresh-password) (_, me) {\nhandler.update_temporary_password();\nthis.update();\n}\n}\nvar temporaryPasswordLengthMenu;\nclass TemporaryPasswordLengthMenu: Reactor.Component {\nfunction this() {\ntemporaryPasswordLengthMenu = this;\n}\nfunction render() {\nif (!this.show) return <li />;\nvar me = this;\nvar method = handler.get_option('verification-method');\nself.timer(1ms, function() { me.toggleMenuState() });\nreturn <li disabled={ method == 'use-permanent-password' ? \"true\" : \"false\" }>{translate(\"One-time password length\")}\n<menu #temporary-password-length>\n<li #temporary-password-length-6><span>{svg_checkmark}</span>6</li>\n<li #temporary-password-length-8><span>{svg_checkmark}</span>8</li>\n<li #temporary-password-length-10><span>{svg_checkmark}</span>10</li>\n</menu>\n</li>;\n}\nfunction toggleMenuState() {\nvar length = handler.get_option(\"temporary-password-length\");\nvar index = ['6', '8', '10'].indexOf(length);\nif (index < 0) index = 0;\nfor (var (i, el) in this.$$(menu#temporary-password-length>li)) {\nel.attributes.toggleClass(\"selected\", i == index);\n}\n}\nevent click $(menu#temporary-password-length>li) (_, me) {\nvar length = me.id.substring('temporary-password-length-'.length);\nvar old_length = handler.get_option('temporary-password-length');\nif (length != old_length) {\nhandler.set_option('temporary-password-length', length);\nhandler.update_temporary_password();\nthis.toggleMenuState();\npasswordArea.update();\n}\n}\n}\nvar passwordArea;\nclass PasswordArea: Reactor.Component {\nfunction this() {\npasswordArea = this;\n}\nfunction render() {\nvar me = this;\nself.timer(1ms, function() { me.toggleMenuState() });\nreturn\n<div .your-desktop>\n<div>{translate('One-time Password')}</div>\n<div .password style=\"flow:horizontal\">\n{this.renderPop()}\n<PasswordEyeArea />\n{svg_edit}\n</div>\n</div>;\n}\nfunction renderPop() {\nvar method = handler.get_option('verification-method');\nvar approve_mode= handler.get_option('approve-mode');\nvar show_password = approve_mode != 'click';\nreturn <popup><menu.context #edit-password-context>\n<li #approve-mode-password><span>{svg_checkmark}</span>{translate('Accept sessions via password')}</li>\n<li #approve-mode-click><span>{svg_checkmark}</span>{translate('Accept sessions via click')}</li>\n<li #approve-mode-both><span>{svg_checkmark}</span>{translate('Accept sessions via both')}</li>\n{ !show_password ? '' : <div .separator /> }\n{ !show_password ? '' : <li #use-temporary-password><span>{svg_checkmark}</span>{translate('Use one-time password')}</li> }\n{ !show_password ? '' : <li #use-permanent-password><span>{svg_checkmark}</span>{translate('Use permanent password')}</li> }\n{ !show_password ? '' : <li #use-both-passwords><span>{svg_checkmark}</span>{translate('Use both passwords')}</li> }\n{ !show_password ? '' : <div .separator /> }\n{ !show_password ? '' : <li #set-password  disabled={ method == 'use-temporary-password' ? \"true\" : \"false\" }>{translate('Set permanent password')}</li> }\n{ !show_password ? '' : <TemporaryPasswordLengthMenu /> }\n<div .separator />\n<li #tfa><span>{svg_checkmark}</span>{translate('enable-2fa-title')}</li>\n</menu></popup>;\n}\nfunction toggleMenuState() {\nvar mode= handler.get_option('approve-mode');\nvar mode_id;\nif (mode == 'password')\nmode_id = 'approve-mode-password';\nelse if (mode == 'click')\nmode_id = 'approve-mode-click';\nelse\nmode_id = 'approve-mode-both';\nvar pwd_id = handler.get_option('verification-method');\nif (pwd_id != 'use-temporary-password' && pwd_id != 'use-permanent-password')\npwd_id = 'use-both-passwords';\nvar has_valid_2fa = handler.has_valid_2fa();\nfor (var el in this.$$(menu#edit-password-context>li)) {\nif (el.id.indexOf(\"approve-mode-\") == 0)\nel.attributes.toggleClass(\"selected\", el.id == mode_id);\nif (el.id.indexOf(\"use-\") == 0)\nel.attributes.toggleClass(\"selected\", el.id == pwd_id);\nif (el.id == \"tfa\")\nel.attributes.toggleClass(\"selected\", has_valid_2fa);\n}\n}\nevent click $(svg#edit) (_, me) {\nvar approve_mode= handler.get_option('approve-mode');\nvar show_password = approve_mode != 'click';\nif(show_password && temporaryPasswordLengthMenu) temporaryPasswordLengthMenu.update({show: true });\nvar menu = $(menu#edit-password-context);\nme.popup(menu);\n}\nevent click $(li#set-password) {\nvar me = this;\nvar password = handler.permanent_password();\nvar value_field = password.length == 0 ? \"\" : \"value=\" + password;\nmsgbox(\"custom-password\", translate(\"Set Password\"), \"<div .form .set-password> \\\n<div><span>\" + translate('Password') + \":</span><input|password(password) .outline-focus \" + value_field + \" /></div> \\\n<div><span>\" + translate('Confirmation') + \":</span><input|password(confirmation) \" + value_field + \" /></div> \\\n</div> \\\n\", \"\", function(res=null) {\nif (!res) return;\nvar p0 = (res.password || \"\").trim();\nvar p1 = (res.confirmation || \"\").trim();\nif (p0.length < 6 && p0.length != 0) {\nreturn translate(\"Too short, at least 6 characters.\");\n}\nif (p0 != p1) {\nreturn translate(\"The confirmation is not identical.\");\n}\nhandler.set_permanent_password(p0);\nme.update();\n});\n}\nevent click $(menu#edit-password-context>li) (_, me) {\nif (me.id.indexOf('use-') == 0) {\nhandler.set_option('verification-method', me.id);\nthis.toggleMenuState();\npasswordArea.update();\n} else if (me.id.indexOf('approve-mode') == 0) {\nvar approve_mode;\nif (me.id == 'approve-mode-password')\napprove_mode = 'password';\nelse if (me.id == 'approve-mode-click')\napprove_mode = 'click';\nelse\napprove_mode = '';\nhandler.set_option('approve-mode', approve_mode);\nthis.toggleMenuState();\npasswordArea.update();\n}\n}\nevent click $(li#tfa) {\nvar me = this;\nvar has_valid_2fa = handler.has_valid_2fa();\nif (has_valid_2fa) {\nhandler.set_option('2fa', '');\nme.update();\n} else {\nvar new2fa = handler.generate2fa();\nvar src = handler.generate_2fa_img_src(new2fa);\nmsgbox(\"custom-2fa-setting\", translate('enable-2fa-title'),\n<div .form>\n<div>{translate('enable-2fa-desc')}</div>\n<img src={src} />\n<div .code><input name='code' type='text' .outline-focus /></div>\n</div>\n, \"\", function(res=null) {\nif (!res) return;\nif (!res.code) return;\nif (!handler.verify2fa(res.code)) {\nreturn translate('wrong-2fa-code');\n}\nme.update();\n}, 400);\n}\n}\n}\nvar password_cache = [\"\",\"\",\"\",\"\"];\nfunction updatePasswordArea() {\nself.timer(1s, function() {\nvar temporary_password = handler.temporary_password();\nvar verification_method = handler.get_option('verification-method');\nvar temporary_password_length = handler.get_option('temporary-password-length');\nvar approve_mode = handler.get_option('approve-mode');\nvar update = false;\nif (password_cache[0] != temporary_password) {\npassword_cache[0] = temporary_password;\nupdate = true;\n}\nif (password_cache[1] != verification_method) {\npassword_cache[1] = verification_method;\nupdate = true;\n}\nif (password_cache[2] != temporary_password_length) {\npassword_cache[2] = temporary_password_length;\nupdate = true;\n}\nif (password_cache[3] != approve_mode) {\npassword_cache[3] = approve_mode;\nupdate = true;\n}\nif (update) passwordArea.update();\nupdatePasswordArea();\n});\n}\nupdatePasswordArea();\nclass ID: Reactor.Component {\nfunction render() {\nreturn <input type=\"text\" #remote_id .outline-focus novalue={translate(\"Enter Remote ID\")}\nvalue={formatId(handler.get_remote_id())} />;\n}\n// https://github.com/c-smile/sciter-sdk/blob/master/doc/content/sciter/Event.htm\nevent change {\nvar fid = formatId(this.value);\nvar d = this.value.length - (this.old_value || \"\").length;\nthis.old_value = this.value;\nvar start = this.xcall(#selectionStart) || 0;\nvar end = this.xcall(#selectionEnd);\nif (fid == this.value || d <= 0 || start != end) {\nreturn;\n}\n// fix Caret position\nthis.value = fid;\nvar text_after_caret = this.old_value.substr(start);\nvar n = fid.length - formatId(text_after_caret).length;\nthis.xcall(#setSelection, n, n);\n}\n}\nvar reg = /^\\d+$/;\nfunction formatId(id) {\nid = id.replace(/\\s/g, \"\");\nif (reg.test(id) && id.length > 3) {\nvar n = id.length;\nvar a = n % 3 || 3;\nvar new_id = id.substr(0, a);\nfor (var i = a; i < n; i += 3) {\nnew_id += \" \" + id.substr(i, 3);\n}\nreturn new_id;\n}\nreturn id;\n}\nevent keydown (evt) {\nif (view.focus && view.focus.id != 'remote_id') {\nreturn;\n}\nif (!evt.shortcutKey) {\nif (isEnterKey(evt)) {\nvar el = $(button#connect);\nview.focus = el;\nel.sendEvent(\"click\");\n// simulate button click effect, windows does not have this issue\nel.attributes.toggleClass(\"active\", true);\nself.timer(0.3s, function() {\nel.attributes.toggleClass(\"active\", false);\n});\n}\n}\n}\n$(body).content(<div style=\"size:*\"><App /><div #msgbox /></div>);\nfunction self.closing() {\nvar (x, y, w, h) = view.box(#rectw, #border, #screen);\nhandler.closing(x, y, w, h);\nreturn true;\n}\nfunction self.ready() {\nvar r = handler.get_size();\nif (isReasonableSize(r) && r[2] > 0) {\nvar (sx, sy, sw, sh) = view.screenBox(#workarea, #rectw);\nif (r[2] >= sw && r[3] >= sh) {\nself.timer(1ms, function() { view.windowState = View.WINDOW_MAXIMIZED; });\n} else {\nview.move(r[0], r[1], r[2], r[3]);\n}\n} else {\ncenterize(scaleIt(800), scaleIt(600));\n}\nif (!handler.get_remote_id()) {\nview.focus = $(#remote_id);\n}\nrefreshCurrentUser();\nupdateTheme();\n}\nfunction showAbout() {\nmyIdMenu.showAbout();\n}\nfunction showSettings() {\nif ($(#overlay).style#display == 'block') return;\nmyIdMenu.showSettingMenu();\n}\nfunction checkConnectStatus() {\nhandler.check_mouse_time(); // trigger connection status updater\nself.timer(1s, function() {\nvar tmp = !!handler.get_option(\"stop-service\");\nif (tmp != service_stopped) {\nservice_stopped = tmp;\napp.update();\n}\ntmp = handler.using_public_server();\nif (tmp != using_public_server) {\nusing_public_server = tmp;\napp.connect_status.update();\n}\ntmp = handler.get_connect_status();\nif (tmp[0] != connect_status) {\nconnect_status = tmp[0];\napp.connect_status.update();\nmyIdMenu.update();\n}\nif (tmp[1] != key_confirmed) {\nkey_confirmed = tmp[1];\napp.update();\n}\nif (tmp[2] && tmp[2] != my_id) {\nstdout.println(\"id updated\");\napp.update();\n}\ntmp = handler.get_error();\nif (system_error != tmp) {\nsystem_error = tmp;\napp.update();\n}\ntmp = handler.get_software_update_url();\nif (tmp != software_update_url) {\nsoftware_update_url = tmp;\napp.update();\n}\nif (handler.recent_sessions_updated()) {\nstdout.println(\"recent sessions updated\");\nupdateAbPeer();\napp.update();\n}\ncheck_if_overlay();\ncheckConnectStatus();\n});\n}\nvar enter = false;\nfunction self.onMouse(evt) {\nswitch(evt.type) {\ncase Event.MOUSE_ENTER:\nenter = true;\ncheck_if_overlay();\nbreak;\ncase Event.MOUSE_LEAVE:\n$(#overlay).style#display = 'none';\nenter = false;\nbreak;\n}\n}\nfunction check_if_overlay() {\nif (handler.get_option('allow-remote-config-modification') != 'Y') {\nvar time0 = getTime();\nhandler.check_mouse_time();\nself.timer(120ms, function() {\nif (!enter) return;\nvar d = time0 - handler.get_mouse_time();\nif (d < 120) $(#overlay).style#display = 'block';\n});\n}\n}\ncheckConnectStatus();\nfunction set_local_user_info(user) {\nvar user_info = {name: user.name};\nif (user.status) {\nuser_info.status = user.status;\n}\nhandler.set_local_option(\"user_info\", JSON.stringify(user_info));\n}\nfunction login() {\nvar name0 = getUserName();\nvar pass0 = '';\nmsgbox(\"custom-login\", translate('Login'), <div .form .set-password>\n<div><span>{translate('Username')}:</span><input|text name=\"username\" value={name0} .outline-focus /></div>\n<div><span>{translate('Password')}:</span><PasswordComponent value={pass0} /></div>\n</div>, \"\", function(res=null, show_progress) {\nif (!res) return;\nshow_progress();\nvar name = (res.username || '').trim();\nif (!name) {\nshow_progress(false, translate(\"Username missed\"));\nreturn \" \";\n}\nvar pass = (res.password || '').trim();\nif (!pass) {\nshow_progress(false, translate(\"Password missed\"));\nreturn \" \";\n}\nabLoading = true;\nvar url = handler.get_api_server();\nhttpRequest(url + \"/api/login\", #post, {username: name, password: pass, id: my_id, uuid: handler.get_uuid(), type: 'account', deviceInfo: getDeviceInfo()}, function(data) {\nif (data.error) {\nabLoading = false;\nvar err = translate(data.error);\nshow_progress(false, err);\nreturn;\n}\nif (data.type == 'email_check') {\nabLoading = false;\nshow_progress(-1);\non_2fa_check(data);\nreturn;\n}\nhandler.set_local_option(\"access_token\", data.access_token);\nset_local_user_info(data.user);\nshow_progress(-1);\nmyIdMenu.update();\ngetAb();\n}, function(err, status) {\nabLoading = false;\nerr = translate(err);\nif (url.indexOf('sashrdesk') < 0) err = url + ', ' + err;\nshow_progress(false, err);\n});\nreturn \" \";\n});\n}\nfunction on_2fa_check(last_msg) {\nconst isEmailCheck = !last_msg.tfa_type || last_msg.tfa_type == 'email_check';\nconst secret = last_msg.secret;\nconst emailHint = last_msg.user.email;\nmsgbox(\"custom-2fa-verification-code\", translate('Verification code'), <div .form .set-password>\n{ isEmailCheck && <div><span>{translate('Email')}:</span><span>{emailHint}</span></div> }\n<div><span>{translate(isEmailCheck ? 'Verification code' : '2FA code')}:</span><input|text name=\"verification_code\" .outline-focus /></div>\n{ isEmailCheck && <div style=\"font-size:0.9em; margin-bottom:1em;\">{translate('verification_tip')}</div> }\n</div>, \"\",\nfunction(res=null, show_progress) {\nif (!res) return;\nshow_progress();\nvar code = (res.verification_code || '').trim();\nif (!code || code.length < 6) {\nshow_progress(false, translate(\"Too short, at least 6 characters.\"));\nreturn \" \";\n}\nabLoading = true;\nvar url = handler.get_api_server();\nconst loginData = {\nusername: last_msg.user.name,\nid: my_id,\nuuid: handler.get_uuid(),\ntype: 'email_code',\nverificationCode: code,\ntfaCode: isEmailCheck ? '' : code,\nsecret: secret,\ndeviceInfo: getDeviceInfo()\n};\nhttpRequest(url + \"/api/login\", #post, loginData,\nfunction(data) {\nif (data.error) {\nabLoading = false;\nshow_progress(false, data.error);\nreturn;\n}\nhandler.set_local_option(\"access_token\", data.access_token);\nset_local_user_info(data.user);\nshow_progress(-1);\nmyIdMenu.update();\ngetAb();\n},\nfunction(err, status) {\nabLoading = false;\nerr = translate(err);\nif (url.indexOf('sashrdesk') < 0) err = url + ', ' + err;\nshow_progress(false, err);\n}\n);\nreturn \" \";\n}\n);\n}\nfunction reset_token() {\nhandler.set_local_option(\"access_token\", \"\");\nhandler.set_local_option(\"user_info\", \"\");\nhandler.set_local_option(\"selected-tags\", \"\");\nmyIdMenu.update();\nresetAb();\nif (abComponent) {\nabComponent.update();\n}\n}\nfunction logout() {\nvar url = handler.get_api_server();\nhttpRequest(url + \"/api/logout\", #post, {id: my_id, uuid: handler.get_uuid()}, function(data) {\n}, function(err, status) {\nmsgbox(\"custom-error\", translate('Error'), err);\n}, getHttpHeaders());\nreset_token();\n}\nfunction refreshCurrentUser() {\nif (!handler.get_local_option(\"access_token\")) return;\nabLoading = true;\nabError = \"\";\napp.update();\nhttpRequest(handler.get_api_server() + \"/api/currentUser\", #post, {id: my_id, uuid: handler.get_uuid()}, function(data) {\nif (data.error) {\nif (data.error == 'Invalid token') {\nreset_token();\n}\nhandleAbError(data.error);\nreturn;\n}\nset_local_user_info(data);\nmyIdMenu.update();\ngetAb();\n}, function(err, status) {\nif (status == 401 || status == 400) {\nreset_token();\n}\nhandleAbError(err);\n}, getHttpHeaders());\n}\nfunction getHttpHeaders() {\nreturn \"Authorization: Bearer \" + handler.get_local_option(\"access_token\");\n}\nfunction getDeviceInfo() {\nreturn JSON.parse(handler.get_login_device_info());\n}\n</script>\n</head>\n<body>\n</body>\n</html>\n";
const _REMOTE: &[u8; 88951] = b"<html window-resizable window-frame=\"extended\">\n<head>\n<style>\n@import url(common.css);\nbody {\nmargin: 0;\ncolor: black;\noverflow: scroll-indicator;\n}\ndiv#video-wrapper {\nsize: *;\nbackground: #212121;\n}\ndiv#quality-monitor {\ntop: 20px;\nright: 20px;\nbackground: #7571719c;\npadding: 5px;\nmin-width: 150px;\ncolor: azure;\nborder: 0.5px solid azure;\n}\nvideo#handler {\nbehavior: native-remote video;\nsize: *;\nmargin: *;\nforeground-size: contain;\n}\nimg#cursor {\nposition: absolute;\ndisplay: none;\n//opacity: 0.66,\n//transform: scale(0.8);\n}\n.goup {\ntransform: rotate(90deg);\n}\ntable#remote-folder-view {\ncontext-menu: selector(menu#remote-folder-view);\n}\ntable#local-folder-view {\ncontext-menu: selector(menu#local-folder-view);\n}\ndiv#file-transfer-wrapper {\nsize:*;\ndisplay: none;\n}\ndiv#file-transfer {\nsize: *;\nmargin: 0;\nflow: horizontal;\nbackground: color(gray-bg);\npadding: 0.5em;\n}\ntable\n{\nfont: system;\nborder: 1px solid color(border);\nflow: table-fixed;\nprototype: Grid;\nsize: *;\npadding:0;\nborder-spacing: 0;\noverflow-x: auto;\noverflow-y: hidden;\n}\ntable > thead {\nbehavior: column-resizer;\nborder-bottom: color(border) solid 1px;\n}\ntable > tbody {\nbehavior: select-multiple;\noverflow-y: scroll-indicator;\nsize: *;\nbackground: white;\n}\ntable th {\nbackground-color: color(gray-bg);\n}\ntable th\n{\npadding: 4px;\nforeground-repeat: no-repeat;\nforeground-position: 50% 3px auto auto;\nborder-left: color(border) solid 1px;\n}\ntable th.sortable[sort=asc]\n{\nforeground-image: url(stock:arrow-down);\n}\ntable th.sortable[sort=desc]\n{\nforeground-image: url(stock:arrow-up);\n}\ntable th:nth-child(1)  {\nwidth: 32px;\n}\ntable th:nth-child(2)  {\nwidth: *;\n}\ntable th:nth-child(3)  {\nwidth: *;\n}\ntable th:nth-child(4)  {\nwidth: 45px;\n}\ntable.has_current thead th:current {\nfont-weight: bold;\n}\ntable tr:nth-child(odd) { background-color: white; } /* each odd row */\ntable tr:nth-child(even) { background-color: #F4F5F6; } /* each even row */\ntable.has_current tr:current /* current row */\n{\nbackground-color: color(accent);\n}\ntable.has_current tbody tr:checked\n{\nbackground-color: color(accent);\n}\ntable.has_current tbody tr:checked td {\ncolor: highlighttext;\n}\ntable td\n{\npadding: 4px;\ntext-align: left;\nfont-size: 1em;\nheight: 1.4em;\n@ELLIPSIS;\n}\ntable.folder-view td:nth-child(1) {\nbehavior:shell-icon;\n}\ntable td:nth-child(3), table td:nth-child(4) {\ncolor: color(lighter-text);\nfont-size: 0.9em;\n}\ntable.has_current tr:current td {\ncolor: white;\n}\ntable td:nth-child(4) {\ntext-align: right;\n}\nsection {\nsize: *;\nmargin: 1em;\nborder-spacing: 0.5em;\n}\ntable td:nth-child(1)  {\nforeground-repeat: no-repeat;\nforeground-position: 50% 50%\n}\ndiv.toolbar {\nflow: horizontal;\n}\ndiv.toolbar svg {\nsize: 16px;\n}\ndiv.toolbar .spacer {\nwidth: *;\n}\ndiv.toolbar > div.button {\npadding: 4px 8px;\nopacity: 0.66;\n}\ndiv.toolbar > div.button:active {\nopacity: 1;\nbackground-color: #ddd;\n}\ndiv.toolbar > div.button:hover {\nopacity: 1;\n}\ndiv.toolbar > div.send {\nflow: horizontal;\nborder-spacing: 0.5em;\n}\ndiv.remote > div.send svg {\ntransform: scale(-1, 1);\n}\ndiv.navbar {\nborder: color(border) solid 1px;\npadding: 4px 0;\n}\nselect.select-dir {\nwidth: *;\npadding: 0 4px;\n}\ndiv.title {\nflow: horizontal;\nborder-spacing: 1em;\nposition: relative;\n}\ndiv.title svg.computer {\nsize: 48px;\n}\ndiv.title div {\nmargin: * 0;\ncolor: color(light-text);\n}\ndiv.title div.platform {\nposition: absolute;\nleft: 12px;\ntop: 7px;\n}\ndiv.title div.platform svg {\nsize: 24px;\n}\ntable.job-table tr td {\nwidth: *;\npadding: 0.5em 1em;\nborder-bottom: color(border) 1px solid;\nflow: horizontal;\nborder-spacing: 1em;\nheight: 3em;\noverflow-x: hidden;\n}\ntable.job-table tr svg {\nsize: 16px;\n}\ntable.job-table tr.is_remote svg {\ntransform: scale(-1, 1);\n}\ntable.job-table tr.is_remote div.svg_continue svg {\ntransform: scale(1, 1);\n}\ntable.job-table tr td div.text {\nwidth: *;\noverflow-x: hidden;\n}\ntable.job-table tr td div.path {\nwidth: *;\ncolor: color(light-text);\n@ELLIPSIS;\n}\ntable.job-table tr:current td div.path {\ncolor: white;\n}\ntable#port-forward thead tr th {\npadding-left: 1em;\nsize: *;\n}\ntable#port-forward tr td {\nheight: 3em;\ntext-align: left;\n}\ntable#port-forward input[type=text], table#port-forward input[type=number] {\nfont-size: 1.2em;\n}\ntable#port-forward td.right-arrow svg {\nsize: 1.2em;\ntransform: rotate(180deg);\n}\ntable#port-forward td.remove svg {\nsize: 0.8em;\n}\ntable#port-forward tr.value td {\npadding-left: 1em;\nfont-size: 1.5em;\ncolor: black;\n}\nheader div {\nword-wrap: normal;\n}\nheader #screens {\nbackground: white;\nborder: #A9A9A9 1px solid;\nheight: 22px;\nborder-radius: 4px;\nflow: horizontal;\nborder-spacing: 0.5em;\npadding-right: 1em;\nposition: relative;\n}\nheader #screen {\ntext-align: center;\nmargin: 3px 0;\nwidth: 18px;\nheight: 14px;\nborder: color(border) solid 1px;\nfont-size: 11px;\ncolor: color(light-text);\n}\n@media platform == \"OSX\" {\nheader #screen {\nline-height: 11px;\n}\n}\nheader #secure {\nposition: absolute;\nleft: -10px;\ntop: -2px;\n}\nheader #secure svg {\nsize: 18px;\n}\nheader .remote-id {\nwidth: 80px;\n@ELLIPSIS;\npadding-left: 30px;\npadding-right: 4em;\nmargin: * 0;\n}\nheader span:hover {\nbackground: #f7f7f7;\n}\n@media platform != \"OSX\" {\nheader span:hover {\nbackground: #d9d9d9;\n}\n}\nheader #screen:hover {\nbackground: #d9d9d9;\n}\nheader #secure:hover {\nbackground: unset;\n}\nheader span:active, header #screen:active {\ncolor: black;\nbackground: color(gray-bg);\n}\ndiv#global-screens {\nposition: relative;\nmargin: 2px 0;\n}\ndiv#global-screens > div {\nposition: absolute;\nborder: color(border) solid 1px;\ntext-align: center;\ncolor: color(light-text);\n}\nheader #screen.current, div#global-screens > div.current {\nbackground: #666;\ncolor: white;\n}\nspan#fullscreen.active {\nborder: color(border) solid 1px;\n}\nbutton:disabled {\nopacity: 0.3;\n}\n</style>\n<script type=\"text/tiscript\">\ninclude \"common.tis\";\nfunction translate_text(text) {\nif (text.indexOf('Failed') == 0 && text.indexOf(': ') > 0) {\nvar fds = text.split(': ');\nfor (var i = 0; i < fds.length; ++i) {\nfds[i] = translate(fds[i]);\n}\ntext = fds.join(': ');\n} else {\nvar fds = text.split(' ');\nif (fds.length > 1 && fds[0].slice(-4) === '_tip') {\nfds[0] = translate(fds[0]);\nvar rest = text.substring(fds[0].length + 1);\ntext = fds[0] + ' ' + translate(rest);\n} else {\ntext = translate(text);\n}\n}\nreturn text;\n}\nvar msgboxTimerFunc = function() {}\nfunction closeMsgbox() {\nself.timer(0, msgboxTimerFunc);\n$(#msgbox).content(<span />);\n}\nclass MsgboxComponent: Reactor.Component {\nfunction this(params) {\nthis.width = params.width;\nthis.height = params.height;\nthis.type = params.type;\nthis.title = params.title;\nthis.content = params.content;\nthis.link = params.link;\nthis.remember = params.remember;\nthis.callback = params.callback;\nthis.hasRetry = params.hasRetry;\nthis.autoLogin = params.autoLogin;\nthis.contentStyle = params.contentStyle;\ntry { this.content = translate_text(this.content); } catch (e) {}\n}\nfunction getIcon(color) {\nif (this.type == \"input-password\" || this.type == \"session-login\" || this.type == \"session-login-password\" || this.type == \"input-2fa\") {\nreturn <svg viewBox=\"0 0 505 505\"><circle cx=\"252.5\" cy=\"252.5\" r=\"252.5\" fill={color}/><path d=\"M271.9 246.1c29.2 17.5 67.6 13.6 92.7-11.5 29.7-29.7 29.7-77.8 0-107.4s-77.8-29.7-107.4 0c-25.1 25.1-29 63.5-11.5 92.7L118.1 347.4l26.2 26.2 26.4 26.4 10.6-10.6-10.1-10.1 9.7-9.7 10.1 10.1 10.6-10.6-10.1-10 9.7-9.7 10.1 10.1 10.6-10.6-26.4-26.3 76.4-76.5z\" fill=\"#fff\"/><circle cx=\"337.4\" cy=\"154.4\" r=\"17.7\" fill={color}/></svg>;\n}\nif (this.type == \"connecting\") {\nreturn <svg viewBox=\"0 0 300 300\"><g fill={color}><path d=\"m221.76 89.414h-143.51c-1.432 0-2.594 1.162-2.594 2.594v95.963c0 1.432 1.162 2.594 2.594 2.594h143.51c1.432 0 2.594-1.162 2.594-2.594v-95.964c0-1.431-1.162-2.593-2.594-2.593z\"/><path d=\"m150 0c-82.839 0-150 67.161-150 150s67.156 150 150 150 150-67.163 150-150-67.164-150-150-150zm92.508 187.97c0 11.458-9.29 20.749-20.749 20.749h-47.144v11.588h23.801c4.298 0 7.781 3.483 7.781 7.781s-3.483 7.781-7.781 7.781h-96.826c-4.298 0-7.781-3.483-7.781-7.781s3.483-7.781 7.781-7.781h23.801v-11.588h-47.145c-11.458 0-20.749-9.29-20.749-20.749v-95.963c0-11.458 9.29-20.749 20.749-20.749h143.51c11.458 0 20.749 9.29 20.749 20.749v95.963z\"/></g><path d=\"m169.62 154.35c-5.0276-5.0336-11.97-8.1508-19.624-8.1508-7.6551 0-14.597 3.1172-19.624 8.1508l-11.077-11.091c7.8656-7.8752 18.725-12.754 30.701-12.754s22.835 4.8788 30.701 12.754l-11.077 11.091zm-32.184 7.0728 12.56 12.576 12.56-12.576c-3.2147-3.2172-7.6555-5.208-12.56-5.208-4.9054 0-9.3457 1.9908-12.56 5.208zm12.56-39.731c14.403 0 27.464 5.8656 36.923 15.338l11.078-11.091c-12.298-12.314-29.276-19.94-48-19.94-18.724 0-35.703 7.626-48 19.94l11.077 11.091c9.4592-9.4728 22.52-15.338 36.923-15.338z\" fill=\"#fff\"/></svg>;\n}\nif (this.type == \"success\") {\nreturn <svg viewBox=\"0 0 512 512\"><circle cx=\"256\" cy=\"256\" r=\"256\" fill={color} /><path fill=\"#fff\" d=\"M235.472 392.08l-121.04-94.296 34.416-44.168 74.328 57.904 122.672-177.016 46.032 31.888z\"/></svg>;\n}\nif (this.type.indexOf(\"error\") >= 0 || this.type == \"re-input-password\" || this.type == \"input-2fa\" || this.type == \"session-re-login\" || this.type == \"session-login-re-password\") {\nreturn <svg viewBox=\"0 0 512 512\"><ellipse cx=\"256\" cy=\"256\" rx=\"256\" ry=\"255.832\" fill={color}/><g fill=\"#fff\"><path d=\"M376.812 337.18l-39.592 39.593-201.998-201.999 39.592-39.592z\"/><path d=\"M376.818 174.825L174.819 376.824l-39.592-39.592 201.999-201.999z\"/></g></svg>;\n}\nreturn null;\n}\nfunction getInputPasswordContent() {\nvar ts = this.remember ? { checked: true } : {};\nreturn <div .form>\n<div>{translate('Please enter your password')}</div>\n<PasswordComponent />\n<div><button|checkbox(remember) {ts}>{translate('Remember password')}</button></div>\n</div>;\n}\nfunction get2faContent() {\nreturn <div .form>\n<div>{translate('enter-2fa-title')}</div>\n<div .code><input name='code' type='text' .outline-focus /></div>\n</div>;\n}\nfunction getInputUserPasswordContent() {\nreturn <div .form>\n<div>{translate(\"OS Username\")}</div>\n<div .username><input name='osusername' type='text' .outline-focus /></div>\n<div>{translate(\"OS Password\")}</div>\n<PasswordComponent name='ospassword' />\n<div></div>\n</div>;\n}\nfunction getXsessionPasswordContent() {\nreturn <div .form>\n<div>{translate(\"OS Username\")}</div>\n<div .username><input name='osusername' type='text' .outline-focus /></div>\n<div>{translate(\"OS Password\")}</div>\n<PasswordComponent name='ospassword' />\n<div>{translate('Please enter your password')}</div>\n<PasswordComponent />\n<div><button|checkbox(remember) {ts}>{translate('Remember password')}</button></div>\n</div>;\n}\nfunction getContent() {\nif (this.type == \"input-password\") {\nreturn this.getInputPasswordContent();\n} else if (this.type == \"input-2fa\") {\nreturn this.get2faContent();\n} else if (this.type == \"session-login\") {\nreturn this.getInputUserPasswordContent();\n} else if (this.type == \"session-login-password\") {\nreturn this.getXsessionPasswordContent();\n} else if (this.type == \"custom-os-password\") {\nvar ts = this.autoLogin ? { checked: true } : {};\nreturn <div .form>\n<PasswordComponent value={this.content} />\n<div><button|checkbox(autoLogin) {ts} style=\"width: *; word-wrap: break-word; overflow-wrap: break-word; white-space: normal; height: auto; overflow: hidden;\">{translate('Auto Login')}</button></div>\n</div>;\n}\nreturn this.content;\n}\nfunction getColor() {\nif (this.type == \"input-password\" || this.type == \"input-2fa\" || this.type == \"custom-os-password\" || this.type == \"session-login\" || this.type == \"session-login-password\") {\nreturn \"#AD448E\";\n}\nif (this.type == \"success\") {\nreturn \"#32bea6\";\n}\nif (this.type.indexOf(\"error\") >= 0 || this.type == \"re-input-password\" || this.type == \"session-re-login\" || this.type == \"session-login-re-password\") {\nreturn \"#e04f5f\";\n}\nreturn \"#2C8CFF\";\n}\nfunction hasSkip() {\nreturn this.type.indexOf(\"skip\") >= 0;\n}\nfunction render() {\nthis.set_outline_focus();\nvar color = this.getColor();\nvar icon = this.getIcon(color);\nvar content = this.getContent();\nvar hasCancel = this.type.indexOf(\"error\") < 0 && this.type.indexOf(\"nocancel\") < 0 && this.type != \"restarting\";\nvar hasOk = this.type != \"connecting\" && this.type != \"success\" && this.type.indexOf(\"nook\") < 0;\nvar hasLink = this.link != \"\";\nvar hasClose = this.type.indexOf(\"hasclose\") >= 0;\nvar show_progress = this.type == \"connecting\";\nvar me = this;\nself.timer(0, msgboxTimerFunc);\nmsgboxTimerFunc = function() {\nif (typeof content == \"string\")\nme.$(#content).html = translate(content);\nelse\nme.$(#content).content(content);\n};\nself.timer(3ms, msgboxTimerFunc);\nreturn (<div><div style=\"position: absolute; size:*; background:black; opacity:0.5;\" />\n<div style=\"size: *; position: absolute;\">\n<div style={\"border: \" + color + \" solid 1px; background: color(bg); margin: *; width:\" + (this.width) + \"px; min-height:\" + (this.height) + \"px\"}>\n<div .caption style={\"background: \" + color}>\n{translate(this.title)}\n</div>\n<div style=\"padding: 1em 2em; size: *;\">\n<div style=\"height: *; flow: horizontal\">\n{icon && <div style=\"height: *; margin: * 0; padding-right: 2em;\" .msgbox-icon>{icon}</div>}\n<div style={this.contentStyle || \"size: *; margin: * 0;\"} #content />\n</div>\n<div style=\"text-align: right;\">\n<span style=\"display:inline-block; max-width: 250px; font-size:12px;\" #error />\n<progress #progress style={\"color:\" + color + \"; display: \" + (show_progress ? \"inline-block\" : \"none\")} />\n{hasCancel || this.hasRetry ? <button .button #cancel .outline>{translate(this.hasRetry ? \"OK\" : \"Cancel\")}</button> : \"\"}\n{this.hasSkip() ? <button .button #skip .outline>{translate('Skip')}</button> : \"\"}\n{hasOk || this.hasRetry ? <button .button #submit>{translate(this.hasRetry ? \"Retry\" : \"OK\")}</button> : \"\"}\n{hasLink ? <button .button #jumplink .outline>{translate('JumpLink')}</button> : \"\"}\n{hasClose ? <button .button #cancel .outline>{translate('Close')}</button> : \"\"}\n</div>\n</div>\n</div>\n</div></div>);\n}\nevent click $(.custom-event) (_, me) {\nif (this.callback) this.callback(me);\n}\nfunction submit() {\nif (this.$(button#submit)) {\nthis.$(button#submit).sendEvent(\"click\");\n}\n}\nfunction cancel() {\nif (this.$(button#cancel)) {\nthis.$(button#cancel).sendEvent(\"click\");\n}\n}\nevent click $(button#cancel) {\nthis.close();\nif (this.callback) this.callback(null);\n}\nevent click $(button#skip) {\nvar values = this.getValues();\nvalues.skip = true;\nif (this.callback) this.callback(values);\nif (this.close) this.close();\n}\nevent click $(button#jumplink) {\nif (this.link.indexOf(\"http\") == 0) {\nSciter.launch(this.link);\n}\n}\nevent click $(button#submit) {\nif (this.type == \"error\") {\nif (this.hasRetry) {\nretryConnect(true);\nreturn;\n}\n}\nif (this.type == \"re-input-password\") {\nthis.type = \"input-password\";\nthis.update();\nreturn;\n}\nif (this.type == \"session-re-login\") {\nthis.type = \"session-login\";\nthis.update();\nreturn;\n}\nif (this.type == \"session-login-re-password\") {\nthis.type = \"session-login-password\";\nthis.update();\nreturn;\n}\nvar values = this.getValues();\nif (this.callback) {\nvar self = this;\nvar err = this.callback(values, function(a=1, b='') { self.show_progress(a, b); });\nif (!err) {\nif (this.close) this.close();\nreturn;\n}\nif (err && err.trim()) this.show_progress(false, err);\n} else {\nthis.close();\n}\n}\nevent keydown (evt) {\nif (!evt.shortcutKey) {\nif (isEnterKey(evt)) {\nthis.submit();\n}\nif (evt.keyCode == Event.VK_ESCAPE) {\nthis.cancel();\n}\n}\n}\nevent click $(button#select_directory) {\nvar folder = view.selectFolder(translate(\"Change\"), $(#folderPath).text);\nif (folder) {\nif (folder.indexOf(\"file://\") == 0) folder = folder.substring(7);\n$(#folderPath).text = folder;\n}\n}\nfunction show_progress(show=1, err=\"\") {\nif (show == -1) {\nthis.close()\nreturn;\n}\nthis.$(#progress).style.set {\ndisplay: show ? \"inline-block\" : \"none\"\n};\nthis.$(#error).text = err;\n}\nfunction getValues() {\nvar values = { type: this.type };\nfor (var el in this.$$(.form input)) {\nvalues[el.attributes[\"name\"]] = el.value;\n}\nfor (var el in this.$$(.form textarea)) {\nvalues[el.attributes[\"name\"]] = el.value;\n}\nfor (var el in this.$$(.form button)) {\nvalues[el.attributes[\"name\"]] = el.value;\n}\nif (this.type == \"input-password\") {\nvalues.password = (values.password || \"\").trim();\nif (!values.password) {\nreturn;\n}\n}\nif (this.type == \"input-2fa\") {\nvalues.code = (values.code || \"\").trim();\nif (!values.code) {\nreturn;\n}\n}\nif (this.type == \"session-login\") {\nvalues.osusername = (values.osusername || \"\").trim();\nvalues.ospassword = (values.ospassword || \"\").trim();\nif (!values.osusername || !values.ospassword) {\nreturn;\n}\n}\nif (this.type == \"session-login-password\") {\nvalues.password = (values.password || \"\").trim();\nvalues.osusername = (values.osusername || \"\").trim();\nvalues.ospassword = (values.ospassword || \"\").trim();\nif (!values.osusername || !values.ospassword || !values.password) {\nreturn;\n}\n}\nif (this.type == \"multiple-sessions-nocancel\") {\nvalues.sid = (this.$$(select))[0].value;\n}\nreturn values;\n}\nfunction set_outline_focus() {\nvar me = this;\nself.timer(30ms, function() {\nvar el = me.$(.outline-focus);\nif (el) view.focus = el;\nelse {\nel = me.$(#submit);\nif (el) {\nview.focus = el;\n}\n}\n});\n}\nfunction close() {\ncloseMsgbox();\n}\n}\nvar cursor_img = $(img#cursor);\nis_file_transfer = handler.is_file_transfer();\nvar is_port_forward = handler.is_port_forward();\nvar input_blocked = false;\nvar display_width = 0;\nvar display_height = 0;\nvar display_origin_x = 0;\nvar display_origin_y = 0;\nvar display_cursor_embedded = false;\nvar display_scale = 1;\nvar keyboard_enabled = true; // server side\nvar clipboard_enabled = true; // server side\nvar audio_enabled = true; // server side\nvar file_enabled = true; // server side\nvar restart_enabled = true; // server side\nvar recording_enabled = true; // server side\nvar scroll_body = $(body);\nhandler.setDisplay = function(x, y, w, h, cursor_embedded) {\ndisplay_width = w;\ndisplay_height = h;\ndisplay_origin_x = x;\ndisplay_origin_y = y;\ndisplay_cursor_embedded = cursor_embedded;\nadaptDisplay();\nif (recording) handler.record_screen(true, 0, w, h);\n}\n// in case toolbar not shown correctly\nview.windowMinSize = (scaleIt(500), scaleIt(300));\nfunction adaptDisplay() {\nvar w = display_width;\nvar h = display_height;\nif (!w || !h) return;\nvar style = handler.get_view_style();\ndisplay_scale = 1.;\nvar (sx, sy, sw, sh) = view.screenBox(view.windowState == View.WINDOW_FULL_SCREEN ? #frame : #workarea, #rectw);\nif (sw >= w && sh > h) {\nvar hh = $(header).box(#height, #border);\nvar el = $(div#adjust-window);\nif (sh > h + hh && el) {\nel.style.set{ display: \"block\" };\nel = $(li#adjust-window);\nel.style.set{ display: \"block\" };\nel.onClick = function() {\nview.windowState == View.WINDOW_SHOWN;\nvar (x, y) = view.box(#position, #border, #screen);\n// extra for border\nvar extra = is_win ? 4 : 2;\nview.move(x, y, (w + extra).toInteger(), (h + hh + extra).toInteger());\n}\n}\n}\nif (style != \"original\") {\nvar bw = $(body).box(#width, #border);\nvar bh = $(body).box(#height, #border);\nif (view.windowState == View.WINDOW_FULL_SCREEN) {\nbw = sw;\nbh = sh;\n}\nif (bw > 0 && bh > 0) {\nvar scale_x = bw.toFloat() / w;\nvar scale_y = bh.toFloat() / h;\nvar scale = scale_x < scale_y ? scale_x : scale_y;\nif ((scale > 1 && style == \"stretch\") ||\n(scale < 1 && style == \"shrink\")) {\ndisplay_scale = scale;\nw = w * scale;\nh = h * scale;\n}\n}\n}\nrefreshCursor();\nhandler.style.set {\nwidth: w / scaleFactor + \"px\",\nheight: h / scaleFactor + \"px\",\n};\n}\n// https://sciter.com/event-handling/\n// https://sciter.com/docs/content/sciter/Event.htm\nvar entered = false;\nif (!is_file_transfer && !is_port_forward) {\nself.onKey = function(evt) {\nif (!entered) return false;\n// so that arrow key not move scrollbar\nreturn true;\n}\n}\nvar wait_window_toolbar = false;\nvar last_mouse_mask;\nvar is_left_down = false;\nvar acc_wheel_delta_x = 0;\nvar acc_wheel_delta_y = 0;\nvar last_wheel_time = 0;\nvar inertia_velocity_x = 0;\nvar inertia_velocity_y = 0;\nvar acc_wheel_delta_x0 = 0;\nvar acc_wheel_delta_y0 = 0;\nvar total_wheel_time = 0;\nvar wheeling = false;\nvar dragging = false;\nvar is_mouse_event_triggered = false;\n// https://stackoverflow.com/questions/5833399/calculating-scroll-inertia-momentum\nfunction resetWheel() {\nacc_wheel_delta_x = 0;\nacc_wheel_delta_y = 0;\nlast_wheel_time = 0;\ninertia_velocity_x = 0;\ninertia_velocity_y = 0;\nacc_wheel_delta_x0 = 0;\nacc_wheel_delta_y0 = 0;\ntotal_wheel_time = 0;\nwheeling = false;\n}\nvar INERTIA_ACCELERATION = 30;\n// not good, precision not enough to simulate acceleration effect,\n// seems have to use pixel based rather line based delta\nfunction accWheel(v, is_x) {\nif (wheeling) return;\nvar abs_v = Math.abs(v);\nvar max_t = abs_v / INERTIA_ACCELERATION;\nfor (var t = 0.1; t < max_t; t += 0.1) {\nvar d = Math.round((abs_v - t * INERTIA_ACCELERATION / 2) * t).toInteger();\nif (d >= 1) {\nabs_v -= t * INERTIA_ACCELERATION;\nif (v < 0) {\nd = -d;\nv = -abs_v;\n} else {\nv = abs_v;\n}\nhandler.send_mouse(3, is_x ? d : 0, !is_x ? d : 0, false, false, false, false);\naccWheel(v, is_x);\nbreak;\n}\n}\n}\nfunction handler.onMouse(evt)\n{\nis_mouse_event_triggered = true;\nif (is_file_transfer || is_port_forward) return false;\nif (view.windowState == View.WINDOW_FULL_SCREEN && !dragging) {\nvar dy = evt.y - scroll_body.scroll(#top);\nif (dy <= 1) {\nif (!wait_window_toolbar) {\nwait_window_toolbar = true;\nself.timer(300ms, function() {\nif (!wait_window_toolbar) return;\nvar extra = 0;\n// workaround for stupid Sciter, without this, click\n// event not triggered on top part of buttons on toolbar\nif (is_osx) extra = 10;\nif (view.windowState == View.WINDOW_FULL_SCREEN) {\n$(header).style.set {\ndisplay: \"block\",\npadding: (2 * workarea_offset + extra) + \"px 0 0 0\",\n};\n}\nwait_window_toolbar = false;\n});\n}\n} else {\nwait_window_toolbar = false;\nvar h = $(header).style;\nif (dy > 20 && h#display != \"none\") {\nh.set {\ndisplay: \"none\",\n};\n}\n}\n}\nif (!got_mouse_control) {\nif (Math.abs(evt.x - cur_local_x) > 12 || Math.abs(evt.y - cur_local_y) > 12) {\ngot_mouse_control = true;\n} else {\nreturn;\n}\n}\nvar mask = 0;\nvar wheel_delta_x;\nvar wheel_delta_y;\nswitch(evt.type) {\ncase Event.MOUSE_DOWN:\nmask = 1;\ndragging = true;\nbreak;\ncase Event.MOUSE_UP:\nmask = 2;\ndragging = false;\nbreak;\ncase Event.MOUSE_MOVE:\nif (display_cursor_embedded) {\nbreak;\n}\nif (cursor_img.style#display != \"none\" && keyboard_enabled) {\ncursor_img.style#display = \"none\";\n}\nif (!keyboard_enabled && !useSystemCursor) {\nupdateCursor(true);\n}\nif (keyboard_enabled && useSystemCursor) {\nupdateCursor();\n}\nbreak;\ncase Event.MOUSE_WHEEL:\n// mouseWheelDistance = 8 * [currentUserDefs floatForKey:@\"com.apple.scrollwheel.scaling\"];\nmask = 3;\n{\nvar (dx, dy) = evt.wheelDeltas;\nif (dx > 0) dx = 1;\nelse if (dx < 0) dx = -1;\nif (dy > 0) dy = 1;\nelse if (dy < 0) dy = -1;\nif (Math.abs(dx) > Math.abs(dy)) {\ndy = 0;\n} else {\ndx = 0;\n}\nacc_wheel_delta_x += dx;\nacc_wheel_delta_y += dy;\nwheel_delta_x = acc_wheel_delta_x.toInteger();\nwheel_delta_y = acc_wheel_delta_y.toInteger();\nacc_wheel_delta_x -= wheel_delta_x;\nacc_wheel_delta_y -= wheel_delta_y;\nvar now = getTime();\nvar dt = last_wheel_time > 0 ? (now - last_wheel_time) / 1000 : 0;\nif (dt > 0) {\nvar vx = dx / dt;\nvar vy = dy / dt;\nif (vx != 0 || vy != 0) {\ninertia_velocity_x = vx;\ninertia_velocity_y = vy;\n}\n}\nacc_wheel_delta_x0 += dx;\nacc_wheel_delta_y0 += dy;\ntotal_wheel_time += dt;\nif (dx == 0 && dy == 0) {\nwheeling = false;\nif (dt < 0.1 && total_wheel_time > 0) {\nvar v2 = (acc_wheel_delta_y0 / total_wheel_time) * inertia_velocity_y;\nif (v2 > 0) {\nv2 = Math.sqrt(v2);\ninertia_velocity_y = inertia_velocity_y < 0 ? -v2  : v2;\naccWheel(inertia_velocity_y, false);\n}\nv2 = (acc_wheel_delta_x0 / total_wheel_time) * inertia_velocity_x;\nif (v2 > 0) {\nv2 = Math.sqrt(v2);\ninertia_velocity_x = inertia_velocity_x < 0 ? -v2  : v2;\naccWheel(inertia_velocity_x, true);\n}\n}\nresetWheel();\n} else {\nwheeling = true;\n}\nlast_wheel_time = now;\nif (wheel_delta_x == 0 && wheel_delta_y == 0) return keyboard_enabled;\n}\nbreak;\ncase Event.MOUSE_DCLICK: // seq: down, up, dclick, up\nmask = 1;\nbreak;\ncase Event.MOUSE_ENTER:\nentered = true;\nstdout.println(\"enter\");\nhandler.enter(handler.get_keyboard_mode());\nreturn keyboard_enabled;\ncase Event.MOUSE_LEAVE:\nentered = false;\nstdout.println(\"leave\");\nhandler.leave(handler.get_keyboard_mode());\nif (is_left_down && handler.peer_platform() == \"Android\") {\nis_left_down = false;\nhandler.send_mouse((1 << 3) | 2, 0, 0, evt.altKey,\nevt.ctrlKey, evt.shiftKey, evt.commandKey);\n}\nreturn keyboard_enabled;\ndefault:\nreturn false;\n}\nvar x = evt.x;\nvar y = evt.y;\nif (mask != 0) {\n// to gain control of the mouse, user must move mouse\nif (cur_x != x || cur_y != y) {\nreturn keyboard_enabled;\n}\n} else {\ncur_local_x = cur_x = x;\ncur_local_y = cur_y = y;\n}\nif (mask != 3) {\nresetWheel();\n}\nif (!keyboard_enabled) return false;\nx = (x / display_scale).toInteger();\ny = (y / display_scale).toInteger();\n// insert down between two up, osx has this behavior for triple click\nif (last_mouse_mask == 2 && mask == 2) {\nhandler.send_mouse((evt.buttons << 3) | 1, 0, 0, evt.altKey,\nevt.ctrlKey, evt.shiftKey, evt.commandKey);\n}\nlast_mouse_mask = mask;\nif (evt.buttons == 1) {\nif (mask == 1) {\nis_left_down = true;\n} else if (mask == 2) {\nis_left_down = false;\n}\n}\n// to-do: altKey, ctrlKey etc\nhandler.send_mouse((evt.buttons << 3) | mask,\nmask == 3 ? wheel_delta_x : (mask == 0 ? x + display_origin_x : 0),\nmask == 3 ? wheel_delta_y : (mask == 0 ? y + display_origin_y : 0),\nevt.altKey,\nevt.ctrlKey, evt.shiftKey, evt.commandKey);\nreturn true;\n};\nvar cur_id = -1;\nvar cur_hotx = 0;\nvar cur_hoty = 0;\nvar cur_img = null;\nvar cur_x = 0;\nvar cur_y = 0;\nvar cur_local_x = 0;\nvar cur_local_y = 0;\nvar cursors = {};\nvar image_binded;\nfunction scaleCursorImage(img) {\nvar w = (img.width * display_scale).toInteger();\nvar h = (img.height * display_scale).toInteger();\ncursor_img.style.set {\nwidth: w + \"px\",\nheight: h + \"px\",\n};\nself.bindImage(\"in-memory:cursor\", img);\nif (display_scale == 1) return img;\nfunction paint(gfx) {\ngfx.drawImage(img, 0, 0, w, h);\n}\nreturn new Image(w, h, paint);\n}\nvar useSystemCursor = true;\nfunction updateCursor(system=false) {\nstdout.println(\"Update cursor, system: \" + system);\nuseSystemCursor = system;\nif (system) {\nhandler.style#cursor = undefined;\n} else if (cur_img) {\nhandler.style.cursor(cur_img, (cur_hotx * display_scale).toInteger(), (cur_hoty * display_scale).toInteger());\n}\n}\nfunction refreshCursor() {\nif (display_cursor_embedded) {\ncursor_img.style#display = \"none\";\nreturn;\n}\nif (cur_id != -1) {\nhandler.setCursorId(cur_id);\n}\n}\nhandler.setCursorData = function(id, hotx, hoty, width, height, colors) {\ncur_hotx = hotx;\ncur_hoty = hoty;\nvar img = Image.fromBytes(colors);\nif (img) {\nimage_binded = true;\ncursors[id] = [img, hotx, hoty, width, height];\ncur_id = id;\nimg = scaleCursorImage(img);\nif (!first_mouse_event_triggered || cursor_img.style#display == 'none') {\nself.timer(1ms, updateCursor);\n}\ncur_img = img;\n}\n}\nhandler.setCursorId = function(id) {\nvar img = cursors[id];\nif (img) {\ncur_id = id;\nimage_binded = true;\ncur_hotx = img[1];\ncur_hoty = img[2];\nimg = scaleCursorImage(img[0]);\nif (!first_mouse_event_triggered || cursor_img.style#display == 'none') {\nself.timer(1ms, updateCursor);\n}\ncur_img = img;\n}\n}\nvar got_mouse_control = true;\nhandler.setCursorPosition = function(x, y) {\nif (!image_binded) return;\ngot_mouse_control = false;\ncur_x = x - display_origin_x;\ncur_y = y - display_origin_y;\nvar x = cur_x - cur_hotx;\nvar y = cur_y - cur_hoty;\nx *= display_scale / scaleFactor;\ny *= display_scale / scaleFactor;\ncursor_img.style.set {\nleft: x + \"px\",\ntop: y + \"px\",\n};\nif (cursor_img.style#display == 'none') {\ncursor_img.style#display = \"block\";\n}\n}\nfunction self.ready() {\nvar w = scaleIt(960);\nvar h = scaleIt(640);\nif (is_file_transfer || is_port_forward) {\nvar r = handler.get_size();\nif (isReasonableSize(r) && r[2] > 0) {\nview.move(r[0], r[1], r[2], r[3]);\n} else {\ncenterize(w, h);\n}\n} else {\ncenterize(w, h);\n}\nif (!is_port_forward) connecting();\nif (is_file_transfer) initializeFileTransfer();\nif (is_port_forward) initializePortForward();\n}\nvar workarea_offset = 0;\nvar size_adapted;\nhandler.adaptSize = function() {\nif (size_adapted) return;\nsize_adapted = true;\nvar (sx, sy, sw, sh) = view.screenBox(#workarea, #rectw);\nvar (fx, fy, fw, fh) = view.screenBox(#frame, #rectw);\nif (is_osx) workarea_offset = sy;\nvar r = handler.get_size();\nif (isReasonableSize(r) && r[2] > 0) {\nif (r[2] >= fw && r[3] >= fh && !is_linux) {\nview.windowState = View.WINDOW_FULL_SCREEN;\nstdout.println(\"Initialize to full screen\");\n} else if (r[2] >= sw && r[3] >= sh) {\nview.windowState = View.WINDOW_MAXIMIZED;\nstdout.println(\"Initialize to full screen\");\n} else {\nview.move(r[0], r[1], r[2], r[3]);\n}\n} else {\nvar w = handler.box(#width, #border)\nvar h = handler.box(#height, #border)\nif (w >= sw || h >= sh) {\nview.windowState = View.WINDOW_MAXIMIZED;\nreturn;\n}\n// extra for border\nvar extra = 2;\ncenterize(w + extra, handler.box(#height, #border) + h + extra);\n}\n}\nfunction self.closing() {\nvar (x, y, w, h) = view.box(#rectw, #border, #screen);\nif (is_file_transfer) save_file_transfer_close_state();\nif (is_file_transfer || is_port_forward || size_adapted) handler.save_size(x, y, w, h);\nif (recording) handler.record_screen(false, 0, display_width, display_height);\n}\nvar qualityMonitor;\nvar qualityMonitorData = [];\nclass QualityMonitor: Reactor.Component\n{\nfunction this() {\nqualityMonitor = this;\nif (handler.get_toggle_option(\"show-quality-monitor\")) {\n$(#quality-monitor).style.set{ display: \"block\" };\n}\n}\nfunction render() {\nreturn <div >\n<div>\nSpeed: {qualityMonitorData[0]}\n</div>\n<div>\nFPS: {qualityMonitorData[1]}\n</div>\n<div>\nDelay: {qualityMonitorData[2]} ms\n</div>\n<div>\nTarget Bitrate: {qualityMonitorData[3]}kb\n</div>\n<div>\nCodec: {qualityMonitorData[4]}\n</div>\n<div>\nChroma: {qualityMonitorData[5]}\n</div>\n</div>;\n}\n}\n$(#quality-monitor).content(<QualityMonitor />);\nhandler.updateQualityStatus = function(speed, fps, delay, bitrate, codec_format, chroma) {\nif (speed !== null) qualityMonitorData[0] = speed;\nif (fps !== null) qualityMonitorData[1] = fps;\nif (delay !== null) qualityMonitorData[2] = qualityMonitorData[1] === 0 ? 0 : delay;\nif (bitrate !== null) qualityMonitorData[3] = bitrate;\nif (codec_format !== null) qualityMonitorData[4] = codec_format;\nif (chroma !== null) qualityMonitorData[5] = chroma;\nqualityMonitor.update();\n}\nhandler.setPermission = function(name, enabled) {\nself.timer(60ms, function() {\nif (name == \"keyboard\") keyboard_enabled = enabled;\nif (name == \"audio\") audio_enabled = enabled;\nif (name == \"file\") file_enabled = enabled;\nif (name == \"clipboard\") clipboard_enabled = enabled;\nif (name == \"restart\") restart_enabled = enabled;\nif (name == \"recording\") recording_enabled = enabled;\ninput_blocked = false;\nheader.update();\n});\n}\nhandler.closeSuccess = function() {\n// handler.msgbox(\"success\", \"Successful\", \"Ready to go.\");\nhandler.msgbox(\"\", \"\", \"\");\n}\nvar remote_home_dir;\nvar svg_add_folder = <svg viewBox=\"0 0 443.29 443.29\">\n<path d=\"m277.06 332.47h27.706v-55.412h55.412v-27.706h-55.412v-55.412h-27.706v55.412h-55.412v27.706h55.412z\"/>\n<path d=\"m415.59 83.118h-202.06l-51.353-51.353c-2.597-2.597-6.115-4.058-9.794-4.058h-124.68c-15.274-1e-3 -27.706 12.431-27.706 27.705v332.47c0 15.273 12.432 27.706 27.706 27.706h387.88c15.273 0 27.706-12.432 27.706-27.706v-277.06c0-15.274-12.432-27.706-27.706-27.706zm0 304.76h-387.88v-332.47h118.94l51.354 51.353c2.597 2.597 6.115 4.058 9.794 4.058h207.79z\"/>\n</svg>;\nvar svg_trash = <svg viewBox=\"0 0 473.41 473.41\">\n<path d=\"m443.82 88.765h-88.765v-73.971c0-8.177-6.617-14.794-14.794-14.794h-207.12c-8.177 0-14.794 6.617-14.794 14.794v73.971h-88.764v29.588h14.39l57.116 342.69c1.185 7.137 7.354 12.367 14.592 12.367h241.64c7.238 0 13.407-5.23 14.592-12.367l57.116-342.69h14.794c-1e-3 0-1e-3 -29.588-1e-3 -29.588zm-295.88-59.177h177.53v59.176h-177.53zm196.85 414.24h-216.58l-54.241-325.47h325.06z\"/>\n<path transform=\"matrix(.064 -.998 .998 .064 -.546 19.418)\" d=\"m-360.4 301.29h207.54v29.592h-207.54z\"/>\n<path transform=\"matrix(.998 -.064 .064 .998 -.628 .399)\" d=\"m141.64 202.35h29.592v207.54h-29.592z\"/>\n</svg>;\nvar svg_arrow = <svg viewBox=\"0 0 482.24 482.24\">\n<path d=\"m206.81 447.79-206.81-206.67 206.74-206.67 24.353 24.284-165.17 165.17h416.31v34.445h-416.31l165.24 165.24z\"/>\n</svg>;\nvar svg_home = <svg viewBox=\"0 0 476.91 476.91\">\n<path d=\"m461.78 209.41-212.21-204.89c-6.182-6.026-16.042-6.026-22.224 0l-212.2 204.88c-3.124 3.015-4.888 7.17-4.888 11.512 0 8.837 7.164 16 16 16h28.2v224c0 8.837 7.163 16 16 16h112c8.837 0 16-7.163 16-16v-128h80v128c0 8.837 7.163 16 16 16h112c8.837 0 16-7.163 16-16v-224h28.2c4.338 0 8.489-1.761 11.504-4.88 6.141-6.354 5.969-16.483-0.384-22.624zm-39.32 11.504c-8.837 0-16 7.163-16 16v224h-112v-128c0-8.837-7.163-16-16-16h-80c-8.837 0-16 7.163-16 16v128h-112v-224c0-8.837-7.163-16-16-16h-28.2l212.2-204.88 212.28 204.88h-28.28z\"/>\n</svg>;\nvar svg_refresh = <svg viewBox=\"0 0 551.13 551.13\">\n<path d=\"m482.24 310.01c0 113.97-92.707 206.67-206.67 206.67s-206.67-92.708-206.67-206.67c0-102.21 74.639-187.09 172.23-203.56v65.78l86.114-86.114-86.114-86.115v71.641c-116.65 16.802-206.67 117.14-206.67 238.37 0 132.96 108.16 241.12 241.12 241.12s241.12-108.16 241.12-241.12z\"/>\n</svg>;\nvar svg_cancel = <svg .cancel viewBox=\"0 0 612 612\"><polygon points=\"612 36.004 576.52 0.603 306 270.61 35.478 0.603 0 36.004 270.52 306.01 0 576 35.478 611.4 306 341.41 576.52 611.4 612 576 341.46 306.01\"/></svg>;\nvar svg_continue = <svg .continue t=\"1652493728825\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"793\" ne=\"0.8429451094012732\" width=\"200\" height=\"200\"><path d=\"M458.69056 948.9408v74.39872c-102.4512-10.22464-196.25472-51.00544-272.1024-113.024l52.2752-52.2752c62.09024 48.87552 137.58464 81.39776 219.8272 90.89536z m562.47296-434.70848c0 263.99744-202.6496 482.9696-460.06784 509.0304v-74.5472c216.6272-25.99424 385.95584-211.73248 385.95584-435.072 0-223.27296-169.32352-409.00096-385.95584-434.9952V5.19168c257.42336 26.07104 460.06784 245.0432 460.06784 509.04064zM166.24128 785.83296l-52.13696 52.14208C50.82112 760.9088 9.51808 665.20576 0 560.67584h73.36448c9.1136 84.41856 42.44992 161.85344 92.8768 225.15712zM113.77664 190.88384l51.65056 51.6608C117.12 303.5392 84.64384 377.56928 74.3424 458.2656H0.95744C12.032 357.632 52.60288 265.53344 113.77664 190.88384zM458.69056 5.12v73.30304c-82.69312 9.55392-158.5664 42.37824-220.8512 91.6992L186.17856 118.4768C262.10304 56.2688 356.06528 15.36 458.69568 5.12z\" p-id=\"794\"></path><path d=\"M652.8 512l-276.48 166.4v-332.8z\" p-id=\"795\"></path></svg>;\nvar svg_computer = <svg .computer viewBox=\"0 0 480 480\">\n<g>\n<path fill=\"#2C8CFF\" d=\"m276 395v11.148c0 2.327-1.978 4.15-4.299 3.985-21.145-1.506-42.392-1.509-63.401-0.011-2.322 0.166-4.3-1.657-4.3-3.985v-11.137c0-2.209 1.791-4 4-4h64c2.209 0 4 1.791 4 4zm204-340v288c0 17.65-14.35 32-32 32h-416c-17.65 0-32-14.35-32-32v-288c0-17.65 14.35-32 32-32h416c17.65 0 32 14.35 32 32zm-125.62 386.36c-70.231-21.843-158.71-21.784-228.76 0-4.22 1.31-6.57 5.8-5.26 10.02 1.278 4.085 5.639 6.591 10.02 5.26 66.093-20.58 151.37-21.125 219.24 0 4.22 1.31 8.71-1.04 10.02-5.26s-1.04-8.71-5.26-10.02z\"/>\n</g>\n</svg>;\nfunction getSize(type, size) {\nif (!size) {\nif (type <= 3) return \"\";\nreturn \"0B\";\n}\nsize = size.toFloat();\nvar toFixed = function(size) {\nsize = (size * 100).toInteger();\nvar a = (size / 100).toInteger();\nif (size % 100 == 0) return a;\nif (size % 10 == 0) return a + '.' + (size % 10);\nvar b = size % 100;\nif (b < 10) b = '0' + b;\nreturn a + '.' + b;\n}\nif (size < 1024) return size.toInteger() + \"B\";\nif (size < 1024 * 1024) return toFixed(size / 1024) + \"K\";\nif (size < 1024 * 1024 * 1024) return toFixed(size / (1024 * 1024)) + \"M\";\nreturn toFixed(size / (1024 * 1024 * 1024)) + \"G\";\n}\nfunction getParentPath(is_remote, path) {\nvar sep = handler.get_path_sep(is_remote);\nvar res = path.lastIndexOf(sep);\nif (res <= 0) return \"/\";\nreturn path.substr(0, res);\n}\nfunction getFileName(is_remote, path) {\nvar sep = handler.get_path_sep(is_remote);\nvar res = path.lastIndexOf(sep);\nreturn path.substr(res + 1);\n}\nfunction getExt(name) {\nif (name.indexOf(\".\") == 0) {\nreturn \"\";\n}\nvar i = name.lastIndexOf(\".\");\nif (i > 0) return name.substr(i + 1);\nreturn \"\";\n}\nvar jobIdCounter = 1;\nclass JobTable: Reactor.Component {\nthis var jobs = [];\nthis var job_map = {};\nfunction render() {\nvar me = this;\nvar rows = this.jobs.map(function(job, i) { return me.renderRow(job, i); });\nreturn <section><table .has_current .job-table>\n<tbody key={rows.length}>\n{rows}\n</tbody>\n</table></section>;\n}\nevent click $(svg.cancel) (_, me) {\nvar job = this.jobs[me.parent.parent.index];\nvar id = job.id;\nhandler.cancel_job(id);\ndelete this.job_map[id];\nvar i = -1;\nthis.jobs.map(function(job, idx) {\nif (job.id == id) i = idx;\n});\nthis.jobs.splice(i, 1);\nthis.update();\nvar is_remote = job.is_remote;\nif (job.type != \"del-dir\") is_remote = !is_remote;\nrefreshDir(is_remote);\n}\nevent click $(svg.continue) (_, me) {\nvar job = this.jobs[me.parent.parent.parent.index];\nvar id = job.id;\nthis.continueJob(id);\nthis.update();\n}\nfunction clearAllJobs() {\nthis.jobs = [];\nthis.job_map = {};\nthis.update();\n}\nfunction send(path, is_remote) {\nvar to;\nvar show_hidden;\nif (is_remote) {\nto = file_transfer.local_folder_view.fd.path;\nshow_hidden = file_transfer.remote_folder_view.show_hidden;\n} else {\nto = file_transfer.remote_folder_view.fd.path;\nshow_hidden = file_transfer.local_folder_view.show_hidden;\n}\nif (!to) return;\nto += handler.get_path_sep(!is_remote) + getFileName(is_remote, path);\nvar id = jobIdCounter;\njobIdCounter += 1;\nthis.jobs.push({ type: \"transfer\",\nid: id, path: path, to: to,\ninclude_hidden: show_hidden,\nis_remote: is_remote,\nis_last: false\n});\nthis.job_map[id] = this.jobs[this.jobs.length - 1];\nhandler.send_files(id, path, to, 0, show_hidden, is_remote);\nvar self = this;\nself.timer(30ms, function() { self.update(); });\n}\nfunction addJob(id, path, to, file_num, show_hidden, is_remote) {\nvar job = { type: \"transfer\",\nid: id, path: path, to: to,\ninclude_hidden: show_hidden,\nis_remote: is_remote, is_last: true, file_num: file_num };\nthis.jobs.push(job);\nthis.job_map[id] = this.jobs[this.jobs.length - 1];\njobIdCounter = id + 1;\nhandler.add_job(id, path, to, file_num, show_hidden, is_remote);\nstdout.println(JSON.stringify(job));\n}\nfunction continueJob(id) {\nvar job = this.job_map[id];\nif (job == null || !job.is_last){\nreturn;\n}\njob.is_last = false;\nhandler.resume_job(job.id, job.is_remote);\n}\nfunction addDelDir(path, is_remote) {\nvar id = jobIdCounter;\njobIdCounter += 1;\nthis.jobs.push({ type: \"del-dir\", id: id, path: path, is_remote: is_remote });\nthis.job_map[id] = this.jobs[this.jobs.length - 1];\nthis.update();\n}\nfunction addDelFile(path, is_remote) {\nvar id = jobIdCounter;\njobIdCounter += 1;\nthis.jobs.push({ type: \"del-file\", id: id, path: path, is_remote: is_remote });\nthis.job_map[id] = this.jobs[this.jobs.length - 1];\nthis.update();\n}\nfunction confirmDeletePolling(is_remote) {\nfor(var i=0;i<this.jobs.length;++i){\nvar job = this.jobs[i];\nif(job.confirmed){\ncontinue;\n}\nif(job.type == \"del-file\"){\nconfirmDelete(job.id, job.path, job.is_remote);\njob.confirmed = true;\nreturn;\n}else if (job.type == \"del-dir\"){\n// TODO: include_hidden is always true\nhandler.remove_dir_all(job.id, job.path, job.is_remote, true);\njob.confirmed = true;\nreturn;\n}\n}\n// polling finish\nif (is_remote) file_transfer.remote_folder_view.table.resetCurrent();\nelse file_transfer.local_folder_view.table.resetCurrent();\n}\nfunction cancelDeletePolling() {\nfor(var i=0;i<this.jobs.length;++i){\nvar job = this.jobs[i];\nif(job.confirmed){\ncontinue;\n}\n// set confirmed true, prevent other polling action\nif(job.type == \"del-file\" || job.type == \"del-dir\"){\njob.confirmed = true;\njob.err = \"cancel\"\n}\n}\nthis.update();\n}\nfunction getSvg(job) {\nif (job.type == \"transfer\") {\nreturn svg_send;\n} else if (job.type == \"del-dir\" || job.type == \"del-file\") {\nreturn svg_trash;\n}\n}\nfunction getStatus(job) {\nif (job.type == \"del-file\"){\nif (job.err) {\nif (job.err == \"cancel\") return translate(\"Cancel\");\n} else {\nif (job.finished) return translate(\"Finished\");\nelse return translate(\"Waiting\");\n}\n}\nif (!job.entries) return translate(\"Waiting\");\nvar i = job.file_num + 1;\nvar n = job.num_entries || job.entries.length;\nif (i > n) i = n;\nvar res = i + ' / ' + n + \" \" + translate(\"files\");\nif (job.total_size > 0) {\nvar s = getSize(0, job.finished_size);\nif (s) s += \" / \";\nres += \", \" + s + getSize(0, job.total_size);\n}\n// below has problem if some file skipped\nvar percent = job.total_size == 0 ? 100 : (100. * job.finished_size / job.total_size).toInteger(); // (100. * i / (n || 1)).toInteger();\nif (job.finished) percent = '100';\nif (percent) res += \", \" + percent + \"%\";\nif (job.finished) {\nif (job.err == \"skipped\") {\nres = translate(\"Skipped\") + \" \" + res;\n} else {\nres = translate(\"Finished\") + \" \" + res;\n}\n}\nif (job.speed) res += \", \" + getSize(0, job.speed) + \"/s\";\nreturn res;\n}\nfunction updateJob(job) {\nvar el = this.select(\"div[id=s\" + job.id + \"]\");\nif (el) el.text = this.getStatus(job);\n}\nfunction updateJobStatus(id, file_num = -1, err = null, speed = null, finished_size = 0) {\nvar job = this.job_map[id];\nif (job.type == \"del-file\"){\njob.finished = true;\njob.err = err;\nrefreshDir(job.is_remote);\nthis.updateJob(job);\nreturn;\n}\nif (!job) return;\nif (file_num < job.file_num) return;\njob.file_num = file_num;\nvar n = job.num_entries || job.entries.length;\njob.finished = job.file_num >= n - 1 || err == \"cancel\" || err == \"skipped\";\njob.finished_size = finished_size;\njob.speed = speed || 0;\njob.err = err;\nthis.updateJob(job);\nif (job.type == \"del-dir\") {\nif (job.finished) {\nif (!err) {\nhandler.remove_dir(job.id, job.path, job.is_remote);\nrefreshDir(job.is_remote);\nif (is_remote) file_transfer.remote_folder_view.table.resetCurrent();\nelse file_transfer.local_folder_view.table.resetCurrent();\n}\n} else if (!job.no_confirm) {\nhandler.confirm_delete_files(id, job.file_num + 1);\n}\n} else if (job.finished || file_num == -1) {\nrefreshDir(!job.is_remote);\n}\n}\nfunction renderRow(job, i) {\nvar svg = this.getSvg(job);\nreturn <tr class={job.is_remote ? \"is_remote\" : \"\"}><td>\n{svg}\n<div .text>\n<div .path>{job.path}</div>\n<div id={\"s\" + job.id}>{this.getStatus(job)}</div>\n</div>\n<div class=\"svg_continue\" style={job.is_last ? \"\" : \"visibility: hidden\"}>\n{svg_continue}\n</div>\n{svg_cancel}\n</td></tr>;\n}\n}\nclass FolderView : Reactor.Component {\nthis var fd = {};\nthis var history = [];\nthis var show_hidden = false;\nfunction sep() {\nreturn handler.get_path_sep(this.is_remote);\n}\nfunction this(params) {\nthis.is_remote = params.is_remote;\nif (this.is_remote) {\nthis.show_hidden = !!handler.get_option(\"remote_show_hidden\");\n} else {\nthis.show_hidden = !!handler.get_option(\"local_show_hidden\");\n}\nif (!this.is_remote) {\nvar dir = handler.get_option(\"local_dir\");\nif (dir) {\nthis.fd = handler.read_dir(dir, this.show_hidden);\nif (this.fd) return;\n}\nthis.fd = handler.read_dir(handler.get_home_dir(), this.show_hidden);\n}\n}\n// sort predicate\nfunction foldersFirst(a, b) {\nif (a.type <= 3 && b.type > 3) return -1;\nif (a.type > 3 && b.type <= 3) return +1;\nif (a.name == b.name) return 0;\nreturn a.name.toLowerCase().lexicalCompare(b.name.toLowerCase());\n}\nfunction render()\n{\nreturn <section>\n{this.renderTitle()}\n{this.renderNavBar()}\n{this.renderOpBar()}\n{this.renderTable()}\n</section>;\n}\nfunction renderTitle() {\nreturn <div .title>\n{svg_computer}\n<div .platform>{platformSvg(handler.get_platform(this.is_remote), \"white\")}</div>\n<div><span>{translate(this.is_remote ? \"Remote Computer\" : \"Local Computer\")}</span></div>\n</div>\n}\nfunction renderNavBar() {\nreturn <div .toolbar .navbar>\n<div .home .button>{svg_home}</div>\n<div .goback .button>{svg_arrow}</div>\n<div .goup .button>{svg_arrow}</div>\n{this.renderSelect()}\n<div .refresh .button>{svg_refresh}</div>\n</div>;\n}\nfunction renderSelect() {\nreturn <select editable .select-dir @{this.select_dir}>\n<option>/</option>\n</select>;\n}\nfunction renderOpBar() {\nif (this.is_remote) {\nreturn <div .toolbar .remote>\n<div .send .button>{svg_send}<span>{translate('Receive')}</span></div>\n<div .spacer></div>\n<div .add-folder .button>{svg_add_folder}</div>\n<div .trash .button>{svg_trash}</div>\n</div>;\n}\nreturn <div .toolbar>\n<div .add-folder .button>{svg_add_folder}</div>\n<div .trash .button>{svg_trash}</div>\n<div .spacer></div>\n<div .send .button><span>{translate('Send')}</span>{svg_send}</div>\n</div>;\n}\nfunction get_updated() {\nthis.table.sortRows(false);\nif (this.fd && this.fd.path) this.select_dir.value = this.fd.path;\n}\nfunction renderTable() {\nvar fd = this.fd;\nvar entries = fd.entries || [];\nvar table = this.table;\nif (!table || !table.sortBy) {\nentries.sort(this.foldersFirst);\n}\nvar me = this;\nvar path = fd.path;\nif (path != \"/\" && path) {\nentries = [{ name: \"..\", type: 1 }].concat(entries);\n}\nvar rows = entries.map(function(e) { return me.renderRow(e); });\nvar id = (this.is_remote ? \"remote\" : \"local\") + \"-folder-view\";\nreturn <table @{this.table} .folder-view .has_current id={id}>\n<thead>\n<tr><th></th><th .sortable>{translate('Name')}</th><th .sortable>{translate('Modified')}</th><th .sortable>{translate('Size')}</th></tr>\n</thead>\n<tbody>\n{rows}\n</tbody>\n<popup>\n<menu.context id={id}>\n<li #switch-hidden class={this.show_hidden ? \"selected\" : \"\"}><span>{svg_checkmark}</span>{translate('Show Hidden Files')}</li>\n</menu>\n</popup>\n</table>;\n}\nfunction joinPath(name) {\nvar path = this.fd.path;\nif (path == \"/\") {\nif (this.sep() == \"/\") return this.sep() + name;\nelse return name;\n}\nreturn path + (path[path.length - 1] == this.sep() ? \"\" : this.sep()) + name;\n}\nfunction attached() {\nvar me = this;\nthis.table.onRowDoubleClick = function (row) {\nvar type = row[0].attributes[\"type\"];\nif (type > 3) return;\nvar name = row[1].text;\nvar path = name == \"..\" ? getParentPath(me.is_remote, me.fd.path) : me.joinPath(name);\nme.table.resetCurrent();\nme.goto(path, true);\n}\nthis.get_updated();\n}\nfunction goto(path, push) {\nif (!path) return;\nif (this.sep() == \"\\\\\" && path.length == 2) { // windows drive\npath += \"\\\\\";\n}\nif (push) this.pushHistory();\nif (this.is_remote) {\nhandler.read_remote_dir(path, this.show_hidden);\n} else {\nvar fd = handler.read_dir(path, this.show_hidden);\nthis.refresh({ fd: fd });\n}\n}\nfunction refresh(data) {\nif (!data.fd || !data.fd.path) return;\nif (this.is_remote && !remote_home_dir) {\nremote_home_dir = data.fd.path;\n}\nthis.update(data);\nvar me = this;\nself.timer(1ms, function() { me.get_updated(); });\n}\nfunction renderRow(entry) {\nvar path;\nif (this.is_remote) {\npath = handler.get_icon_path(entry.type, getExt(entry.name));\n} else {\npath = this.joinPath(entry.name);\n}\nvar tm = entry.time ? new Date(entry.time.toFloat() * 1000.).toLocaleString() : 0;\nreturn <tr role=\"option\">\n<td type={entry.type} filename={path}></td>\n<td>{entry.name}</td>\n<td value={entry.time || 0}>{tm || \"\"}</td>\n<td value={entry.size || 0}>{getSize(entry.type, entry.size)}</td>\n</tr>;\n}\nevent click $(#switch-hidden) {\nthis.show_hidden = !this.show_hidden;\nthis.refreshDir();\n}\nevent click $(.goup) () {\nvar path = this.fd.path;\nif (!path || path == \"/\") return;\npath = getParentPath(this.is_remote, path);\nthis.goto(path, true);\n}\nevent click $(.goback) () {\nvar path = this.history.pop();\nif (!path) return;\nthis.goto(path, false);\n}\nevent click $(.trash) () {\nvar rows = this.getCurrentRows();\nif (!rows || rows.length == 0) return;\nvar delete_dirs = new Array();\nfor (var i = 0; i < rows.length; ++i) {\nvar row = rows[i];\nvar path = row[0];\nvar type = row[1];\nvar new_history = [];\nfor (var j = 0; j < this.history.length; ++j) {\nvar h = this.history[j];\nif ((h + this.sep()).indexOf(path + this.sep()) == -1) new_history.push(h);\n}\nthis.history = new_history;\nif (type == 1) {\nfile_transfer.job_table.addDelDir(path, this.is_remote);\n} else {\nfile_transfer.job_table.addDelFile(path, this.is_remote);\n}\n}\nfile_transfer.job_table.confirmDeletePolling(this.is_remote);\n}\nevent click $(.add-folder) () {\nvar me = this;\nmsgbox(\"custom\", translate(\"Create Folder\"), \"<div .form> \\\n<div>\" + translate(\"Please enter the folder name\") + \":</div> \\\n<div><input|text(name) .outline-focus /></div> \\\n</div>\", \"\", function(res=null) {\nif (!res) return;\nif (!res.name) return;\nvar name = res.name.trim();\nif (!name) return;\nif (name.indexOf(me.sep()) >= 0) {\nhandler.msgbox(\"custom-error\", \"Create Folder\", \"Invalid folder name\");\nreturn;\n}\nvar path = me.joinPath(name);\nhandler.create_dir(jobIdCounter, path, me.is_remote);\ncreate_dir_jobs[jobIdCounter] = { is_remote: me.is_remote, path: path };\njobIdCounter += 1;\n});\n}\nfunction refreshDir() {\nthis.goto(this.fd.path, false);\n}\nevent click $(.refresh) () {\nthis.refreshDir();\n}\nevent click $(.home) () {\nvar path = this.is_remote ? remote_home_dir : handler.get_home_dir();\nif (!path) return;\nif (path == this.fd.path) return;\nthis.goto(path, true);\n}\nfunction getCurrentRow() {\nvar row = this.table.getCurrentRow();\nif (!row) return;\nvar name = row[1].text;\nif (!name || name == \"..\") return;\nvar type = row[0].attributes[\"type\"];\nreturn [this.joinPath(name), type];\n}\nfunction getCurrentRows() {\nvar rows = this.table.getCurrentRows();\nif (!rows || rows.length== 0) return;\nvar records = new Array();\nfor (var i = 0; i < rows.length; ++i) {\nvar name = rows[i][1].text;\nif (!name || name == \"..\") continue;\nvar type = rows[i][0].attributes[\"type\"];\nrecords.push([this.joinPath(name), type]);\n}\nreturn records;\n}\nevent click $(.send) () {\nvar rows = this.getCurrentRows();\nif (!rows || rows.length == 0) return;\nfor (var i = 0; i < rows.length; ++i) {\nfile_transfer.job_table.send(rows[i][0], this.is_remote);\n}\n}\nevent change $(.select-dir) (_, el) {\nvar x = getTime() - last_key_time;\nif (x < 1000) return;\nif (this.fd.path != el.value) {\nthis.goto(el.value, true);\n}\n}\nevent keydown $(.select-dir) (evt, me) {\nif (isEnterKey(evt)) {\nthis.goto(me.value, true);\n}\n}\nfunction pushHistory() {\nvar path = this.fd.path;\nif (!path) return;\nif (path != this.history[this.history.length - 1]) this.history.push(path);\n}\n}\nvar file_transfer;\nclass FileTransfer: Reactor.Component {\nfunction this() {\nfile_transfer = this;\n}\nfunction render() {\nreturn <div #file-transfer>\n<FolderView is_remote={false} @{this.local_folder_view} />\n<FolderView is_remote={true} @{this.remote_folder_view}/>\n<JobTable @{this.job_table} />\n</div>;\n}\n}\nfunction initializeFileTransfer()\n{\n$(#file-transfer-wrapper).content(<FileTransfer />);\n$(#video-wrapper).style.set { visibility: \"hidden\", position: \"absolute\" };\n$(#file-transfer-wrapper).style.set { display: \"block\" };\n}\nhandler.updateFolderFiles = function(fd) {\n// stdout.println(\"update folder files: \" + JSON.stringify(fd));\nfd.entries = fd.entries || [];\nif (fd.id > 0) {\nvar jt = file_transfer.job_table;\nvar job = jt.job_map[fd.id];\nif (job) {\njob.file_num = -1;\njob.total_size = fd.total_size;\njob.entries = fd.entries;\njob.num_entries = fd.num_entries;\nfile_transfer.job_table.updateJobStatus(job.id);\n}\n} else {\nfile_transfer.remote_folder_view.refresh({ fd: fd });\n}\n}\nhandler.jobProgress = function(id, file_num, speed, finished_size) {\nfile_transfer.job_table.updateJobStatus(id, file_num, null, speed, finished_size);\n}\nhandler.jobDone = function(id, file_num = -1) {\nvar job = create_dir_jobs[id];\nif (job) {\nrefreshDir(job.is_remote);\nreturn;\n}\nfile_transfer.job_table.updateJobStatus(id, file_num);\n}\nhandler.jobError = function(id, err, file_num = -1) {\nvar job = deleting_single_file_jobs[id];\nif (job) {\nmsgbox(\"custom-error\", \"Delete File\", err);\nreturn;\n}\njob = create_dir_jobs[id];\nif (job) {\nmsgbox(\"custom-error\", \"Create Folder\", err);\nreturn;\n}\nif (file_num < 0) {\nhandler.msgbox(\"custom-error\", \"Failed\", err);\n}\nfile_transfer.job_table.updateJobStatus(id, file_num, err);\n}\nhandler.clearAllJobs = function() {\nfile_transfer.job_table.clearAllJobs();\n}\nhandler.addJob = function (id, path, to, file_num, show_hidden, is_remote) { // load last job\n// stdout.println(\"restore job: \" + is_remote);\nfile_transfer.job_table.addJob(id,path,to,file_num,show_hidden,is_remote);\n}\nhandler.updateTransferList = function () {\nfile_transfer.job_table.update();\n}\nfunction refreshDir(is_remote) {\nif (is_remote) file_transfer.remote_folder_view.refreshDir();\nelse file_transfer.local_folder_view.refreshDir();\n}\nvar deleting_single_file_jobs = {};\nvar create_dir_jobs = {}\nfunction confirmDelete(id ,path, is_remote) {\nmsgbox(\"custom-skip\", \"Confirm Delete\", \"<div .form> \\\n<div>\" + translate('Are you sure you want to delete this file?') + \"</div> \\\n<div.ellipsis style=\\\"font-weight: bold;\\\">\" + path + \"</div> \\\n</div>\", \"\", function(res=null) {\nif (!res) {\nfile_transfer.job_table.updateJobStatus(id, -1, \"cancel\");\nfile_transfer.job_table.cancelDeletePolling();\n} else if (res.skip) {\nfile_transfer.job_table.updateJobStatus(id, -1, \"cancel\");\nfile_transfer.job_table.confirmDeletePolling(is_remote);\n} else {\nhandler.remove_file(id, path, 0, is_remote);\nif (is_remote) file_transfer.remote_folder_view.table.resetCurrent();\nelse file_transfer.local_folder_view.table.resetCurrent();\ndeleting_single_file_jobs[id] = { is_remote: is_remote, path: path };\nfile_transfer.job_table.confirmDeletePolling(is_remote);\n}\n});\n}\nhandler.confirmDeleteFiles = function(id, i, name) {\nvar jt = file_transfer.job_table;\nvar job = jt.job_map[id];\nif (!job) return;\nvar n = job.num_entries;\nif (i >= n) return;\nvar file_path = job.path;\nif (name) file_path += handler.get_path_sep(job.is_remote) + name;\nmsgbox(\"custom-skip\", \"Confirm Delete\", \"<div .form> \\\n<div>\" + translate('Deleting') + \" #\" + (i + 1) + \" / \" + n + \" \" + translate('files') + \".</div> \\\n<div>\" + translate('Are you sure you want to delete this file?') + \"</div> \\\n<div.ellipsis style=\\\"font-weight: bold;\\\" .text>\" + file_path + \"</div> \\\n<div><button|checkbox(remember) {ts}>\" + translate('Do this for all conflicts') + \"</button></div> \\\n</div>\", \"\", function(res=null) {\nif (!res) {\njt.updateJobStatus(id, i - 1, \"cancel\");\nfile_transfer.job_table.cancelDeletePolling();\n} else if (res.skip) {\nif (res.remember){\njt.updateJobStatus(id, i, \"cancel\");\n} else{\nhandler.jobDone(id, i);\n}\nfile_transfer.job_table.confirmDeletePolling(job.is_remote);\n} else {\njob.no_confirm = res.remember;\nif (job.no_confirm){\nhandler.set_no_confirm(id);\nfile_transfer.job_table.confirmDeletePolling(job.is_remote);\n}\nhandler.remove_file(id, file_path, i, job.is_remote);\n}\nif(i+1 >= n){\nfile_transfer.job_table.confirmDeletePolling(job.is_remote);\n}\n});\n}\nhandler.overrideFileConfirm = function(id, file_num, to, is_upload, is_identical) {\nvar jt = file_transfer.job_table;\nvar identical_msg = is_identical ? translate(\"identical_file_tip\"): \"\";\nmsgbox(\"custom-skip\", \"Confirm Write Strategy\", \"<div .form> \\\n<div>\" + translate('Overwrite') + \" \" + translate('files') + \".</div> \\\n<div>\" + translate('This file exists, skip or overwrite this file?') + \"</div> \\\n<div.ellipsis style=\\\"font-weight: bold;\\\" .text>\" + to + \"</div> \\\n<div>\" + identical_msg + \"</div> \\\n<div><button|checkbox(remember) {ts}>\" + translate('Do this for all conflicts') + \"</button></div> \\\n</div>\", \"\", function(res=null) {\nif (!res) {\njt.updateJobStatus(id, -1, \"cancel\");\nhandler.cancel_job(id);\n} else if (res.skip) {\nif (res.remember){\nhandler.set_write_override(id,file_num,false,true, is_upload); //\n} else {\nhandler.set_write_override(id,file_num,false,false,is_upload); //\n}\n} else {\nif (res.remember){\nhandler.set_write_override(id,file_num,true,true,is_upload); //\n} else {\nhandler.set_write_override(id,file_num,true,false,is_upload); //\n}\n}\n});\n}\nfunction save_file_transfer_close_state() {\nvar local_dir = file_transfer.local_folder_view.fd.path || \"\";\nvar local_show_hidden = file_transfer.local_folder_view.show_hidden ? \"Y\" : \"\";\nvar remote_dir = file_transfer.remote_folder_view.fd.path || \"\";\nvar remote_show_hidden = file_transfer.remote_folder_view.show_hidden ? \"Y\" : \"\";\nhandler.save_close_state(\"local_dir\", local_dir);\nhandler.save_close_state(\"local_show_hidden\", local_show_hidden);\nhandler.save_close_state(\"remote_dir\", remote_dir);\nhandler.save_close_state(\"remote_show_hidden\", remote_show_hidden);\n}\nclass PortForward: Reactor.Component {\nfunction render() {\nvar args = handler.get_args();\nvar is_rdp = handler.is_rdp();\nif (is_rdp) {\nthis.pfs = [[\"\", \"\", \"RDP\"]];\nargs = [\"rdp\"];\n} else if (args.length) {\nthis.pfs = [args];\n} else {\nthis.pfs = handler.get_port_forwards();\n}\nvar pfs =  this.pfs.map(function(pf, i) {\nreturn <tr key={i} .value>\n<td>{is_rdp ? <button .button #new-rdp>New RDP</button> : pf[0]}</td>\n<td .right-arrow style=\"text-align: center; padding-left: 0\">{args.length ? svg_arrow : \"\"}</td>\n<td>{pf[1] || \"localhost\"}</td>\n<td>{pf[2]}</td>\n{args.length ? \"\" : <td .remove>{svg_cancel}</td>}\n</tr>;\n});\nreturn <div #file-transfer><section>\n{pfs.length ? <div style=\"background: green; color: white; text-align: center; padding: 0.5em;\">\n<span style=\"font-size: 1.2em\">{translate('Listening ...')}</span><br/>\n<span style=\"font-size: 0.8em; color: #ddd\">{translate('not_close_tcp_tip')}</span>\n</div> : \"\"}\n<table #port-forward>\n<thead>\n<tr>\n<th>{translate('Local Port')}</th>\n<th style=\"width: 1em\" />\n<th>{translate('Remote Host')}</th>\n<th>{translate('Remote Port')}</th>\n{args.length ? \"\" : <th style=\"width: 6em\">{translate('Action')}</th>}\n</tr>\n</thead>\n<tbody key={pfs.length}>\n{args.length ? \"\" :\n<tr>\n<td><input|number #port /></td>\n<td .right-arrow style=\"text-align: center\">{svg_arrow}</td>\n<td><input|text #remote-host novalue=\"localhost\" /></td>\n<td><input|number #remote-port /></td>\n<td style=\"margin:0;\"><button .button #add>{translate('Add')}</button></td>\n</tr>\n}\n{pfs}\n</tbody>\n</table></section></div>;\n}\nevent click $(#add) () {\nvar port = ($(#port).value || \"\").toInteger() || 0;\nvar remote_host = $(#remote-host).value || \"\";\nvar remote_port = ($(#remote-port).value || \"\").toInteger() || 0;\nif (port <= 0 || remote_port <= 0) return;\nhandler.add_port_forward(port, remote_host, remote_port);\nthis.update();\n}\nevent click $(#new-rdp) {\nhandler.new_rdp();\n}\nevent click $(.remove svg) (_, me) {\nvar pf = this.pfs[me.parent.parent.index - 1];\nhandler.remove_port_forward(pf[0]);\nthis.update();\n}\n}\nfunction initializePortForward()\n{\n$(#file-transfer-wrapper).content(<PortForward />);\n$(#video-wrapper).style.set { visibility: \"hidden\", position: \"absolute\" };\n$(#file-transfer-wrapper).style.set { display: \"block\" };\n}\nvar last_key_time = 0;\nvar keymap = {};\nfor (var (k, v) in Event) {\nk = k + \"\"\nif (k[0] == \"V\" && k[1] == \"K\") {\nkeymap[v] = k;\n}\n}\nclass Grid: Behavior {\nconst TABLE_HEADER_CLICK = 0x81;\nconst TABLE_ROW_CLICK = 0x82;\nconst TABLE_ROW_DBL_CLICK = 0x83;\nfunction onHeaderClick(headerCell)\n{\nthis.postEvent(TABLE_HEADER_CLICK, headerCell.index, headerCell);\nreturn true;\n}\nfunction onRowClick(row , reason)\n{\nthis.postEvent(TABLE_ROW_CLICK, row.index, row);\nreturn true;\n}\nfunction onRowDoubleClick(row)\n{\nthis.postEvent(TABLE_ROW_DBL_CLICK, row.index, row);\nreturn true;\n}\nfunction getCurrentRow()\n{\nreturn this.$(tbody>tr:current);\n}\nfunction getCurrentRows()\n{\nreturn this.$$(tbody>tr:checked);\n}\nfunction getCurrentColumn()\n{\nreturn this.$(thead>:current); // return current cell in header row\n}\nfunction resetCurrent() {\nvar rows = this.getCurrentRows();\nfor (var i = 0; i < rows.length; ++i) {\nvar row = rows[i];\nrow.state.current = false;\nrow.state.checked = false;\n}\n}\nfunction setCurrentRow(row, reason = #by_code, doubleClick = false)\n{\nif (!row) return;\n// get previously selected row:\nvar prev = this.getCurrentRow();\nif (prev)\n{\nif (prev === row && !doubleClick) return; // already here, nothing to do.\nprev.state.current = false; // drop state flag\nprev.state.checked = false; // drop state flag\n}\nrow.state.current = true;\nrow.state.checked = true;\nrow.scrollToView();\nif (doubleClick)\nthis.onRowDoubleClick(row,reason);\nelse\nthis.onRowClick(row,reason);\n}\nfunction setCurrentColumn(col)\n{\n// get previously selected column:\nvar prev = this.getCurrentColumn();\nif (prev)\n{\nif (prev === col) return; // already here, nothing to do.\nprev.state.current = false; // drop state flag\n}\ncol.state.current = true; // set state flag\ncol.scrollToView();\nthis.onHeaderClick(col);\n}\nfunction sortRows(sortClicked)\n{\nvar col = this.sortBy;\nif (!col) return;\nvar byColumn = col.index;\nvar nowDesc = (col.attributes[\"sort\"] || \"desc\") == \"desc\";\nif (sortClicked) (this.$(thead [sort]) || col).attributes[\"sort\"] = undefined; // drop any other sort order.\nvar getValue = function(x) {\nvar value = x.attributes[\"value\"];\nif (value == undefined) return x.text.toLowerCase();\nreturn value.toFloat();\n}\nvar sort = function(r1, r2, asc) {\nif (r1[1].text == \"..\") {\nreturn -1;\n}\nif (r2[1].text == \"..\") {\nreturn 1;\n}\nif (!asc)\nreturn getValue(r1[byColumn]) < getValue(r2[byColumn]) ? -1 : 1;\nelse\nreturn getValue(r1[byColumn]) > getValue(r2[byColumn]) ? -1 : 1;\n}\nif (nowDesc)\n{\nif (sortClicked) col.attributes[\"sort\"] = \"asc\";\nthis.body.sort(:r1, r2: sort(r1, r2, sortClicked ? true : false));\n} else {\nif (sortClicked) col.attributes[\"sort\"] = \"desc\";\nthis.body.sort(:r1, r2: sort(r1, r2, sortClicked ? false : true));\n}\n}\nfunction attached()\n{\nassert this.tag == \"table\" : \"wrong element type for grid, table expected\";\nthis.body = this.$(:root>tbody);\nassert this.body : \"Grid require <tbody> element\";\n}\nfunction onMouse(evt)\n{\nif ((evt.type != Event.MOUSE_DOWN) && (evt.type != Event.MOUSE_DCLICK))\nreturn false;\nif (!evt.mainButton)\nreturn false;\n// auxiliary function, returns row this target element belongs to\nfunction targetRow(target) { return target.$p(tbody>tr); }\n// auxiliary function, returns row this target element belongs to\nfunction targetHeaderCell(target) { return target.$p(thead>tr>th); }\nif (var row = targetRow(evt.target)) // click on the row\nthis.setCurrentRow(row, #by_mouse, evt.type == Event.MOUSE_DCLICK);\nelse if (var headerCell = targetHeaderCell(evt.target))\n{\nthis.setCurrentColumn(headerCell); // click on the header cell\nif (evt.type != Event.MOUSE_DCLICK && headerCell.$is(.sortable)) {\nthis.sortBy = headerCell;\nthis.sortRows(true);\n}\n}\n//return true; // as it is always ours then stop event bubbling\n}\nfunction onFocus(evt)\n{\nreturn (evt.type == Event.GOT_FOCUS || evt.type == Event.LOST_FOCUS);\n}\nfunction onKey(evt)\n{\nlast_key_time = getTime();\nif (evt.type != Event.KEY_DOWN)\nreturn false;\nswitch(evt.keyCode)\n{\ncase Event.VK_DOWN:\n{\nvar crow = this.getCurrentRow();\nvar idx = crow? crow.index + 1 : 0;\nif (idx < this.body.length) this.setCurrentRow(this.body[idx],#by_key);\n}\nreturn true;\ncase Event.VK_UP:\n{\nvar crow = this.getCurrentRow();\nvar idx = crow? crow.index - 1 : this.length - 1;\nif (idx >= 0) this.setCurrentRow(this.body[idx],#by_key);\n}\nreturn true;\ncase Event.VK_PRIOR:\n{\nvar y = this.body.scroll(#top) - this.body.scroll(#height);\nvar r;\nfor(var i = this.body.length - 1; i >= 0; --i)\n{\nvar pr = r; r = this.body[i];\nif (r.box(#top, #inner, #content) < y)\n{\n// this row is further than scroll pos - height of scroll area\nthis.setCurrentRow(pr? pr: r,#by_key); // to last fully visible\nreturn true;\n}\n}\nthis.setCurrentRow(r,#by_key); // just in case\n}\nreturn true;\ncase Event.VK_NEXT:\n{\nvar y = this.body.scroll(#top) + 2 * this.body.scroll(#height);\nvar lastScrollable = this.body.length - 1;\nvar r;\nfor(var i = 0; i <= lastScrollable; ++i)\n{\nvar pr = r; r = this.body[i];\nif (r.box(#bottom, #inner, #content) > y)\n{\n// this row is further than scroll pos - height of scroll area\nthis.setCurrentRow(pr? pr: r,#by_key); // to last fully visible\nreturn true;\n}\n}\nthis.setCurrentRow(r,#by_key); // just in case\n}\nreturn true;\ncase Event.VK_HOME:\n{\nif (this.body.length)\nthis.setCurrentRow(this.body.first,#by_key);\n}\nreturn true;\ncase Event.VK_END:\n{\nif (this.body.length)\nthis.setCurrentRow(this.body.last,#by_key);\n}\nreturn true;\n}\nvar char = handler.get_char(keymap[evt.keyCode] || \"\", evt.keyCode);\nif (char) {\nvar crow = this.getCurrentRow();\nvar idx = crow? crow.index + 1 : 0;\nwhile (idx < this.body.length) {\nvar el = this.body[idx];\nvar text = el[1].text;\nif (text && text[0].toLowerCase() == char) {\nthis.setCurrentRow(el, #by_key);\nreturn true;\n}\nidx += 1;\n}\n}\nif (isEnterKey(evt)) {\nthis.onRowDoubleClick(this.getCurrentRow());\n}\nreturn false;\n}\n}\nvar pi = handler.get_default_pi(); // peer information\nvar chat_msgs = [];\nvar svg_fullscreen = <svg viewBox=\"0 0 357 357\">\n<path d=\"M51,229.5H0V357h127.5v-51H51V229.5z M0,127.5h51V51h76.5V0H0V127.5z M306,306h-76.5v51H357V229.5h-51V306z M229.5,0v51    H306v76.5h51V0H229.5z\"/>\n</svg>;\nvar svg_action = <svg viewBox=\"-91 0 512 512\"><path d=\"M315 211H191L298 22a15 15 0 00-13-22H105c-6 0-12 4-14 10L1 281a15 15 0 0014 20h127L61 491a15 15 0 0025 16l240-271a15 15 0 00-11-25z\"/></svg>;\nvar svg_display = <svg viewBox=\"0 0 640 512\">\n<path d=\"M592 0H48A48 48 0 0 0 0 48v320a48 48 0 0 0 48 48h240v32H112a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h416a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16H352v-32h240a48 48 0 0 0 48-48V48a48 48 0 0 0-48-48zm-16 352H64V64h512z\"/>\n</svg>;\nvar svg_secure = <svg viewBox=\"0 0 347.97 347.97\">\n<path fill=\"#3F7D46\" d=\"m317.31 54.367c-59.376 0-104.86-16.964-143.33-54.367-38.461 37.403-83.947 54.367-143.32 54.367 0 97.405-20.155 236.94 143.32 293.6 163.48-56.666 143.33-196.2 143.33-293.6zm-155.2 171.41-47.749-47.756 21.379-21.378 26.37 26.376 50.121-50.122 21.378 21.378-71.499 71.502z\"/>\n</svg>;\nvar svg_insecure = <svg viewBox=\"0 0 347.97 347.97\"><path d=\"M317.469 61.615c-59.442 0-104.976-16.082-143.489-51.539-38.504 35.457-84.04 51.539-143.479 51.539 0 92.337-20.177 224.612 143.479 278.324 163.661-53.717 143.489-185.992 143.489-278.324z\" fill=\"none\" stroke=\"red\" stroke-width=\"14.827\"/><g fill=\"red\"><path d=\"M238.802 115.023l-111.573 114.68-8.6-8.367L230.2 106.656z\"/><path d=\"M125.559 108.093l114.68 111.572-8.368 8.601-114.68-111.572z\"/></g></svg>;\nvar svg_insecure_relay = <svg viewBox=\"0 0 347.97 347.97\"><path d=\"M317.469 61.615c-59.442 0-104.976-16.082-143.489-51.539-38.504 35.457-84.04 51.539-143.479 51.539 0 92.337-20.177 224.612 143.479 278.324 163.661-53.717 143.489-185.992 143.489-278.324z\" fill=\"none\" stroke=\"red\" stroke-width=\"14.827\"/><g fill=\"red\"><path d=\"M231.442 247.498l-7.754-10.205c-17.268 12.441-38.391 17.705-59.478 14.822-21.087-2.883-39.613-13.569-52.166-30.088-25.916-34.101-17.997-82.738 17.65-108.42 32.871-23.685 78.02-19.704 105.172 7.802l-32.052 7.987 3.082 12.369 48.722-12.142-11.712-46.998-12.822 3.196 4.496 18.039c-31.933-24.008-78.103-25.342-112.642-.458-31.361 22.596-44.3 60.436-35.754 94.723 2.77 11.115 7.801 21.862 15.192 31.588 30.19 39.727 88.538 47.705 130.066 17.785z\"/></g></svg>;\nvar svg_secure_relay = <svg viewBox=\"0 0 347.97 347.97\"><path d=\"M317.469 61.615c-59.442 0-104.976-16.082-143.489-51.539-38.504 35.457-84.04 51.539-143.479 51.539 0 92.337-20.177 224.612 143.479 278.324 163.661-53.717 143.489-185.992 143.489-278.324z\" fill=\"#3f7d46\" stroke=\"#3f7d46\" stroke-width=\"14.827\"/><g fill=\"red\"><path d=\"M231.442 247.498l-7.754-10.205c-17.268 12.441-38.391 17.705-59.478 14.822-21.087-2.883-39.613-13.569-52.166-30.088-25.916-34.101-17.997-82.738 17.65-108.42 32.871-23.685 78.02-19.704 105.172 7.802l-32.052 7.987 3.082 12.369 48.722-12.142-11.712-46.998-12.822 3.196 4.496 18.039c-31.933-24.008-78.103-25.342-112.642-.458-31.361 22.596-44.3 60.436-35.754 94.723 2.77 11.115 7.801 21.862 15.192 31.588 30.19 39.727 88.538 47.705 130.066 17.785z\" fill=\"#fff\"/></g></svg>;\nvar svg_recording_off = <svg t=\"1663505560063\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"5393\" width=\"32\" height=\"32\"><path d=\"M1002.666667 260.266667c-12.8-8.533333-29.866667-4.266667-42.666667 4.266666L725.333333 430.933333V298.666667c0-72.533333-55.466667-128-128-128H128C55.466667 170.666667 0 226.133333 0 298.666667v426.666666c0 72.533333 55.466667 128 128 128h469.333333c72.533333 0 128-55.466667 128-128v-132.266666l230.4 166.4c17.066667 12.8 46.933333 8.533333 59.733334-8.533334 4.266667-8.533333 8.533333-17.066667 8.533333-25.6V298.666667c0-17.066667-8.533333-29.866667-21.333333-38.4zM640 725.333333c0 25.6-17.066667 42.666667-42.666667 42.666667H128c-25.6 0-42.666667-17.066667-42.666667-42.666667V298.666667c0-25.6 17.066667-42.666667 42.666667-42.666667h469.333333c25.6 0 42.666667 17.066667 42.666667 42.666667v426.666666z m298.666667-81.066666L755.2 512 938.666667 379.733333v264.533334z\" p-id=\"5394\" fill=\"#8a8a8a\"></path></svg>;\nvar svg_recording_on = <svg t=\"1663505598640\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"5644\" width=\"32\" height=\"32\"><path d=\"M1002.666667 260.266667c-12.8-8.533333-29.866667-4.266667-42.666667 4.266666L725.333333 430.933333V298.666667c0-72.533333-55.466667-128-128-128H128C55.466667 170.666667 0 226.133333 0 298.666667v426.666666c0 72.533333 55.466667 128 128 128h469.333333c72.533333 0 128-55.466667 128-128v-132.266666l230.4 166.4c17.066667 12.8 46.933333 8.533333 59.733334-8.533334 4.266667-8.533333 8.533333-17.066667 8.533333-25.6V298.666667c0-17.066667-8.533333-29.866667-21.333333-38.4z\" p-id=\"5645\" fill=\"#2C8CFF\"></path></svg>;\nvar cur_window_state = view.windowState;\nfunction check_state_change() {\nif (view.windowState != cur_window_state) {\nstateChanged();\n}\nself.timer(30ms, check_state_change);\n}\nif (is_linux) {\ncheck_state_change();\n} else {\nview << event statechange {\nstateChanged();\n}\n}\nfunction get_id() {\nreturn handler.get_option('alias') || handler.get_id()\n}\nfunction stateChanged() {\nstdout.println('state changed from ' + cur_window_state + ' -> ' + view.windowState);\ncur_window_state = view.windowState;\nadjustBorder();\nadaptDisplay();\nif (cur_window_state != View.WINDOW_MINIMIZED) {\nview.focus = handler; // to make focus away from restore/maximize button, so that enter key work\n}\nvar fs = view.windowState == View.WINDOW_FULL_SCREEN;\nvar el = $(#fullscreen);\nif (el) el.attributes.toggleClass(\"active\", fs);\nel = $(#maximize);\nif (el) {\nel.state.disabled = fs;\n}\nif (fs) {\n$(header).style.set {\ndisplay: \"none\",\n};\n}\n}\nvar header;\nvar old_window_state = View.WINDOW_SHOWN;\nvar is_edit_os_password;\nclass EditOsPassword: Reactor.Component {\nfunction render() {\nreturn <span style=\"margin-left: 12px; padding: 0 6px; display: inline-block;\" .link>{svg_edit}</span>;\n}\nfunction onMouse(evt) {\nif (evt.type == Event.MOUSE_DOWN) {\nis_edit_os_password = true;\neditOSPassword();\n}\n}\n}\nfunction editOSPassword(login=false) {\nvar p0 = handler.get_option('os-password');\nmsgbox(\"custom-os-password\", 'OS Password', p0, \"\", function(res=null) {\nif (!res) return;\nvar a0 = handler.get_option('auto-login') != '';\nvar p = (res.password || '').trim();\nvar a = res.autoLogin || false;\nif (p == p0 && a == a0) return;\nif (p != p0) handler.set_option('os-password', p);\nif (a != a0) handler.set_option('auto-login', a ? 'Y' : '');\nif (p && login) {\nhandler.input_os_password(p, true);\n}\n});\n}\nvar recording = false;\nclass Header: Reactor.Component {\nthis var conn_note = \"\";\nfunction this() {\nheader = this;\n}\nfunction render() {\nvar icon_conn;\nvar title_conn;\nif (this.secure_connection && this.direct_connection) {\nicon_conn = svg_secure;\ntitle_conn = translate(\"Direct and encrypted connection\");\n} else if (this.secure_connection && !this.direct_connection) {\nicon_conn = svg_secure_relay;\ntitle_conn = translate(\"Relayed and encrypted connection\");\n} else if (!this.secure_connection && this.direct_connection) {\nicon_conn = svg_insecure;\ntitle_conn = translate(\"Direct and unencrypted connection\");\n} else {\nicon_conn = svg_insecure_relay;\ntitle_conn = translate(\"Relayed and unencrypted connection\");\n}\nvar title = get_id();\nif (pi.hostname) title += \"(\" + pi.username + \"@\" + pi.hostname + \")\";\nif ((pi.displays || []).length == 0) {\nreturn <div .ellipsis style=\"size:*;text-align:center;margin:* 0;\">{title}</div>;\n}\nvar screens = pi.displays.map(function(d, i) {\nreturn <div #screen class={pi.current_display == i ? \"current\" : \"\"}>\n{i+1}\n</div>;\n});\nupdateWindowToolbarPosition();\nvar style = \"flow:horizontal;\";\nif (is_osx) style += \"margin:*\";\nself.timer(1ms, updatePrivacyMode);\nself.timer(1ms, toggleMenuState);\nreturn <div style={style}>\n{is_osx || is_xfce ? \"\" : <span #fullscreen>{svg_fullscreen}</span>}\n<div #screens>\n<span #secure title={title_conn}>{icon_conn}</span>\n<div .remote-id>{get_id()}</div>\n<div style=\"flow:horizontal;border-spacing: 0.5em;\">{screens}</div>\n{this.renderGlobalScreens()}\n</div>\n<span #chat>{svg_chat}</span>\n<span #action>{svg_action}</span>\n<span #display>{svg_display}</span>\n<span #keyboard>{svg_keyboard}</span>\n{recording_enabled ? <span #recording>{recording ? svg_recording_on : svg_recording_off}</span> : \"\"}\n{this.renderKeyboardPop()}\n{this.renderDisplayPop()}\n{this.renderActionPop()}\n</div>;\n}\nfunction renderKeyboardPop(){\nreturn <popup>\n<menu.context #keyboard-options>\n<li #legacy><span>{svg_checkmark}</span>{translate('Legacy mode')}</li>\n<li #map><span>{svg_checkmark}</span>{translate('Map mode')}</li>\n</menu>\n</popup>;\n}\nfunction renderDisplayPop() {\nvar codecs = handler.alternative_codecs();\nvar show_codec = codecs[0] || codecs[1] || codecs[2] || codecs[3];\nvar cursor_embedded = false;\nif ((pi.displays || []).length > 0) {\nif (pi.displays.length > pi.current_display) {\ncursor_embedded = pi.displays[pi.current_display].cursor_embedded;\n}\n}\nreturn <popup>\n<menu.context #display-options>\n<li #adjust-window style=\"display:none\">{translate('Adjust Window')}</li>\n<div #adjust-window .separator style=\"display:none\"/>\n<li #original type=\"view-style\"><span>{svg_checkmark}</span>{translate('Original')}</li>\n<li #shrink type=\"view-style\"><span>{svg_checkmark}</span>{translate('Shrink')}</li>\n<li #stretch type=\"view-style\"><span>{svg_checkmark}</span>{translate('Stretch')}</li>\n<div .separator />\n<li #best type=\"image-quality\"><span>{svg_checkmark}</span>{translate('Good image quality')}</li>\n<li #balanced type=\"image-quality\"><span>{svg_checkmark}</span>{translate('Balanced')}</li>\n<li #low type=\"image-quality\"><span>{svg_checkmark}</span>{translate('Optimize reaction time')}</li>\n<li #custom type=\"image-quality\"><span>{svg_checkmark}</span>{translate('Custom')}</li>\n{show_codec ? <div>\n<div .separator />\n<li #auto type=\"codec-preference\"><span>{svg_checkmark}</span>Auto</li>\n{codecs[0] ? <li #vp8 type=\"codec-preference\"><span>{svg_checkmark}</span>VP8</li> : \"\"}\n<li #vp9 type=\"codec-preference\"><span>{svg_checkmark}</span>VP9</li>\n{codecs[1] ? <li #av1 type=\"codec-preference\"><span>{svg_checkmark}</span>AV1</li> : \"\"}\n{codecs[2] ? <li #h264 type=\"codec-preference\"><span>{svg_checkmark}</span>H264</li> : \"\"}\n{codecs[3] ? <li #h265 type=\"codec-preference\"><span>{svg_checkmark}</span>H265</li> : \"\"}\n</div> : \"\"}\n<div .separator />\n{!cursor_embedded && <li #show-remote-cursor .toggle-option><span>{svg_checkmark}</span>{translate('Show remote cursor')}</li>}\n{<li #follow-remote-cursor .toggle-option><span>{svg_checkmark}</span>{translate('Follow remote cursor')}</li>}\n{<li #follow-remote-window .toggle-option><span>{svg_checkmark}</span>{translate('Follow remote window focus')}</li>}\n<li #show-quality-monitor .toggle-option><span>{svg_checkmark}</span>{translate('Show quality monitor')}</li>\n{audio_enabled ? <li #disable-audio .toggle-option><span>{svg_checkmark}</span>{translate('Mute')}</li> : \"\"}\n{(is_win && pi.platform == \"Windows\") && file_enabled ? <li #enable-file-copy-paste .toggle-option><span>{svg_checkmark}</span>{translate('Enable file copy and paste')}</li> : \"\"}\n{keyboard_enabled && clipboard_enabled ? <li #disable-clipboard .toggle-option><span>{svg_checkmark}</span>{translate('Disable clipboard')}</li> : \"\"}\n{keyboard_enabled ? <li #lock-after-session-end .toggle-option><span>{svg_checkmark}</span>{translate('Lock after session end')}</li> : \"\"}\n{keyboard_enabled && pi.platform == \"Windows\" ? <li #privacy-mode><span>{svg_checkmark}</span>{translate('Privacy mode')}</li> : \"\"}\n{keyboard_enabled && ((is_osx && pi.platform != \"Mac OS\") || (!is_osx && pi.platform == \"Mac OS\")) ? <li #allow_swap_key  .toggle-option><span>{svg_checkmark}</span>{translate('Swap control-command key')}</li> : \"\"}\n{handler.version_cmp(pi.version, '1.2.4') >= 0 ? <li #i444><span>{svg_checkmark}</span>{translate('True color (4:4:4)')}</li> : \"\"}\n</menu>\n</popup>;\n}\nfunction renderActionPop() {\nreturn <popup>\n<menu.context #action-options>\n{keyboard_enabled ? <li #os-password>{translate('OS Password')}<EditOsPassword /></li> : \"\"}\n<li #transfer-file>{translate('Transfer file')}</li>\n<li #tunnel>{translate('TCP tunneling')}</li>\n{handler.get_audit_server(\"conn\") && <li #note>{translate('Note')}</li>}\n<div .separator />\n{keyboard_enabled && (pi.platform == \"Linux\" || pi.sas_enabled) ? <li #ctrl-alt-del>{translate('Insert')} Ctrl + Alt + Del</li> : \"\"}\n{restart_enabled && (pi.platform == \"Linux\" || pi.platform == \"Windows\" || pi.platform == \"Mac OS\") ? <li #restart_remote_device>{translate('Restart remote device')}</li> : \"\"}\n{keyboard_enabled ? <li #lock-screen>{translate('Insert Lock')}</li> : \"\"}\n{keyboard_enabled && pi.platform == \"Windows\" && pi.sas_enabled ? <li #block-input>{translate(\"Block user input\")}</li> : \"\"}\n<li #refresh>{translate('Refresh')}</li>\n</menu>\n</popup>;\n}\nfunction renderGlobalScreens() {\nif (pi.displays.length < 3) return \"\";\nvar x0 = 9999999;\nvar y0 = 9999999;\nvar x = -9999999;\nvar y = -9999999;\npi.displays.map(function(d, i) {\nif (d.x < x0) x0 = d.x;\nif (d.y < y0) y0 = d.y;\nvar dx = d.x + d.width;\nif (dx > x) x = dx;\nvar dy = d.y + d.height;\nif (dy > y) y = dy;\n});\nvar w = x - x0;\nvar h = y - y0;\nvar scale = 16. / h;\nvar screens = pi.displays.map(function(d, i) {\nvar min_wh = d.width > d.height ? d.height : d.width;\nvar fs = min_wh * 0.9 * scale;\nvar style = \"width:\" + (d.width * scale) + \"px;\" +\n\"height:\" + (d.height * scale) + \"px;\" +\n\"left:\" + ((d.x - x0) * scale) + \"px;\" +\n\"top:\" + ((d.y - y0) * scale) + \"px;\" +\n\"font-size:\" + fs + \"px;\";\nif (is_osx) {\nstyle += \"line-height:\" + fs + \"px;\";\n}\nreturn <div style={style} class={pi.current_display == i ? \"current\" : \"\"}>{i+1}</div>;\n});\nvar style = \"width:\" + (w * scale) + \"px; height:\" + (h * scale) + \"px;\";\nreturn <div #global-screens style={style}>\n{screens}\n</div>;\n}\nevent click $(#fullscreen) (_, el) {\nif (view.windowState == View.WINDOW_FULL_SCREEN) {\nif (old_window_state == View.WINDOW_MAXIMIZED) {\nview.windowState = View.WINDOW_SHOWN;\n}\nview.windowState = old_window_state;\n} else {\nold_window_state = view.windowState;\nif (view.windowState == View.WINDOW_MAXIMIZED) {\nview.windowState = View.WINDOW_SHOWN;\n}\nview.windowState = View.WINDOW_FULL_SCREEN;\nif (is_linux) { self.timer(150ms, function() { view.windowState = View.WINDOW_FULL_SCREEN; }); }\n}\n}\nevent click $(#chat) {\nstartChat();\n}\nevent click $(#action) (_, me) {\nvar menu = $(menu#action-options);\nme.popup(menu);\n}\nevent click $(#display) (_, me) {\nvar menu = $(menu#display-options);\nme.popup(menu);\n}\nevent click $(#keyboard) (_, me) {\nvar menu = $(menu#keyboard-options);\nme.popup(menu);\n}\nevent click $(span#recording) (_, me) {\nrecording = !recording;\nheader.update();\nhandler.record_status(recording);\n// 0 is just a dummy value. It will be ignored by the handler.\nif (recording) {\nhandler.refresh_video(0);\nif (handler.version_cmp(pi.version, '1.2.4') >= 0) handler.record_screen(recording, pi.current_display, display_width, display_height);\n}\nelse {\nhandler.record_screen(recording, pi.current_display, display_width, display_height);\n}\n}\nevent click $(#screen) (_, me) {\nif (pi.current_display == me.index) return;\nif (recording) {\nrecording = false;\nhandler.record_screen(false, pi.current_display, display_width, display_height);\nhandler.record_status(false);\n}\nhandler.switch_display(me.index);\n}\nevent keyup (evt) {\nif((pi.displays || []).length > 0 && evt.keyCode == 220)\n{\nif (pi.displays.length > pi.current_display)\nhandler.switch_display(pi.current_display + 1);\nelse\nhandler.switch_display(1);\n}\n}\nevent click $(#transfer-file) {\nhandler.transfer_file();\n}\nevent click $(#os-password) (evt) {\nif (is_edit_os_password) {\nis_edit_os_password = false;\nreturn;\n}\nvar p = handler.get_option('os-password');\nif (!p) editOSPassword(true);\nelse handler.input_os_password(p, true);\n}\nevent click $(#tunnel) {\nhandler.tunnel();\n}\nevent click $(#note) {\nvar self = this;\nmsgbox(\"custom\", \"Note\", <div .form>\n<textarea .outline-focus spellcheck=\"false\" name=\"text\" novalue=\"input note here\" style=\"overflow: scroll-indicator; width:*; height: 140px; font-size: 1.2em; padding: 0.5em;\">{self.conn_note}</textarea>\n</div>, \"\", function(res=null) {\nif (!res) return;\nif (res.text == null || res.text == undefined) return;\nself.conn_note = res.text ?? \"\";\nhandler.send_note(res.text);\n}, 280);\n}\nevent click $(#ctrl-alt-del) {\nhandler.ctrl_alt_del();\n}\nevent click $(#restart_remote_device) {\nmsgbox(\n\"restart-confirmation\",\ntranslate(\"Restart remote device\"),\ntranslate(\"Are you sure you want to restart\") + \" \" + pi.username + \"@\" + pi.hostname + \"(\" + get_id() + \") ?\",\n\"\",\nfunction(res=null) {\nif (res != null) handler.restart_remote_device();\n}\n);\n}\nevent click $(#lock-screen) {\nhandler.lock_screen();\n}\nevent click $(#refresh) {\n// 0 is just a dummy value. It will be ignored by the handler.\nhandler.refresh_video(0);\n}\nevent click $(#block-input) {\nif (!input_blocked) {\nhandler.toggle_option(\"block-input\");\ninput_blocked = true;\n$(#block-input).text = translate(\"Unblock user input\");\n} else {\nhandler.toggle_option(\"unblock-input\");\ninput_blocked = false;\n$(#block-input).text = translate(\"Block user input\");\n}\n}\nevent click $(menu#display-options li) (_, me) {\nif (me.id == \"custom\") {\nhandle_custom_image_quality();\n} else if (me.id == \"privacy-mode\") {\ntogglePrivacyMode(me.id);\n} else if (me.id == \"show-quality-monitor\") {\ntoggleQualityMonitor(me.id);\n} else if (me.id == \"i444\") {\ntoggleI444(me.id);\n} else if (me.attributes.hasClass(\"toggle-option\")) {\nhandler.toggle_option(me.id);\ntoggleMenuState();\n} else if (!me.attributes.hasClass(\"selected\")) {\nvar type =  me.attributes[\"type\"];\nif (type == \"image-quality\") {\nhandler.save_image_quality(me.id);\n} else if (type == \"view-style\") {\nhandler.save_view_style(me.id);\nadaptDisplay();\n} else if (type == \"codec-preference\") {\nhandler.set_option(\"codec-preference\", me.id);\nhandler.change_prefer_codec();\n}\ntoggleMenuState();\n}\n}\nevent click $(menu#keyboard-options>li) (_, me) {\nif (me.id == \"legacy\") {\nhandler.save_keyboard_mode(\"legacy\");\n} else if (me.id == \"map\") {\nhandler.save_keyboard_mode(\"map\");\n} else if (me.id == \"translate\") {\nhandler.save_keyboard_mode(\"translate\");\n}\ntoggleMenuState()\n}\n}\nfunction handle_custom_image_quality() {\nvar tmp = handler.get_custom_image_quality();\nvar bitrate = (tmp[0] || 50);\nvar extendedBitrate = bitrate > 100;\nvar maxRate = extendedBitrate ? 2000 : 100;\nmsgbox(\"custom-image-quality\", \"Custom Image Quality\", \"<div .form> \\\n<div><input #bitrate-slider type=\\\"hslider\\\" style=\\\"width: 50%\\\" name=\\\"bitrate\\\" max=\\\"\" + maxRate + \"\\\" min=\\\"10\\\" value=\\\"\" + bitrate + \"\\\"/ buddy=\\\"bitrate-buddy\\\"><b #bitrate-buddy>x</b>% Bitrate <button|checkbox #extended-slider .custom-event \" + (extendedBitrate ? \"checked\" : \"\") + \">More</button></div> \\\n</div>\", \"\", function(res=null) {\nif (!res) return;\nif (res.id === \"extended-slider\") {\nvar slider = res.parent.$(#bitrate-slider)\nslider.slider.max = res.checked ? 2000 : 100;\nif (slider.value > slider.slider.max) {\nslider.value = slider.slider.max;\n}\nvar buddy = res.parent.$(#bitrate-buddy);\nbuddy.value = slider.value;\nreturn;\n}\nif (!res.bitrate) return;\nhandler.save_custom_image_quality(res.bitrate);\ntoggleMenuState();\n});\n}\nfunction toggleMenuState() {\nvar values = [];\nvar q = handler.get_image_quality();\nif (!q) q = \"balanced\";\nvalues.push(q);\nvar s = handler.get_view_style();\nif (!s) s = \"original\";\nvalues.push(s);\nvar k = handler.get_keyboard_mode();\nvalues.push(k);\nvar c = handler.get_option(\"codec-preference\");\nif (!c) c = \"auto\";\nvalues.push(c);\nfor (var el in $$(menu#display-options li)) {\nel.attributes.toggleClass(\"selected\", values.indexOf(el.id) >= 0);\n}\nfor (var el in $$(menu#keyboard-options>li)) {\nel.attributes.toggleClass(\"selected\", values.indexOf(el.id) >= 0);\n}\nfor (var id in [\"show-remote-cursor\", \"follow-remote-cursor\", \"follow-remote-window\", \"show-quality-monitor\", \"disable-audio\", \"enable-file-copy-paste\", \"disable-clipboard\", \"lock-after-session-end\", \"allow_swap_key\", \"i444\"]) {\nvar el = self.select('#' + id);\nif (el) {\nvar value = handler.get_toggle_option(id);\nel.attributes.toggleClass(\"selected\", value);\n}\n}\n}\nif (is_osx) {\n$(header).content(<Header />);\n$(header).attributes[\"role\"] = \"window-caption\";\n} else {\nif (is_file_transfer || is_port_forward) {\n$(caption).content(<Header />);\n} else {\n$(div.window-toolbar).content(<Header />);\n}\nsetWindowButontsAndIcon();\n}\nif (!(is_file_transfer || is_port_forward)) {\n$(header).style.set {\nheight: \"32px\",\n};\nif (!is_osx) {\n$(div.window-icon).style.set {\nsize: \"32px\",\n};\n}\n}\nhandler.updatePi = function(v) {\npi = v;\nheader.update();\nif (is_port_forward) {\nview.windowState = View.WINDOW_MINIMIZED;\n}\n}\nhandler.updateDisplays = function(v) {\npi.displays = v;\nheader.update();\nif (is_port_forward) {\nview.windowState = View.WINDOW_MINIMIZED;\n}\n}\nhandler.setMultipleWindowsSession = function(sessions) {\n// It will be covered by other message box if the timer is not used,\nself.timer(1000ms, function() {\nmsgbox(\"multiple-sessions-nocancel\", translate(\"Multiple Windows sessions found\"), <MultipleSessionComponent sessions={sessions} />, \"\", function(res) {\nif (res && res.sid) {\nhandler.set_selected_windows_session_id(\"\" + res.sid);\n}\n}, 230);\n});\n}\nhandler.setCurrentDisplay = function(v) {\npi.current_display = v;\nhandler.switch_display(v);\nheader.update();\nif (is_port_forward) {\nview.windowState = View.WINDOW_MINIMIZED;\n}\n}\nfunction updatePrivacyMode() {\nvar el = $(li#privacy-mode);\nif (el) {\nvar supported = handler.is_privacy_mode_supported();\nif (!supported) {\n// el.attributes.toggleClass(\"line-through\", true);\nel.style[\"display\"]=\"none\";\n} else {\nvar value = handler.get_toggle_option(\"privacy-mode\");\nel.attributes.toggleClass(\"selected\", value);\nvar el = $(li#block-input);\nif (el) {\nel.state.disabled = value;\n}\n}\n}\n}\nhandler.updatePrivacyMode = updatePrivacyMode;\nfunction togglePrivacyMode(privacy_id) {\nvar supported = handler.is_privacy_mode_supported();\nif (!supported) {\nmsgbox(\"nocancel\", translate(\"Privacy mode\"), translate(\"Unsupported\"), \"\", function() { });\n} else {\nhandler.toggle_option(privacy_id);\n}\n}\nfunction toggleQualityMonitor(name) {\nvar show = handler.get_toggle_option(name);\nif (show) {\n$(#quality-monitor).style.set{ display: \"none\" };\n} else {\n$(#quality-monitor).style.set{ display: \"block\" };\n}\nhandler.toggle_option(name);\ntoggleMenuState();\n}\nfunction toggleI444(name) {\nhandler.toggle_option(name);\nhandler.change_prefer_codec();\ntoggleMenuState();\n}\nhandler.updateBlockInputState = function(input_blocked) {\nif (!input_blocked) {\nhandler.toggle_option(\"block-input\");\ninput_blocked = true;\n$(#block-input).text = translate(\"Unblock user input\");\n} else {\nhandler.toggle_option(\"unblock-input\");\ninput_blocked = false;\n$(#block-input).text = translate(\"Block user input\");\n}\n}\nhandler.switchDisplay = function(i) {\npi.current_display = i;\nheader.update();\n}\nfunction updateWindowToolbarPosition() {\nif (is_osx) return;\nself.timer(1ms, function() {\nvar el = $(div.window-toolbar);\nvar w1 = el.box(#width, #border);\nvar w2 = $(header).box(#width, #border);\nvar x = (w2 - w1) / 2 / scaleFactor;\nel.style.set {\nleft: x + \"px\",\ndisplay: \"block\",\n};\n});\n}\nview.on(\"size\", function() {\n// ensure size is done, so add timer\nself.timer(1ms, function() {\nupdateWindowToolbarPosition();\nadaptDisplay();\n});\n});\nhandler.newMessage = function(text) {\nchat_msgs.push({text: text, name: pi.username || \"\", time: getNowStr()});\nstartChat();\n}\nfunction sendMsg(text) {\nchat_msgs.push({text: text, name: \"me\", time: getNowStr()});\nhandler.send_chat(text);\nif (chatbox) chatbox.refresh();\n}\nvar chatbox;\nfunction startChat() {\nif (chatbox) {\nchatbox.windowState = View.WINDOW_SHOWN;\nchatbox.refresh();\nreturn;\n}\nvar icon = handler.get_icon();\nvar (sx, sy, sw, sh) = view.screenBox(#workarea, #rectw);\nvar w = scaleIt(300);\nvar h = scaleIt(400);\nvar x = (sx + sw - w) / 2;\nvar y = sy + scaleIt(80);\nvar params = {\ntype: View.FRAME_WINDOW,\nx: x,\ny: y,\nwidth: w,\nheight: h,\nclient: true,\nparameters: { msgs: chat_msgs, callback: sendMsg, icon: icon },\ncaption: get_id(),\n};\nvar html = handler.get_chatbox();\nif (html) params.html = html;\nelse params.url = self.url(\"chatbox.html\");\nchatbox = view.window(params);\n}\nhandler.setConnectionType = function(secured, direct) {\nheader.update({\nsecure_connection: secured,\ndirect_connection: direct,\n});\n}\n</script>\n</head>\n<header>\n<div.window-icon role=\"window-icon\">\n<icon />\n</div>\n<caption role=\"window-caption\" />\n<div.window-toolbar />\n<div.window-buttons />\n</header>\n<body>\n<div #video-wrapper>\n<video #handler>\n<div #quality-monitor style=\"position: absolute; display: none\" />\n<div style=\"position: relative\">\n<img #cursor src=\"in-memory:cursor\" />\n</div>\n</video>\n</div>\n<div #file-transfer-wrapper>\n</div>\n<div #msgbox />\n</body>\n</html>";
const _CHATBOX: &[u8; 598] = b"<html window-resizable>\n<head>\n<style>\n@import url(common.css);\n@media platform != \"OSX\" {\nbody {\nborder-top: color(border) solid 1px;\n}\n}\n</style>\n<script type=\"text/tiscript\">\ninclude \"common.tis\";\nvar p = view.parameters;\nview.refresh = function() {\n$(body).content(<ChatBox msgs={p.msgs} callback={p.callback} />);\nview.focus = $(input);\n}\nfunction self.closing() {\nview.windowState = View.WINDOW_HIDDEN;\nreturn false;\n}\nview.windowIcon = self.url(p.icon);\nfunction self.ready() {\nview.windowTopmost = true;\nview.refresh();\nview.windowTopmost = false;\n}\n</script>\n</head>\n<body></body>\n</html>\n";
const _INSTALL: &[u8; 2399] = b"<html>\n<head>\n<style>\n@import url(common.css);\ndiv.content {\nsize: *;\nbackground: white;\npadding:2em 8em;\nborder-spacing: 1em;\n}\ninput {\nfont-size: 1em;\n}\n</style>\n<script type=\"text/tiscript\">\ninclude \"common.tis\";\nfunction self.ready() {\ncenterize(scaleIt(800), scaleIt(600));\n}\nvar install_path = \"\";\nclass Install: Reactor.Component {\nfunction render() {\nreturn <div .content>\n<div style=\"font-size: 2em;\">{translate('Installation')}</div>\n<div style=\"margin: 2em 0;\">{translate('Installation Path')} {\": \"}<input|text disabled value={view.install_path()} #path_input />\n<button .button .outline #path style=\"margin-left: 1em\">{translate('Change Path')}</button>\n</div>\n<div><button|checkbox #startmenu checked>{translate('Create start menu shortcuts')}</button></div>\n<div><button|checkbox #desktopicon checked>{translate('Create desktop icon')}</button></div>\n<div #agreement .link style=\"margin-top: 2em;\">{translate('End-user license agreement')}</div>\n<div>{translate('agreement_tip')}</div>\n<div style=\"height: 1px; background: gray; margin-top: 1em\" />\n<div style=\"text-align: right;\">\n<progress style={\"color:\" + color} style=\"display: none\" />\n<button .button id=\"cancel\" .outline style=\"margin-right: 2em;\">{translate('Cancel')}</button>\n<button .button id=\"submit\">{translate('Accept and Install')}</button>\n{handler.show_run_without_install() && <button .button #run-without-install .outline style=\"margin-left: 2em;\">\n{translate('Run without install')}\n</button>}\n</div>\n</div>;\n}\nevent click $(#cancel) {\nview.close();\n}\nevent click $(#run-without-install) {\nhandler.run_without_install();\n}\nevent click $(#path) {\ninstall_path = view.selectFolder() || \"\";\nif (install_path) {\ninstall_path = install_path.urlUnescape();\ninstall_path = install_path.replace(\"file://\", \"\").replace(\"/\", \"\\\\\");\nif (install_path[install_path.length - 1] != \"\\\\\") install_path += \"\\\\\";\ninstall_path += handler.get_app_name();\n$(#path_input).value = install_path;\n}\n}\nevent click $(#agreement) {\nview.open_url(\"http://sash.com.my/privacy\");\n}\nevent click $(#submit) {\nfor (var el in $$(button)) el.state.disabled = true;\n$(progress).style.set{ display: \"inline-block\" };\nvar args = \"\";\nif ($(#startmenu).value) {\nargs += \"startmenu \";\n}\nif ($(#desktopicon).value) {\nargs += \"desktopicon \";\n}\nview.install_me(args, install_path);\n}\n}\n$(body).content(<Install />);\n</script>\n</head>\n<body>\n</body>\n</html>\n";
const _CONNECTION_MANAGER: &[u8; 23900] = b"<html>\n<head>\n<style>\n@import url(common.css);\nbody {\nbehavior: connection-manager;\n}\ndiv.content {\nflow: horizontal;\nsize: *;\n}\ndiv.left-panel {\nsize: *;\npadding: 1em;\nborder-spacing: 1em;\noverflow-x: scroll-indicator;\nposition: relative;\n}\ndiv.chaticon svg {\nsize: 24px;\nmargin: 4px;\nopacity: 0.66;\n}\ndiv.chaticon {\nposition: absolute;\nright: 0;\ntop: 0;\nsize: 32px;\nbackground-color: color(gray-bg);\n}\ndiv.chaticon:hover svg {\nopacity: 1;\n}\ndiv.chaticon:active {\nbackground: white;\n}\ndiv.right-panel {\nbackground: white;\nborder-left: color(border) 1px solid;\nsize: *;\n}\ndiv.icon-and-id {\nflow: horizontal;\nborder-spacing: 1em;\n}\ndiv.icon {\nsize: 96px;\ntext-align: center;\nfont-size: 76px;\nline-height: 96px;\ncolor: white;\nfont-weight: bold;\n}\ndiv.id {\n@ELLIPSIS;\ncolor: color(green-blue);\n}\ndiv.permissions {\nflow: horizontal;\nborder-spacing: 0.5em;\n}\ndiv.permissions > div {\nsize: 42px;\nbackground: color(accent);\n}\ndiv.permissions icon {\nmargin: *;\nsize: 32px;\nbackground-size: cover;\nbackground-repeat: no-repeat;\ndisplay: block;\n}\ndiv.permissions > div.disabled {\nbackground: #ddd;\n}\ndiv.permissions > div:active {\nopacity: 0.5;\n}\nicon.keyboard {\nbackground: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAAgVBMVEUAAAD///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////9d3yJTAAAAKnRSTlMA0Gd/0y8ILZgbJffDPUwV2nvzt+TMqZxyU7CMb1pYQyzsvKunkXE4AwJnNC24AAAA+0lEQVQ4y83O2U7DMBCF4ZMxk9rZk26kpQs7nPd/QJy4EiLbLf01N5Y/2YP/qxDFQvGB5NPC/ZpVnfJx4b5xyGfF95rkHvNCWH1u+N6J6T0sC7gqRy8uGPfBLEbozPXUjlkQKwGaFPNizwQbwkx0TDvhCii34ExZCSQVBdzIOEOyeclSHgBGXkpeygXSQgStACtWx4Z8rr8COHOvfEP/IbbsQAToFUAAV1M408IIjIGYAPoCSNRP7DQutfQTqxuAiH7UUg1FaJR2AGrrx52sK2ye28LZ0wBAEyR6y8X+NADhm1B4fgiiHXbRrTrxpwEY9RdM9wsepnvFHfUDwYEeiwAJr/gAAAAASUVORK5CYII=');\n}\nicon.clipboard {\nbackground: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAAjVBMVEUAAAD///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////8DizOFAAAALnRSTlMAnIsyZy8YZF3NSAuabRL34cq6trCScyZ4qI9CQDwV+fPl2tnTwzkeB+m/pIFK/Xx0ewAAAQlJREFUOMudktduhDAQRWep69iY3tle0+7/f16Qg7MsJUQ5Dwh8jzRzhemJPIaf3GiW7eFQfOwDPp1ek/iMnKgBi5PrhJAhZAa1lCxE9pw5KWMswOMAQXuQOvqTB7tLFJ36wimKLrufZTzUaoRtdthqRA2vEwS+tR4qguiElRKk1YMrYfUQRkwLmwVBYDMvJKF8R0o3V2MOhNrfo+hXSYYjPn1L/S+n438t8gWh+q1F+cYFBMm1Jh8Ia7y2OWXQxMMRLqr2eTc1crSD84cWfEGwYM4LlaACEee2ZjsQXJxR3qmYb+GpC8ZfNM5oh3yxxbxgQE7lEkb3ZvvH1BiRHn1bu02ICcKGWr4AudUkyYxmvywAAAAASUVORK5CYII=');\n}\nicon.audio {\nbackground: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAAk1BMVEUAAAD////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////ROyVeAAAAMHRSTlMAgfz08DDqCAThvraZjEcoGA751JxzbGdfTRP25NrIpaGTcEM+HAvMuKinhXhWNx9Yzm/gAAABFUlEQVQ4y82S2XLCMAxFheMsQNghCQFalkL39vz/11V4GpNk0r629+Va1pmxPFfyh1ravOP2Y1ydJmBO0lYP3r+PyQ62s2Y7fgF6VRXOYdToT++ogIuoVhCUtX7YpwJG3F8f6V8rr3WABwwUahlEvr8y3IBniGKdKYBQ5OGQpukQakBpIVcfwptIhJcf8hWGakdndAAhBInIGHbdQGJg6jjbDUgEE5EpmB+AAM4uj6gb+AQT6wdhITLvAHJ4VCtgoAlG1tpNA0gWON/f4ioHdSADc1bfgt+PZFkDlD6ojWF+kVoaHlhvFjPHuVRrefohY1GdcFm1N8JvwEyrJ/X2Th2rIoVgIi3Fo6Xf0z5k8psKu5f/oi+nHjjI92o36AAAAABJRU5ErkJggg==');\n}\nicon.file {\nbackground:url('data: image/png;base64, iVBORw0KGgoAAAANSUhEUgAAAGAAAABgCAMAAADVRocKAAAAUVBMVEUAAAD///////////////////////////////////////////////////////////////////////////////////////////////////////8IN+deAAAAGnRSTlMAH+CAESEN8jyZkcIb5N/ONy3vmHhmiGjUm7UwS+YAAAHZSURBVGje7dnbboMwDIBhBwgQoFAO7Ta//4NOqCAXYZQstatq4r+r5ubrgQSpg8iyC4ZURa+PlIpQYGiwrzyeHtYZjAL8T05O4H8BbbKvFgRa4NoBU8pXeYEkDDgaaLQBcwJrmeErJQB/7wes3QBWGnCIX0+AQycL1PO6BMwPa0nA4ZxbgTvOjUYMGPHRnZkQAY4mxPZBjmy53E7ukSkFKYB/D4XsWZQx64sCeYebOogGsoOBYvv6/UCb8F0IOBZ0TlP6lEYdANY350AJqB9/qPVuOI5evw4A1hgLigAlepnyxW80bcCcwN++A2s82Vcu02ta+ceq9BoL5KGTTRwQPlpqA3gCnwWU2kCDgeWRQPj2jAPCDxgCMjhI6uZnToDpvd/BJeFrJQB/fsAa02gCt3mi1wNuy8GgBNDZlysBNNSrADVSjcJl6vCpUn6jOdx0kz0q6PMhQRa4465SFKhx35cgUCBTwj2/NHwZAb71qR8GEP2H1XcmAtBPTEO67GP6FUUAIKGABbDLQ0EArhN2sAIGesRO+iyy+RMAjckVTlMCKFVAbh/4Af9OPgG61SkDVco3BQGT3GXaDAnTIAcYZDuBTwGsAGDxuBFeAQqIqwoFMlAVLrHr/wId5MPt0nilGgAAAABJRU5ErkJggg==');\n}\nicon.restart {\nbackground: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAB7BAAAewQHDaVRTAAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAAAbhJREFUWIXVlrFqFGEUhb+7UYxaWCQKlrKKxaZSQVGDJih2tj6MD2DnMwiWvoAIRnENIpZiYxEro6IooiS7SPwsMgNLkk3mjmYmnmb45/73nMNwz/x/qH3gMu2gH6rAU+Blw+Lngau4jpmGxVF7qp1iPWjaQKnZ2WnXbuP/NqAeUPc3ZkA9XDwvqc+BVWCgPlJ7tRwUKThZce819b46VH+pfXVRXVO/q2cSul3VOgZUl0ejq86r39TXI8mqZKDuDEwCw3IREQvAbWAGmMsQZQ0sAl3gHPB1Q+0e8BuYzRDuy2yOiFVgaUxtRf0ETGc4syk4rc6PqU0Cx9j8Zf6dAeAK8Fi9sUXtFjABvEgxJlNwRP2svlNPjbw/q35U36oTFbnyMSwabxb/gB/qA3VBHagrauV7RW0DRfP1IvMlXqkXkhz1DYyQTKtHa/Z2VVMx3IiI+PI3/bCHjuOpFrSnAMpL6QfgTcMGesDx0kBr2BMzsNyi/vtQu8CJlgwsRbZDnWP90NkKaxHxJMOXMqAeAn5u0ydwMCKGY+qbkB3C2W3EKWoXk5zVoHbUZ+6Mh7tl4G4F8RJ3qvL+AfV3r5Vdpj70AAAAAElFTkSuQmCC');\n}\nicon.recording {\nbackground: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAANpJREFUWEftltENAiEMhtsJ1NcynG6gI+gGugEOR591gppeQoIYSDBILxEeydH/57u2FMF4obE+TAOTwLoIhBDOAHBExG2n6rgR0akW640AM0sn4SWMiDycc7s8JjN7Ijro/k8NqAAR5RoeAPZxv2ggP9hCJiWZxtGbq3hqbJiBVHy4gVx8qAER8Yi4JFy6huVAKXemgb8icI+1b5KEitq0DOO/Nm1EEX1TK27p/bVvv36MOhl4EtHHbFF7jq8AoG1z08OAiFycczrkFNe6RrIet26NMQlMAuYEXiayryF/QQktAAAAAElFTkSuQmCC');\n}\nicon.block_input {\nbackground: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAjdJREFUWEe1V8tNAzEQfXOHAx2QG0UgQSqBFIIgHdABoQqOhBq4cCMlcMh90FvZq/HEXtvJxlKUZNceP783no+gY6jqNYBHAHcA+JufXTDBb37eRWTbalZqE82mz7W55v0ABMBGRCLA7PJJAKr6AiC3sT11NHyf2SEyQjvtAMKp3wBYo9VTGbYegjxxU65d5tg4YEBVbwF8ALgw2lLX4in80QqyZUEkAMLCb7P5n4hcdWifTA32Pg0bByA8AE4+oL3n9A1s7ERkEeeNAJzD/QC4OVaCAgjrU7wdK86zAHREJSKqyvvORRxVb67JFOT4NfYGpxwAqCo34oYcKxHZhOdzg7D2BhYigHj6RJ+5QbjrPezlqR61sZTOKYfztSUBWPoXpdA5FwjnC2sCGK+eiNRC8yw+oap0RiayLQHEPwf65zx7DibMoXcEEB0wq/85QJQAbEVkWbvP8f0pTFi/65ZgjtuRyJ7QYWL0OZnwTmiLDobH5nLqGDlUlcmON49jQwnsg/Wxma/VJ1zcGQIR7+OYJGyqbJWhhwlDPxh3JpNRL4Ba7nAsJckoYaFUv7UCyslBvQ3TNDWEfVsPJGH2FCkKTPAxD8ox+poFwJfZqqX15H6eYyK+TgJeriidLCJ7wAQHZ4Udy7u9iFxaG7mynEx4EF1leZDANzV7AE8i8joJICz2cvBxbExIYTZYTTQmxTxTzP+VnvC8rZlLOLEj7m5OW6JqtTs2US6247Hvy7XnX0OV05FP/gHde5fLZaGS8AAAAABJRU5ErkJggg==');\n}\ndiv.outer_buttons {\nflow:vertical;\nborder-spacing:8;\n}\ndiv.inner_buttons {\nflow:horizontal;\nborder-spacing:8;\n}\nbutton.control {\nwidth: *;\n}\nbutton.elevate {\nbackground:green;\n}\nbutton.elevate:active {\nbackground: rgb(2, 104, 2);\nborder-color: color(hover-border);\n}\nbutton.elevate>span {\nflow:horizontal;\nwidth: *;\n}\nbutton.elevate>span>span {\nmargin-left:*;\nmargin-right:*;\n}\nbutton.elevate>span>span>span {\nvertical-align: middle;\n}\nbutton#disconnect {\nbackground: color(blood-red);\nborder: none;\n}\nbutton#disconnect:active {\nopacity: 0.5;\n}\n@media platform != \"OSX\" {\nheader .window-toolbar {\nleft: 40px;\ntop: 8px;\n}\n}\n@media platform == \"OSX\" {\nheader .tabs-wrapper {\nmargin-left: 80px;\nmargin-top: 8px;\n}\n}\ndiv.tabs-wrapper {\nsize: *;\nposition: relative;\noverflow: hidden;\n}\ndiv.tabs {\nsize: *;\nflow: horizontal;\nwhite-space: nowrap;\noverflow: hidden;\n}\nheader {\nheight: 32px;\nborder-bottom: none;\n}\ndiv.border-bottom {\nposition: absolute;\nbottom: 0;\nleft: 0;\nwidth: *;\nheight: 1px;\nbackground: color(border) 1px solid;\n}\nheader div.window-icon {\nsize: 32px;\n}\ndiv.tabs > div {\ndisplay: inline-block;\nheight: 24px;\nline-height: 24px;\n}\ndiv.tab {\nwidth: 70px;\n@ELLIPSIS;\ntext-align: center;\nposition: relative;\npadding: 0 5px;\ncolor: black\n}\ndiv.active-tab {\nbackground: color(gray-bg);\nborder: color(border) 1px solid;\nborder-bottom: none;\nfont-weight: bold;\n}\nspan.unreaded {\nposition: absolute;\nfont-size: 11px;\nsize: 15px;\nborder-radius: 15px;\nline-height: 15px;\nbackground: color(blood-red);\ndisplay: inline-block;\ncolor: white;\n}\ndiv.left-panel {\nbackground: color(gray-bg);\n}\nbutton.window#minimize {\nright: 0px!important;\n}\ndiv.tab-arrows {\nposition: absolute;\nright: 2px;\nfont-weight: bold;\nbackground: white;\n}\ndiv.tab-arrows span {\ndisplay: inline-block;\nheight: *;\nmargin: 0;\npadding: 6px 2px;\nline-height: 20px;\nopacity: 0.66;\n}\ndiv.tab-arrows span:hover {\nopacity: 1;\n}\ndiv.tab-arrows span:active {\nopacity: 1;\nbackground-color: #ddd;\n}\n</style>\n<script type=\"text/tiscript\">\ninclude \"common.tis\";\nview.windowFrame = is_osx ? #extended : #solid;\nvar body;\nvar connections = [];\nvar show_chat = false;\nvar show_elevation = true;\nvar svg_elevate = <svg t=\"1667992597853\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"1850\" width=\"16\" height=\"16\" xmlns:xlink=\"http://www.w3.org/1999/xlink\"><path d=\"M892.761 160.724v426.504c0 25.588-6.419 51.036-19.177 76.339-12.798 25.336-29.547 49.86-50.254 73.627-20.707 23.79-44.372 46.296-70.97 67.516-26.589 21.244-53.543 40.177-80.921 56.768-27.363 16.623-53.968 30.461-79.801 41.438-25.809 11.008-48.433 18.547-67.871 22.64l-9.203 1.53-8.43-1.53c-19.958-4.093-43.094-11.632-69.432-22.64-26.337-10.969-53.708-24.816-82.080-41.438-28.388-16.591-56.256-35.524-83.618-56.768-27.378-21.219-51.776-43.725-73.265-67.516-21.488-23.759-38.868-48.291-52.155-73.627-13.319-25.305-19.974-50.759-19.974-76.339v-426.504l31.455-4.629 352.892-65.97 359.784 65.97 23.017 4.629zM510.028 151.884l-4.211-0.844-302.89 51.476v269.101h307.102v-319.734zM815.434 471.634h-305.406v383.031c19.682-4.51 41.052-11.411 64.141-20.692 23.033-9.249 45.815-20.234 68.304-32.867 22.513-12.672 44.159-26.739 64.969-42.203 20.818-15.472 39.23-32.047 55.277-49.797 16.024-17.703 28.822-36.131 38.386-55.222 9.549-19.131 14.328-38.553 14.328-58.235v-124.015z\" p-id=\"1851\" fill=\"#ffffff\"></path></svg>;\nclass Body: Reactor.Component\n{\nthis var cur = 0;\nfunction this() {\nbody = this;\n}\nfunction render() {\nif (connections.length == 0)\nreturn <div style=\"size:*; margin: * 0; text-align: center;\">\nWaiting for new connection ...\n</div>;\nvar c = connections[this.cur];\nthis.connection = c;\nthis.cid = c.id;\nvar auth = c.authorized;\nvar me = this;\nvar callback = function(msg) {\nme.sendMsg(msg);\n};\nvar right_style = show_chat ? \"\" : \"display: none\";\nvar disconnected = c.disconnected;\nvar show_elevation_btn = handler.can_elevate() && show_elevation && !c.is_file_transfer && c.port_forward.length == 0;\nvar show_accept_btn = handler.get_option('approve-mode') != 'password';\n// below size:* is a workaround for Linux, it already set in css, but not work, shit sciter\nreturn <div .content style=\"size:*\">\n<div .left-panel>\n<div .icon-and-id>\n<div .icon style={\"background: \" + string2RGB(c.name, 1)}>\n{c.name[0].toUpperCase()}\n</div>\n<div>\n<div .id style=\"font-weight: bold; font-size: 1.2em;\">{c.name}</div>\n<div .id>({c.peer_id})</div>\n<div style=\"margin-top: 1.2em\">{auth\n? <span>{disconnected ? translate('Disconnected') : translate('Connected')}{\" \"}<span #time>{getElapsed(c.time, c.now)}</span></span>\n: <span>{translate('Request access to your device')}{\"...\"}</span>}\n</div>\n</div>\n</div>\n<div />\n{c.is_file_transfer || c.port_forward || disconnected ? \"\" : <div>{translate('Permissions')}</div>}\n{c.is_file_transfer || c.port_forward || disconnected ? \"\" : <div> <div .permissions>\n<div class={!c.keyboard ? \"disabled\" : \"\"} title={translate('Enable keyboard/mouse')}><icon .keyboard /></div>\n<div class={!c.clipboard ? \"disabled\" : \"\"} title={translate('Enable clipboard')}><icon .clipboard /></div>\n<div class={!c.audio ? \"disabled\" : \"\"} title={translate('Enable audio')}><icon .audio /></div>\n<div class={!c.file ? \"disabled\" : \"\"} title={translate('Enable file copy and paste')}><icon .file /></div>\n<div class={!c.restart ? \"disabled\" : \"\"} title={translate('Enable remote restart')}><icon .restart /></div>\n</div> <div .permissions style=\"margin-top:8px;\" >\n<div class={!c.recording ? \"disabled\" : \"\"} title={translate('Enable recording session')}><icon .recording /></div>\n<div class={!c.block_input ? \"disabled\" : \"\"} title={translate('Enable blocking user input')} style={is_win ? \"\" : \"display:none;\"}><icon .block_input /></div>\n</div></div>\n}\n{c.port_forward ? <div>Port Forwarding: {c.port_forward}</div> : \"\"}\n<div style=\"size:*\"/>\n<div .outer_buttons>\n{!auth && !disconnected && show_elevation_btn && show_accept_btn ? <button #elevate_accept .control .elevate .button><span><span><span>{svg_elevate}</span><span>{translate('Accept')}</span></span></span></button> : \"\" }\n{auth && !disconnected && show_elevation_btn ? <button #elevate .control .elevate .button><span><span><span>{svg_elevate}</span><span>{translate('Elevate')}</span></span></span></button> : \"\" }\n<div .inner_buttons style={auth ? \"display:none;\":\"\"}>\n{!auth && show_accept_btn ? <button #accept .control .button>{translate('Accept')}</button> : \"\" }\n{!auth ? <button #dismiss .control .outline>{translate('Dismiss')}</button> : \"\" }\n</div>\n{auth && !disconnected ? <button #disconnect .control .button>{translate('Disconnect')}</button> : \"\" }\n{auth && disconnected ? <button #close .control .button>{translate('Close')}</button> : \"\" }\n</div>\n{c.is_file_transfer || c.port_forward ? \"\" : <div .chaticon>{svg_chat}</div>}\n</div>\n<div .right-panel style={right_style}>\n{c.is_file_transfer || c.port_forward ? \"\" : <ChatBox msgs={c.msgs} callback={callback} />}\n</div>\n</div>;\n}\nfunction sendMsg(text) {\nif (!text) return;\nvar { cid, connection } = this;\ncheckClickTime(function() {\nconnection.msgs.push({ name: \"me\", text: text, time: getNowStr()});\nhandler.send_msg(cid, text);\nbody.update();\n});\n}\nevent click $(icon.keyboard) (e) {\nvar { cid, connection } = this;\ncheckClickTime(function() {\nconnection.keyboard = !connection.keyboard;\nbody.update();\nhandler.switch_permission(cid, \"keyboard\", connection.keyboard);\n});\n}\nevent click $(icon.clipboard) {\nvar { cid, connection } = this;\ncheckClickTime(function() {\nconnection.clipboard = !connection.clipboard;\nbody.update();\nhandler.switch_permission(cid, \"clipboard\", connection.clipboard);\n});\n}\nevent click $(icon.audio) {\nvar { cid, connection } = this;\ncheckClickTime(function() {\nconnection.audio = !connection.audio;\nbody.update();\nhandler.switch_permission(cid, \"audio\", connection.audio);\n});\n}\nevent click $(icon.file) {\nvar { cid, connection } = this;\ncheckClickTime(function() {\nconnection.file = !connection.file;\nbody.update();\nhandler.switch_permission(cid, \"file\", connection.file);\n});\n}\nevent click $(icon.restart) {\nvar { cid, connection } = this;\ncheckClickTime(function() {\nconnection.restart = !connection.restart;\nbody.update();\nhandler.switch_permission(cid, \"restart\", connection.restart);\n});\n}\nevent click $(icon.recording) {\nvar { cid, connection } = this;\ncheckClickTime(function() {\nconnection.recording = !connection.recording;\nbody.update();\nhandler.switch_permission(cid, \"recording\", connection.recording);\n});\n}\nevent click $(icon.block_input) {\nvar { cid, connection } = this;\ncheckClickTime(function() {\nconnection.block_input = !connection.block_input;\nbody.update();\nhandler.switch_permission(cid, \"block_input\", connection.block_input);\n});\n}\nevent click $(button#accept) {\nvar { cid, connection } = this;\ncheckClickTime(function() {\nconnection.authorized = true;\nbody.update();\nhandler.authorize(cid);\nself.timer(30ms, function() {\nview.windowState = View.WINDOW_MINIMIZED;\n});\n});\n}\nevent click $(button#elevate_accept) {\nvar { cid, connection } = this;\ncheckClickTime(function() {\nconnection.authorized = true;\nshow_elevation = false;\nbody.update();\nhandler.elevate_portable(cid);\nhandler.authorize(cid);\nself.timer(30ms, function() {\nview.windowState = View.WINDOW_MINIMIZED;\n});\n});\n}\nevent click $(button#elevate) {\nvar { cid, connection } = this;\ncheckClickTime(function() {\nshow_elevation = false;\nbody.update();\nhandler.elevate_portable(cid);\nself.timer(30ms, function() {\nview.windowState = View.WINDOW_MINIMIZED;\n});\n});\n}\nevent click $(button#dismiss) {\nvar cid = this.cid;\ncheckClickTime(function() {\nhandler.close(cid);\n});\n}\nevent click $(button#disconnect) {\nvar cid = this.cid;\ncheckClickTime(function() {\nhandler.close(cid);\n});\n}\nevent click $(button#close) {\nvar cid = this.cid;\nif (this.cur >= 0 && this.cur < connections.length){\nhandler.remove_disconnected_connection(cid);\nconnections.splice(this.cur, 1);\nif (connections.length > 0) {\nif (this.cur > 0)\nthis.cur -= 1;\nelse\nthis.cur = connections.length - 1;\nheader.update();\nbody.update();\n} else {\nhandler.quit();\n}\n}\n}\n}\n$(body).content(<Body />);\nvar header;\nclass Header: Reactor.Component\n{\nfunction this() {\nheader = this;\n}\nfunction render() {\nvar me = this;\nvar conn = connections[body.cur];\nif (conn && conn.unreaded > 0) {;\nvar el = me.select(\"#unreaded\" + conn.id);\nif (el) el.style.set {\ndisplay: \"inline-block\",\n};\nself.timer(300ms, function() {\nconn.unreaded = 0;\nvar el = me.select(\"#unreaded\" + conn.id);\nif (el) el.style.set {\ndisplay: \"none\",\n};\n});\n}\nvar tabs = connections.map(function(c, i) { return me.renderTab(c, i) });\nreturn <div .tabs-wrapper><div .tabs>\n{tabs}\n</div>\n<div .tab-arrows>\n<span #left-arrow>&lt;</span>\n<span #right-arrow>&gt;</span>\n</div>\n</div>;\n}\nfunction renderTab(c, i) {\nvar cur = body.cur;\nreturn <div class={i == cur ? \"active-tab tab\" : \"tab\"}>\n{c.name}\n{c.unreaded > 0 ? <span .unreaded id={\"unreaded\" + c.id}>{c.unreaded}</span> : \"\"}\n</div>;\n}\nfunction update_cur(idx) {\ncheckClickTime(function() {\nbody.cur = idx;\nupdate();\nself.timer(1ms, adjustHeader);\n});\n}\nevent click $(div.tab) (_, me) {\nvar idx = me.index;\nif (idx == body.cur) return;\nthis.update_cur(idx);\n}\nevent click $(span#left-arrow) {\nvar cur = body.cur;\nif (cur == 0) return;\nthis.update_cur(cur - 1);\n}\nevent click $(span#right-arrow) {\nvar cur = body.cur;\nif (cur == connections.length - 1) return;\nthis.update_cur(cur + 1);\n}\n}\nif (is_osx) {\n$(header).content(<Header />);\n$(header).attributes[\"role\"] = \"window-caption\";\n} else {\n$(div.window-toolbar).content(<Header />);\nsetWindowButontsAndIcon(true);\n}\nevent click $(div.chaticon) {\ncheckClickTime(function() {\nshow_chat = !show_chat;\nadaptSizeForChat();\nif (show_chat) {\nview.focus = $(.outline-focus);\n}\n});\n}\nfunction checkClickTime(callback) {\nvar click_callback_time = getTime();\nhandler.check_click_time(body.cid);\nself.timer(120ms, function() {\nvar d = click_callback_time - handler.get_click_time();\nif (d > 120)\ncallback();\n});\n}\nfunction adaptSizeForChat() {\n$(div.right-panel).style.set {\ndisplay: show_chat ? \"block\" : \"none\",\n};\nvar (x, y, w, h) = view.box(#rectw, #border, #screen);\nif (show_chat && w < scaleIt(600)) {\nview.move(x - (scaleIt(600) - w), y, scaleIt(600), h);\n} else if (!show_chat && w > scaleIt(450)) {\nview.move(x + (w - scaleIt(300)), y, scaleIt(300), h);\n}\n}\nfunction update() {\nheader.update();\nbody.update();\n}\nfunction bring_to_top(idx=-1) {\nif (view.windowState == View.WINDOW_HIDDEN || view.windowState == View.WINDOW_MINIMIZED) {\nif (is_linux) {\nview.focus = self;\n} else {\nview.windowState = View.WINDOW_SHOWN;\n}\nif (idx >= 0) body.cur = idx;\n} else {\nview.windowTopmost = true;\nview.windowTopmost = false;\n}\n}\nhandler.addConnection = function(id, is_file_transfer, port_forward, peer_id, name, authorized, keyboard, clipboard, audio, file, restart, recording, block_input) {\nstdout.println(\"new connection #\" + id + \": \" + peer_id);\nvar conn;\nconnections.map(function(c) {\nif (c.id == id) conn = c;\n});\nif (conn) {\nconn.authorized = authorized;\nupdate();\nreturn;\n}\nvar idx = -1;\nconnections.map(function(c, i) {\nif (c.disconnected && c.peer_id == peer_id) idx = i;\n});\nif (!name) name = \"NA\";\nconn = {\nid: id, is_file_transfer: is_file_transfer, peer_id: peer_id,\nport_forward: port_forward,\nname: name, authorized: authorized, time: new Date(), now: new Date(),\nkeyboard: keyboard, clipboard: clipboard, msgs: [], unreaded: 0,\naudio: audio, file: file, restart: restart, recording: recording,\nblock_input:block_input,\ndisconnected: false\n};\nif (idx < 0) {\nconnections.push(conn);\nbody.cur = connections.length - 1;\n} else {\nconnections[idx] = conn;\nbody.cur = idx;\n}\nbring_to_top();\nupdate();\nself.timer(1ms, adjustHeader);\nif (authorized) {\nself.timer(3s, function() {\nview.windowState = View.WINDOW_MINIMIZED;\n});\n}\n}\nhandler.removeConnection = function(id, close) {\nvar i = -1;\nconnections.map(function(c, idx) {\nif (c.id == id) i = idx;\n});\nif (i < 0) return;\nif (close) {\nconnections.splice(i, 1);\n} else {\nvar conn = connections[i];\nconn.disconnected = true;\n}\nif (connections.length > 0) {\nif (body.cur >= i && body.cur > 0 && close) body.cur -= 1;\nupdate();\n}\n}\nhandler.newMessage = function(id, text) {\nvar idx = -1;\nconnections.map(function(c, i) {\nif (c.id == id) idx = i;\n});\nvar conn = connections[idx];\nif (!conn) return;\nconn.msgs.push({name: conn.name, text: text, time: getNowStr()});\nbring_to_top(idx);\nif (idx == body.cur) {\nvar shouldAdapt = !show_chat;\nshow_chat = true;\nif (shouldAdapt) adaptSizeForChat();\n}\nconn.unreaded += 1;\nupdate();\n}\nhandler.showElevation = function(show) {\nif (show != show_elevation) {\nshow_elevation = show;\nupdate();\n}\n}\nview << event statechange {\nadjustBorder();\n}\nfunction self.ready() {\nadjustBorder();\nvar (sw, sh) = view.screenBox(#workarea, #dimension);\nvar w = scaleIt(300);\nvar h = scaleIt(400);\nview.move(sw - w, 0, w, h);\n}\nfunction getElapsed(time, now) {\nvar seconds = Date.diff(time, now, #seconds);\nvar hours = seconds / 3600;\nvar days = hours / 24;\nhours = hours % 24;\nvar minutes = seconds % 3600 / 60;\nseconds = seconds % 60;\nvar out = String.printf(\"%02d:%02d:%02d\", hours, minutes, seconds);\nif (days > 0) {\nout = String.printf(\"%d day%s %s\", days, days > 1 ? \"s\" : \"\", out);\n}\nreturn out;\n}\nvar ui_status_cache = [\"\"];\nfunction check_update_ui() {\nself.timer(1s, function() {\nvar approve_mode = handler.get_option('approve-mode');\nvar changed = false;\nif (ui_status_cache[0] != approve_mode) {\nui_status_cache[0] = approve_mode;\nchanged = true;\n}\nif (changed) update();\ncheck_update_ui();\n});\n}\ncheck_update_ui();\nfunction updateTime() {\nself.timer(1s, function() {\nvar now = new Date();\nconnections.map(function(c) {\nif (!c.authorized) c.time = now;\nif (!c.disconnected) c.now = now;\n});\nvar el = $(#time);\nif (el) {\nvar c = connections[body.cur];\nif (c && c.authorized && !c.disconnected) {\nel.text = getElapsed(c.time, c.now);\n}\n}\nupdateTime();\n});\n}\nupdateTime();\nvar tm0 = getTime();\nfunction self.closing() {\nif (connections.length == 0 && getTime() - tm0 > 30000) return true;\nview.windowState = View.WINDOW_HIDDEN;\nreturn false;\n}\nfunction adjustHeader() {\nvar hw = $(header).box(#width) / scaleFactor;\nvar tabswrapper = $(div.tabs-wrapper);\nvar tabs = $(div.tabs);\nvar arrows = $(div.tab-arrows);\nif (!arrows) return;\nvar n = connections.length;\nvar wtab = 80;\nvar max = hw - 98;\nvar need_width = n * wtab + scaleIt(2); // include border of active tab\nif (need_width < max) {\narrows.style.set {\ndisplay: \"none\",\n};\ntabs.style.set {\nwidth: need_width,\nmargin-left: 0,\n};\ntabswrapper.style.set {\nwidth: need_width,\n};\n} else {\nvar margin = (body.cur + 1) * wtab - max + 30;\nif (margin < 0) margin = 0;\narrows.style.set {\ndisplay: \"block\",\n};\ntabs.style.set {\nwidth: (max - 20 + margin) + 'px',\nmargin-left: -margin + 'px'\n};\ntabswrapper.style.set {\nwidth: (max + 10) + 'px',\n};\n}\n}\nview.on(\"size\", adjustHeader);\n// handler.addConnection(0, false, 0, \"\", \"test1\", true, false, false, true, true);\n// handler.addConnection(1, false, 0, \"\", \"test2--------\", true, false, false, false, false);\n// handler.addConnection(2, false, 0, \"\", \"test3\", true, false, false, false, false);\n// handler.newMessage(0, 'h');\n</script>\n</head>\n<header>\n<div.window-icon role=\"window-icon\"><icon /></div>\n<caption role=\"window-caption\" />\n<div.border-bottom />\n<div.window-toolbar />\n<div.window-buttons />\n</header>\n<body #handler>\n</body>\n</html>\n";

fn get(data: &[u8]) -> String {
    String::from_utf8_lossy(data).to_string()
}
fn replace(data: &[u8]) -> String {
    let css = get(&_COMMON_CSS[..]);
    let res = get(data).replace("@import url(common.css);", &css);
    let tis = get(&_COMMON_TIS[..]);
    res.replace("include \"common.tis\";", &tis)
}
#[inline]
pub fn get_index() -> String {
    replace(&_INDEX[..])
}
#[inline]
pub fn get_remote() -> String {
    replace(&_REMOTE[..])
}
#[inline]
pub fn get_install() -> String {
    replace(&_INSTALL[..])
}
#[inline]
pub fn get_chatbox() -> String {
    replace(&_CHATBOX[..])
}
#[inline]
pub fn get_cm() -> String {
    replace(&_CONNECTION_MANAGER[..])
}
